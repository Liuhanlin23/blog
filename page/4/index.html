<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="åˆ˜ç¿°éœ–">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="åˆ˜ç¿°éœ–">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="åˆ˜ç¿°éœ–">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/4/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>åˆ˜ç¿°éœ–</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  




<meta name="referrer" content="no-referrer">

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">åˆ˜ç¿°éœ–</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">åˆ˜ç¿°éœ–</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/rocketmq/%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/rocketmq/%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸€-æ ¸å¿ƒåŸç†"><a href="#ä¸€-æ ¸å¿ƒåŸç†" class="headerlink" title="ä¸€.æ ¸å¿ƒåŸç†"></a>ä¸€.æ ¸å¿ƒåŸç†</h1><h3 id="å‘é€åŠæ¶ˆæ¯ï¼ˆHalf-Messageï¼‰"><a href="#å‘é€åŠæ¶ˆæ¯ï¼ˆHalf-Messageï¼‰" class="headerlink" title="å‘é€åŠæ¶ˆæ¯ï¼ˆHalf Messageï¼‰"></a>å‘é€åŠæ¶ˆæ¯ï¼ˆHalf Messageï¼‰</h3><p>ç”Ÿäº§è€…å…ˆæŠŠæ¶ˆæ¯å‘åˆ° Brokerï¼Œä½†è¿™æ¡æ¶ˆæ¯å¯¹æ¶ˆè´¹è€…<strong>ä¸å¯è§</strong>ã€‚  </p>
<h3 id="æ‰§è¡Œæœ¬åœ°äº‹åŠ¡"><a href="#æ‰§è¡Œæœ¬åœ°äº‹åŠ¡" class="headerlink" title="æ‰§è¡Œæœ¬åœ°äº‹åŠ¡"></a>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</h3><p> ç”Ÿäº§è€…åœ¨è‡ªå·±çš„ä¸šåŠ¡åº“é‡Œæ‰§è¡Œäº‹åŠ¡ï¼ˆå¦‚åˆ›å»ºè®¢å•ã€æ‰£åº“å­˜ï¼‰ã€‚</p>
<h3 id="æäº¤-å›æ»šäº‹åŠ¡çŠ¶æ€"><a href="#æäº¤-å›æ»šäº‹åŠ¡çŠ¶æ€" class="headerlink" title="æäº¤&#x2F;å›æ»šäº‹åŠ¡çŠ¶æ€"></a>æäº¤&#x2F;å›æ»šäº‹åŠ¡çŠ¶æ€</h3><ul>
<li>æœ¬åœ°äº‹åŠ¡æˆåŠŸ â†’ é€šçŸ¥ Broker Commitï¼ŒåŠæ¶ˆæ¯å˜æˆå¯è§çš„â€œæ­£å¸¸æ¶ˆæ¯â€ï¼›  </li>
<li>æœ¬åœ°äº‹åŠ¡å¤±è´¥ â†’ é€šçŸ¥ Broker <strong>Rollback</strong>ï¼ŒåŠæ¶ˆæ¯è¢«ä¸¢å¼ƒï¼›</li>
<li>ç”Ÿäº§è€…æ²¡å›ï¼ˆå´©æºƒ&#x2F;ç½‘ç»œæŠ–åŠ¨ï¼‰ â†’ Broker è§¦å‘<strong>äº‹åŠ¡å›æŸ¥</strong>ï¼Œå›è°ƒç”Ÿäº§è€…é—®ç»“æœåˆ°åº•æˆæ²¡æˆï¼Œç„¶åå†å†³å®š Commit&#x2F;Rollbackã€‚</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡å›æŸ¥"><a href="#ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡å›æŸ¥" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡å›æŸ¥"></a>ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡å›æŸ¥</h2><p>å‡è®¾ä½ åœ¨æ‰§è¡Œè¿™ä¸‰æ­¥ï¼š</p>
<p>1ï¸âƒ£ <strong>å‘é€åŠæ¶ˆæ¯æˆåŠŸ</strong>ï¼ˆæ¶ˆæ¯è¿›å…¥ Brokerï¼Œä½†æ¶ˆè´¹è€…è¿˜çœ‹ä¸è§ï¼‰<br>2ï¸âƒ£ <strong>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</strong>ï¼ˆæ¯”å¦‚åˆ›å»ºè®¢å• + æ‰£åº“å­˜ï¼‰<br>3ï¸âƒ£ <strong>å‘Šè¯‰ Brokerï¼šäº‹åŠ¡æˆåŠŸï¼ˆCommitï¼‰æˆ–å¤±è´¥ï¼ˆRollbackï¼‰</strong></p>
<p>å¦‚æœç¨‹åºåœ¨ç¬¬ 2.5 æ­¥å´©æºƒäº†ï¼ˆæ‰§è¡Œå®Œäº‹åŠ¡ä½†è¿˜æ²¡æ¥å¾—åŠå‘Šè¯‰ Brokerï¼‰ï¼Œ<br>é‚£ Broker å°±ä¸çŸ¥é“è¯¥æ€ä¹ˆå¤„ç†è¿™æ¡åŠæ¶ˆæ¯äº†ï¼šè¿™æ¡æ¶ˆæ¯åˆ°åº•è¯¥æäº¤ç»™æ¶ˆè´¹è€…ï¼Ÿè¿˜æ˜¯å›æ»šæ‰ï¼Ÿ</p>
<p>ä¸ºäº†é¿å…è¿™ç§â€œæ‚¬ç©ºâ€çš„çŠ¶æ€ï¼ŒBroker ä¼šå®šæœŸå»<strong>è¯¢é—®ç”Ÿäº§è€…</strong>ï¼š</p>
<p>â€œå–‚ï¼Œä½ ä¹‹å‰å‘çš„é‚£æ¡äº‹åŠ¡æ¶ˆæ¯ï¼Œåˆ°åº•äº‹åŠ¡æˆåŠŸæ²¡ï¼Ÿâ€</p>
<p>è¿™ä¸ªè¯¢é—®åŠ¨ä½œå°±æ˜¯ <strong>äº‹åŠ¡å›æŸ¥ï¼ˆTransaction Checkï¼‰</strong>ã€‚</p>
<h2 id="å¦‚ä½•ç†è§£rocketmq-çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿä»€ä¹ˆæ˜¯å¼ºä¸€è‡´æ€§"><a href="#å¦‚ä½•ç†è§£rocketmq-çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿä»€ä¹ˆæ˜¯å¼ºä¸€è‡´æ€§" class="headerlink" title="å¦‚ä½•ç†è§£rocketmq çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿä»€ä¹ˆæ˜¯å¼ºä¸€è‡´æ€§"></a>å¦‚ä½•ç†è§£rocketmq çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿä»€ä¹ˆæ˜¯å¼ºä¸€è‡´æ€§</h2><ul>
<li><strong>å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰</strong><br>å„ä¸ªç³»ç»Ÿï¼ˆæ¯”å¦‚æ•°æ®åº“å’Œæ¶ˆæ¯ç³»ç»Ÿï¼‰å¿…é¡»åœ¨ä»»æ„æ—¶åˆ»çœ‹åˆ°<strong>ç›¸åŒçš„æ•°æ®ç»“æœ</strong>ã€‚<br>ğŸ‘‰ ä¾‹å¦‚ï¼šä¸‹å•æˆåŠŸ â†’ ç«‹åˆ»èƒ½æŸ¥åˆ°è®¢å•ã€èƒ½çœ‹åˆ°æ¶ˆæ¯ã€åº“å­˜åŒæ­¥å‡å°‘ã€‚<br>ç¼ºç‚¹ï¼šè·¨ç³»ç»Ÿäº‹åŠ¡å¤ªé‡ï¼Œæ€§èƒ½ä½ã€è€¦åˆé«˜ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰</strong><br>å„ä¸ªç³»ç»Ÿçš„çŠ¶æ€å…è®¸åœ¨<strong>çŸ­æ—¶é—´å†…ä¸ä¸€è‡´</strong>ï¼Œ<br>ä½†ç»è¿‡<strong>è‡ªåŠ¨æ¢å¤æˆ–è¡¥å¿</strong>åï¼Œ<strong>æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€</strong>ã€‚<br>ğŸ‘‰ æ¯”å¦‚ï¼šä½ ä¸‹å•æˆåŠŸåï¼Œå‡ ç§’ååº“å­˜æ‰æ‰£å‡å®Œï¼Œä½†æœ€ç»ˆæ•°æ®æ˜¯å¯¹çš„ã€‚</li>
</ul>
<p> RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶å®ç°çš„æ­£æ˜¯åè€…ã€‚  </p>
<h1 id="springboot-å‘é€äº‹åŠ¡æ¶ˆæ¯"><a href="#springboot-å‘é€äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="springboot å‘é€äº‹åŠ¡æ¶ˆæ¯"></a>springboot å‘é€äº‹åŠ¡æ¶ˆæ¯</h1><h3 id="ç¼–å†™æ—¶é—´ç›‘å¬å™¨"><a href="#ç¼–å†™æ—¶é—´ç›‘å¬å™¨" class="headerlink" title="ç¼–å†™æ—¶é—´ç›‘å¬å™¨"></a>ç¼–å†™æ—¶é—´ç›‘å¬å™¨</h3><p>è¿™ä¸ªç›‘å¬å™¨è´Ÿè´£<strong>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘</strong>å’Œ<strong>äº‹åŠ¡å›æŸ¥</strong>ã€‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.rocketmq.spring.annotation.RocketMQTransactionListener;</span><br><span class="line">import org.apache.rocketmq.spring.core.RocketMQLocalTransactionListener;</span><br><span class="line">import org.apache.rocketmq.spring.support.RocketMQLocalTransactionState;</span><br><span class="line">import org.springframework.messaging.Message;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@RocketMQTransactionListener(txProducerGroup = &quot;tx_producer_group&quot;)//äº‹åŠ¡ç”Ÿäº§è€…ç»„</span><br><span class="line">public class OrderTxListener implements RocketMQLocalTransactionListener &#123;</span><br><span class="line"></span><br><span class="line">    // å‘é€åŠæ¶ˆæ¯åï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span><br><span class="line">    @Override</span><br><span class="line">    public RocketMQLocalTransactionState executeLocalTransaction(Message msg, Object arg) &#123;</span><br><span class="line">        String orderId = (String) msg.getHeaders().get(&quot;orderId&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            boolean ok = doLocalTx(orderId);</span><br><span class="line">            return ok ? RocketMQLocalTransactionState.COMMIT</span><br><span class="line">                      : RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return RocketMQLocalTransactionState.UNKNOWN;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Broker å›æŸ¥</span><br><span class="line">    @Override</span><br><span class="line">    public RocketMQLocalTransactionState checkLocalTransaction(Message msg) &#123;</span><br><span class="line">        String orderId = (String) msg.getHeaders().get(&quot;orderId&quot;);</span><br><span class="line">        TxStatus status = queryTxStatus(orderId);</span><br><span class="line">        switch (status) &#123;</span><br><span class="line">            case COMMIT:   return RocketMQLocalTransactionState.COMMIT;</span><br><span class="line">            case ROLLBACK: return RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">            default:       return RocketMQLocalTransactionState.UNKNOWN;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean doLocalTx(String orderId) &#123; /* äº‹åŠ¡è½åº“ + è®°å½•äº‹ä»¶è¡¨ */ return true; &#125;</span><br><span class="line">    private TxStatus queryTxStatus(String orderId) &#123; return TxStatus.COMMIT; &#125;</span><br><span class="line">    enum TxStatus &#123; COMMIT, ROLLBACK, UNKNOWN &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘é€äº‹åŠ¡æ¶ˆæ¯"><a href="#å‘é€äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="å‘é€äº‹åŠ¡æ¶ˆæ¯"></a>å‘é€äº‹åŠ¡æ¶ˆæ¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class OrderService &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RocketMQTemplate rocketMQTemplate;</span><br><span class="line"></span><br><span class="line">    public void createOrder(String orderId) &#123;</span><br><span class="line">        // å°è£…æ¶ˆæ¯ä½“</span><br><span class="line">        Message&lt;String&gt; message = MessageBuilder.withPayload(&quot;order:&quot; + orderId)</span><br><span class="line">                .setHeader(&quot;orderId&quot;, orderId)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        // å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼ˆç»‘å®šç›‘å¬å™¨ txProducerGroupï¼‰</span><br><span class="line">        rocketMQTemplate.sendMessageInTransaction(&quot;tx_producer_group&quot;,</span><br><span class="line">                &quot;order-topic&quot;,</span><br><span class="line">                message,</span><br><span class="line">                null); // è¿™ä¸ªargä¼šä¼ ç»™executeLocalTransaction</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å¦‚ä½•ç†è§£rocketmq-çš„äº‹åŠ¡ç›‘å¬å™¨"><a href="#å¦‚ä½•ç†è§£rocketmq-çš„äº‹åŠ¡ç›‘å¬å™¨" class="headerlink" title="å¦‚ä½•ç†è§£rocketmq çš„äº‹åŠ¡ç›‘å¬å™¨"></a>å¦‚ä½•ç†è§£rocketmq çš„äº‹åŠ¡ç›‘å¬å™¨</h2><p> å½“ä½ ä½¿ç”¨ <code>RocketMQTemplate.sendMessageInTransaction(...)</code> å‘é€äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œ<br>RocketMQ ä¼šè‡ªåŠ¨è§¦å‘è¿™ä¸ªç›‘å¬å™¨ä¸­å®šä¹‰çš„ä¸¤ä¸ªå›è°ƒæ–¹æ³•ï¼š  </p>
<table>
<thead>
<tr>
<th>å›è°ƒæ–¹æ³•</th>
<th>è§¦å‘æ—¶æœº</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>executeLocalTransaction()</code></td>
<td>å‘é€åŠæ¶ˆæ¯æˆåŠŸåç«‹å³è°ƒç”¨</td>
<td>æ‰§è¡Œ<strong>æœ¬åœ°äº‹åŠ¡é€»è¾‘</strong>ï¼ˆæ¯”å¦‚åˆ›å»ºè®¢å•ã€æ‰£åº“å­˜ï¼‰</td>
</tr>
<tr>
<td><code>checkLocalTransaction()</code></td>
<td>Broker å‘èµ·<strong>äº‹åŠ¡å›æŸ¥</strong>æ—¶è°ƒç”¨</td>
<td>MQ ä¸ç¡®å®šäº‹åŠ¡ç»“æœæ—¶ï¼Œç”¨æ¥<strong>è¡¥æŸ¥äº‹åŠ¡çŠ¶æ€</strong></td>
</tr>
</tbody></table>
<h3 id="executeLocalTransaction-æ–¹æ³•"><a href="#executeLocalTransaction-æ–¹æ³•" class="headerlink" title="executeLocalTransaction æ–¹æ³•"></a>executeLocalTransaction æ–¹æ³•</h3><p><code>executeLocalTransaction(Message msg, Object arg)</code></p>
<ul>
<li>åœ¨<strong>å‘é€åŠæ¶ˆæ¯æˆåŠŸå</strong>æ‰§è¡Œï¼›</li>
<li>ä½ åœ¨è¿™é‡Œå†™è‡ªå·±çš„ <strong>æœ¬åœ°ä¸šåŠ¡é€»è¾‘</strong>ï¼ˆæ¯”å¦‚è®¢å•å…¥åº“ï¼‰ï¼›</li>
<li>æ‰§è¡Œå®Œåï¼Œè¿”å›äº‹åŠ¡çŠ¶æ€ï¼š<ul>
<li><code>COMMIT</code> â†’ é€šçŸ¥ Broker æŠ•é€’æ¶ˆæ¯ï¼›</li>
<li><code>ROLLBACK</code> â†’ é€šçŸ¥ Broker ä¸¢å¼ƒæ¶ˆæ¯ï¼›</li>
<li><code>UNKNOWN</code> â†’ æš‚æ—¶ä¸ç¡®å®šï¼ˆBroker ä¼šç¨åå›æŸ¥ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="checkLocalTransaction-Message-msg"><a href="#checkLocalTransaction-Message-msg" class="headerlink" title="checkLocalTransaction(Message msg)"></a>checkLocalTransaction(Message msg)</h3><ul>
<li>å½“ Broker æ²¡æœ‰æ”¶åˆ°ç”Ÿäº§è€…çš„äº‹åŠ¡ç¡®è®¤ï¼ˆæ¯”å¦‚ç”Ÿäº§è€…å´©æºƒï¼‰æ—¶ï¼Œä¼š<strong>è§¦å‘å›æŸ¥</strong>ï¼›</li>
<li>è¿™ä¸ªæ–¹æ³•ä¼šè¢« Broker è°ƒç”¨ï¼Œé—®ï¼šâ€œé‚£æ¡æ¶ˆæ¯çš„äº‹åŠ¡åˆ°åº•æˆåŠŸæ²¡ï¼Ÿâ€ï¼›</li>
<li>ç”Ÿäº§è€…è¦è‡ªå·±æŸ¥æ•°æ®åº“çš„äº‹åŠ¡è¡¨æˆ–ä¸šåŠ¡è¡¨ï¼Œè¿”å›çŠ¶æ€ã€‚</li>
</ul>
<h2 id="RocketMQTransactionListener-txProducerGroup-â€œtx-producer-groupâ€-ä¸­çš„txProducerGroupäº‹åŠ¡ç”Ÿäº§è€…ç»„å’Œapplication-ymlç”Ÿäº§è€…ç»„æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#RocketMQTransactionListener-txProducerGroup-â€œtx-producer-groupâ€-ä¸­çš„txProducerGroupäº‹åŠ¡ç”Ÿäº§è€…ç»„å’Œapplication-ymlç”Ÿäº§è€…ç»„æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="@RocketMQTransactionListener(txProducerGroup &#x3D; â€œtx_producer_groupâ€)ä¸­çš„txProducerGroupäº‹åŠ¡ç”Ÿäº§è€…ç»„å’Œapplication.ymlç”Ÿäº§è€…ç»„æœ‰ä»€ä¹ˆåŒºåˆ«"></a>@RocketMQTransactionListener(txProducerGroup &#x3D; â€œtx_producer_groupâ€)ä¸­çš„txProducerGroupäº‹åŠ¡ç”Ÿäº§è€…ç»„å’Œapplication.ymlç”Ÿäº§è€…ç»„æœ‰ä»€ä¹ˆåŒºåˆ«</h2><ol>
<li>åœ¨application.ymlä¸­é…ç½®çš„æ˜¯æ™®é€šç”Ÿäº§è€…ç»„</li>
</ol>
<p>rocketmq:</p>
<p>  name-server: 127.0.0.1:9876</p>
<p>  producer:</p>
<pre><code>group: normal_producer_group
</code></pre>
<br/>

<ul>
<li>ç”¨äº <strong>æ™®é€šæ¶ˆæ¯</strong>ï¼ˆ<code>send()</code>ã€<code>syncSend()</code> ç­‰ï¼‰</li>
<li><code>RocketMQTemplate</code> é»˜è®¤ä½¿ç”¨è¿™ä¸ªç»„</li>
</ul>
<ol start="2">
<li>åœ¨ç›‘å¬å™¨ä¸Šé€šè¿‡æ³¨è§£æŒ‡å®šçš„æ˜¯äº‹åŠ¡ç”Ÿäº§è€…ç»„</li>
</ol>
<p>@RocketMQTransactionListener(txProducerGroup &#x3D; â€œorder_tx_groupâ€)</p>
<br/>

<ul>
<li><p>ç”¨äº <strong>äº‹åŠ¡æ¶ˆæ¯</strong>ï¼ˆ<code>sendMessageInTransaction()</code>ï¼‰</p>
</li>
<li><p>å¿…é¡»ä¸å‘é€æ—¶æŒ‡å®šçš„ç»„åä¸€è‡´ï¼š</p>
</li>
<li><p>rocketMQTemplate.sendMessageInTransaction(â€œorder_tx_groupâ€, â€œorder-topicâ€, msg, null);</p>
</li>
</ul>
<br/>

<p>è¿™ä¸ªç»„åæ˜¯ï¼š</p>
<ul>
<li>Broker å›æŸ¥äº‹åŠ¡çŠ¶æ€æ—¶çš„ä¾æ®ï¼›</li>
<li>Spring Boot ç»‘å®šç›‘å¬å™¨ä¸ Producer çš„å…³é”®æ ‡è¯†ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å®šä¹‰ä½ç½®</th>
<th>ç”¨é€”</th>
<th>æ˜¯å¦ä¸äº‹åŠ¡ç›¸å…³</th>
</tr>
</thead>
<tbody><tr>
<td><code>rocketmq.producer.group</code></td>
<td>application.yml</td>
<td>æ™®é€šæ¶ˆæ¯ç”Ÿäº§è€…ç»„</td>
<td>âŒ</td>
</tr>
<tr>
<td><code>txProducerGroup</code></td>
<td>@RocketMQTransactionListener</td>
<td>äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…ç»„</td>
<td>âœ…</td>
</tr>
<tr>
<td>å…³ç³»</td>
<td>ç›¸äº’ç‹¬ç«‹</td>
<td>äº’ä¸å½±å“</td>
<td>â€”</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/rocketmq/Springboot_rocket_%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/rocketmq/Springboot_rocket_%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>_ rocketmq-spring-boot-starter åŸºäº RocketMQ åŸç”Ÿ Java å®¢æˆ·ç«¯è¿›è¡Œå°è£…ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…ã€YAML é…ç½®ç»‘å®šä¸ @RocketMQMessageListener ç­‰æ³¨è§£ï¼Œç®€åŒ–æ¶ˆæ¯çš„å‘é€ã€æ¶ˆè´¹ä¸äº‹åŠ¡å¤„ç†ã€‚  _</p>
<h1 id="ä¸€-å¼•å…¥ä¾èµ–"><a href="#ä¸€-å¼•å…¥ä¾èµ–" class="headerlink" title="ä¸€. å¼•å…¥ä¾èµ–"></a>ä¸€. å¼•å…¥ä¾èµ–</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="code">     &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;</span></span><br><span class="line"><span class="code">     &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;</span></span><br><span class="line"><span class="code">     &lt;version&gt;2.3.0&lt;/version&gt;</span></span><br><span class="line"><span class="code">   &lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-é…ç½®application-ymlé…ç½®æ–‡ä»¶"><a href="#äºŒ-é…ç½®application-ymlé…ç½®æ–‡ä»¶" class="headerlink" title="äºŒ.é…ç½®application.ymlé…ç½®æ–‡ä»¶"></a>äºŒ.é…ç½®application.ymlé…ç½®æ–‡ä»¶</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># name-server ip + port</span><br><span class="line">  name-server: 127.0.0.1:9876</span><br><span class="line">  producer:</span><br><span class="line"># ç”Ÿäº§è€…ç»„å</span><br><span class="line">    group: demo-producer-group</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰-å‘é€ä¸æ¥æ”¶æ¶ˆæ¯"><a href="#ä¸‰-å‘é€ä¸æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="ä¸‰.å‘é€ä¸æ¥æ”¶æ¶ˆæ¯"></a>ä¸‰.å‘é€ä¸æ¥æ”¶æ¶ˆæ¯</h2><h2 id="rocketmqçš„æ¶ˆæ¯ç±»å‹"><a href="#rocketmqçš„æ¶ˆæ¯ç±»å‹" class="headerlink" title="rocketmqçš„æ¶ˆæ¯ç±»å‹"></a>rocketmqçš„æ¶ˆæ¯ç±»å‹</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>åç§°</th>
<th>åœºæ™¯</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>1. æ™®é€šæ¶ˆæ¯ï¼ˆNormal Messageï¼‰</strong></td>
<td>æœ€å¸¸è§</td>
<td>æ™®é€šçš„å¼‚æ­¥é€šä¿¡ï¼Œå¦‚è®¢å•åˆ›å»ºé€šçŸ¥</td>
<td>ä¸ä¿è¯é¡ºåºï¼Œæœ€çµæ´»</td>
</tr>
<tr>
<td><strong>2. é¡ºåºæ¶ˆæ¯ï¼ˆOrdered Messageï¼‰</strong></td>
<td>ä¿è¯åŒä¸€ä¸šåŠ¡ Key çš„é¡ºåº</td>
<td>è®¢å•çŠ¶æ€å˜æ›´ï¼ˆä¸‹å•â†’æ”¯ä»˜â†’å‘è´§ï¼‰</td>
<td>æŒ‰ hashKey æœ‰åº</td>
</tr>
<tr>
<td><strong>3. å»¶æ—¶æ¶ˆæ¯ï¼ˆDelayed Messageï¼‰</strong></td>
<td>å»¶è¿Ÿæ¶ˆè´¹</td>
<td>æ”¯ä»˜è¶…æ—¶å–æ¶ˆè®¢å•ã€å»¶è¿ŸçŸ­ä¿¡é€šçŸ¥</td>
<td>RocketMQ å†…ç½®å»¶è¿Ÿç­‰çº§</td>
</tr>
<tr>
<td><strong>4. äº‹åŠ¡æ¶ˆæ¯ï¼ˆTransactional Messageï¼‰</strong></td>
<td>åˆ†å¸ƒå¼äº‹åŠ¡</td>
<td>ä¸‹å•æˆåŠŸâ†’æ‰£åº“å­˜ä¸€è‡´æ€§</td>
<td>æ”¯æŒå›æŸ¥æœºåˆ¶ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§</td>
</tr>
</tbody></table>
<h2 id="rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€ç±»å‹"><a href="#rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€ç±»å‹" class="headerlink" title="rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€ç±»å‹"></a>rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€ç±»å‹</h2><table>
<thead>
<tr>
<th>å‘é€æ–¹å¼</th>
<th>æ˜¯å¦ç­‰å¾…å“åº”</th>
<th>æ˜¯å¦æœ‰å›è°ƒ</th>
<th>å¯é æ€§</th>
<th>æ€§èƒ½</th>
<th>å…¸å‹åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>åŒæ­¥å‘é€</strong></td>
<td>âœ… ç­‰å¾… Broker ç¡®è®¤</td>
<td>âŒ æ— å›è°ƒ</td>
<td>âœ… æœ€é«˜</td>
<td>ğŸš€ ä¸­</td>
<td>æ ¸å¿ƒä¸šåŠ¡ï¼ˆå¦‚ä¸‹å•ã€æ”¯ä»˜ï¼‰</td>
</tr>
<tr>
<td><strong>å¼‚æ­¥å‘é€</strong></td>
<td>âœ… åå°ç­‰å¾…ã€å›è°ƒé€šçŸ¥</td>
<td>âœ… æœ‰å›è°ƒ</td>
<td>âœ… è¾ƒé«˜</td>
<td>ğŸš€ğŸš€ è¾ƒé«˜</td>
<td>å¼‚æ­¥é€šçŸ¥ã€çŸ­ä¿¡ã€æ¨é€</td>
</tr>
<tr>
<td><strong>å•å‘å‘é€</strong></td>
<td>âŒ ä¸ç­‰å¾…ã€ä¸ç¡®è®¤</td>
<td>âŒ æ— å›è°ƒ</td>
<td>âŒ æœ€ä½</td>
<td>ğŸš€ğŸš€ğŸš€ æœ€é«˜</td>
<td>æ—¥å¿—ä¸ŠæŠ¥ã€åŸ‹ç‚¹ç»Ÿè®¡</td>
</tr>
</tbody></table>
<ol>
<li>åŒæ­¥å‘é€ï¼š ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾… Broker è¿”å› <code>SendResult</code>ï¼ˆåŒ…å«å‘é€çŠ¶æ€ã€æ¶ˆæ¯ IDã€è½å…¥é˜Ÿåˆ—ç­‰ä¿¡æ¯ï¼‰ã€‚<br>åªæœ‰å½“ Broker ç¡®è®¤æ¶ˆæ¯å·²ç»æˆåŠŸå†™å…¥é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºè¿™æ¡æ¶ˆæ¯å‘é€æˆåŠŸã€‚  </li>
<li>å¼‚æ­¥å‘é€ï¼šç”Ÿäº§è€…è°ƒç”¨å‘é€æ–¹æ³•åç«‹å³è¿”å›ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚<br>RocketMQ ä¼šåœ¨åå°ç½‘ç»œçº¿ç¨‹ä¸­ç­‰å¾… Broker å“åº”ï¼Œå¹¶é€šè¿‡å›è°ƒï¼ˆ<code>SendCallback</code>ï¼‰é€šçŸ¥ç»“æœï¼š</li>
</ol>
<ul>
<li><code>onSuccess(SendResult)</code>ï¼šå‘é€æˆåŠŸï¼›</li>
<li><code>onException(Throwable)</code>ï¼šå‘é€å¤±è´¥ã€‚</li>
</ul>
<ol start="3">
<li>å•å‘å‘é€ï¼š ç”Ÿäº§è€…åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾… Broker å“åº”ï¼Œä¹Ÿæ²¡æœ‰å›è°ƒæˆ–ç¡®è®¤æœºåˆ¶ã€‚<br>æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€ã€æ˜¯å¦å†™å…¥é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å®Œå…¨ä¸å…³å¿ƒã€‚</li>
</ol>
<h2 id="ä»€ä¹ˆæ˜¯tagså’Œkey"><a href="#ä»€ä¹ˆæ˜¯tagså’Œkey" class="headerlink" title="ä»€ä¹ˆæ˜¯tagså’Œkey"></a>ä»€ä¹ˆæ˜¯tagså’Œkey</h2><h3 id="rocketmqæ¶ˆæ¯çš„åŸºæœ¬ç»“æ„ï¼Œæ¯ä¸€æ¡messageéƒ½åŒ…å«å‡ ä¸ªå¸¸è§å±æ€§"><a href="#rocketmqæ¶ˆæ¯çš„åŸºæœ¬ç»“æ„ï¼Œæ¯ä¸€æ¡messageéƒ½åŒ…å«å‡ ä¸ªå¸¸è§å±æ€§" class="headerlink" title="rocketmqæ¶ˆæ¯çš„åŸºæœ¬ç»“æ„ï¼Œæ¯ä¸€æ¡messageéƒ½åŒ…å«å‡ ä¸ªå¸¸è§å±æ€§"></a>rocketmqæ¶ˆæ¯çš„åŸºæœ¬ç»“æ„ï¼Œæ¯ä¸€æ¡messageéƒ½åŒ…å«å‡ ä¸ªå¸¸è§å±æ€§</h3><table>
<thead>
<tr>
<th>å±æ€§</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>Topic</code></td>
<td>æ¶ˆæ¯çš„ä¸»é¢˜ï¼Œç”¨æ¥åŒºåˆ†ä¸šåŠ¡ç±»å‹ï¼Œæ¯”å¦‚â€œç”¨æˆ·æ³¨å†Œâ€ã€â€œè®¢å•æ”¯ä»˜â€ç­‰ã€‚</td>
</tr>
<tr>
<td><code>Tag</code></td>
<td>ä¸»é¢˜ä¸‹çš„å­åˆ†ç±»ï¼Œç”¨æ¥è¿›ä¸€æ­¥ç­›é€‰æ¶ˆæ¯ã€‚</td>
</tr>
<tr>
<td><code>Key</code></td>
<td>æ¶ˆæ¯çš„å”¯ä¸€ä¸šåŠ¡æ ‡è¯†ï¼Œç”¨æ¥å®šä½å’Œæ’æŸ¥é—®é¢˜ã€‚</td>
</tr>
<tr>
<td><code>Body</code></td>
<td>çœŸæ­£çš„æ¶ˆæ¯å†…å®¹ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰ã€‚</td>
</tr>
</tbody></table>
<h3 id="Tagæ ‡ç­¾"><a href="#Tagæ ‡ç­¾" class="headerlink" title="Tagæ ‡ç­¾"></a>Tagæ ‡ç­¾</h3><p>   ä½œç”¨ï¼šåœ¨åŒä¸€ä¸ª Topic ä¸‹å†è¿›è¡Œä¸€æ¬¡é€»è¾‘åˆ†ç±»ã€‚  </p>
<p> æ¯”å¦‚ï¼š  </p>
<p>Topic: OrderTopic</p>
<p>Tag: CREATEã€PAYã€CANCEL</p>
<br/>

<p> æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡è®¢é˜…æ—¶æŒ‡å®š Tagï¼š  </p>
<p>consumer.subscribe(â€œOrderTopicâ€, â€œCREATE || PAYâ€);</p>
<br/>

<p>è¡¨ç¤ºåªæ¥æ”¶è®¢å•åˆ›å»ºå’Œæ”¯ä»˜çš„æ¶ˆæ¯ï¼Œè€Œå–æ¶ˆç±»æ¶ˆæ¯ï¼ˆ<code>CANCEL</code>ï¼‰ä¼šè¢«è¿‡æ»¤æ‰ã€‚</p>
<p>âœ… è¿‡æ»¤æ˜¯åœ¨ <strong>Broker ç«¯å®Œæˆçš„</strong>ï¼Œæ‰€ä»¥èƒ½å‡è½»æ¶ˆè´¹è€…çš„è´Ÿæ‹…ã€‚</p>
<p>ğŸ‘‰ <strong>æ€»ç»“ä¸€å¥è¯ï¼š</strong></p>
<p>Tag æ˜¯ Topic ä¸‹çš„â€œäºŒçº§åˆ†ç±»â€ï¼Œç”¨æ¥åš<strong>æ¶ˆæ¯è¿‡æ»¤å’Œéš”ç¦»ä¸åŒä¸šåŠ¡äº‹ä»¶</strong>ã€‚</p>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p> ä½œç”¨ï¼šç»™æ¯æ¡æ¶ˆæ¯æ‰“ä¸Šä¸€ä¸ªèƒ½å”¯ä¸€å®šä½ä¸šåŠ¡çš„æ ‡è¯†ã€‚  </p>
<p> æ¯”å¦‚ï¼š  </p>
<p>Message msg &#x3D; new Message(â€œOrderTopicâ€, â€œCREATEâ€, â€œorderId_12345â€, body);</p>
<br/>

<p>å¸¸ç”¨äºï¼š</p>
<ul>
<li>æ’æŸ¥æŸæ¡æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€ï¼›</li>
<li>å®šä½ä¸¢å¤±ã€é‡å¤çš„æ¶ˆæ¯ï¼›</li>
<li>å¿«é€Ÿåœ¨æ§åˆ¶å°æœç´¢ã€‚</li>
</ul>
<p>ğŸ‘‰ <strong>æ€»ç»“ä¸€å¥è¯ï¼š</strong></p>
<p>Key æ˜¯æ¶ˆæ¯çš„â€œå”¯ä¸€ä¸šåŠ¡ç´¢å¼•â€ï¼Œæ–¹ä¾¿<strong>æ’æŸ¥ä¸è¿½è¸ªæ¶ˆæ¯</strong>ã€‚</p>
<h3 id="å¯¹æ¯”åˆ†æ"><a href="#å¯¹æ¯”åˆ†æ" class="headerlink" title="å¯¹æ¯”åˆ†æ"></a>å¯¹æ¯”åˆ†æ</h3><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>Tag</th>
<th>Key</th>
</tr>
</thead>
<tbody><tr>
<td>å±‚çº§</td>
<td>äºŒçº§åˆ†ç±»ï¼ˆé™„å±äº Topicï¼‰</td>
<td>å”¯ä¸€æ ‡è¯†ï¼ˆé’ˆå¯¹å•æ¡æ¶ˆæ¯ï¼‰</td>
</tr>
<tr>
<td>ä½œç”¨</td>
<td>æ¶ˆæ¯è¿‡æ»¤</td>
<td>æ¶ˆæ¯è¿½è¸ªã€é—®é¢˜å®šä½</td>
</tr>
<tr>
<td>ä½ç½®</td>
<td>æ¶ˆæ¯å¤´å±æ€§</td>
<td>æ¶ˆæ¯å¤´å±æ€§</td>
</tr>
<tr>
<td>æ¶ˆè´¹è¿‡æ»¤</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>ç¤ºä¾‹</td>
<td>â€œPAYâ€ã€â€CANCELâ€</td>
<td>â€œorderId_12345â€</td>
</tr>
</tbody></table>
<h2 id="æ™®é€šæ¶ˆæ¯"><a href="#æ™®é€šæ¶ˆæ¯" class="headerlink" title="æ™®é€šæ¶ˆæ¯"></a>æ™®é€šæ¶ˆæ¯</h2><h3 id="åŒæ­¥å‘é€"><a href="#åŒæ­¥å‘é€" class="headerlink" title="åŒæ­¥å‘é€"></a>åŒæ­¥å‘é€</h3><p> âœ… æœ€å¸¸ç”¨ã€æœ€å¯é  â€”â€” ç­‰å¾… Broker è¿”å›ç¡®è®¤ç»“æœã€‚  </p>
<h4 id="åŸºç¡€å‘é€ï¼ˆå­—ç¬¦ä¸²-å¯¹è±¡éƒ½å¯ï¼‰"><a href="#åŸºç¡€å‘é€ï¼ˆå­—ç¬¦ä¸²-å¯¹è±¡éƒ½å¯ï¼‰" class="headerlink" title="åŸºç¡€å‘é€ï¼ˆå­—ç¬¦ä¸²&#x2F;å¯¹è±¡éƒ½å¯ï¼‰"></a>åŸºç¡€å‘é€ï¼ˆå­—ç¬¦ä¸²&#x2F;å¯¹è±¡éƒ½å¯ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SendResult result = rocketMQTemplate.syncSend(&quot;test-topic&quot;, &quot;Hello RocketMQ!&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="å¸¦è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰"><a href="#å¸¦è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰" class="headerlink" title="å¸¦è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰"></a>å¸¦è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SendResult result = rocketMQTemplate.syncSend(&quot;test-topic&quot;, &quot;Hello RocketMQ!&quot;, 3000);</span><br></pre></td></tr></table></figure>

<h4 id="å‘é€å¸¦-Tag-çš„æ¶ˆæ¯"><a href="#å‘é€å¸¦-Tag-çš„æ¶ˆæ¯" class="headerlink" title="å‘é€å¸¦ Tag çš„æ¶ˆæ¯"></a>å‘é€å¸¦ Tag çš„æ¶ˆæ¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.syncSend(&quot;test-topic:TagA&quot;, &quot;Hello with TagA&quot;);</span><br></pre></td></tr></table></figure>

<p><code>Topic:Tag</code> æ˜¯ RocketMQ çš„è§„èŒƒå†™æ³•ï¼Œæ¶ˆè´¹è€…å¯ä»¥æŒ‰ Tag è¿‡æ»¤ã€‚  </p>
<h4 id="å‘é€å¸¦-Key-çš„æ¶ˆæ¯ï¼ˆæ–¹ä¾¿è¿½è¸ªï¼‰"><a href="#å‘é€å¸¦-Key-çš„æ¶ˆæ¯ï¼ˆæ–¹ä¾¿è¿½è¸ªï¼‰" class="headerlink" title="å‘é€å¸¦ Key çš„æ¶ˆæ¯ï¼ˆæ–¹ä¾¿è¿½è¸ªï¼‰"></a>å‘é€å¸¦ Key çš„æ¶ˆæ¯ï¼ˆæ–¹ä¾¿è¿½è¸ªï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;å¸¦Keyçš„æ¶ˆæ¯&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;orderId:1001&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">SendResult result = rocketMQTemplate.syncSend(&quot;test-topic&quot;, msg);</span><br></pre></td></tr></table></figure>

<h4 id="æ‰¹é‡å‘é€ï¼ˆå¤šæ¡åˆå¹¶ä¸€æ¬¡å‘é€ï¼‰"><a href="#æ‰¹é‡å‘é€ï¼ˆå¤šæ¡åˆå¹¶ä¸€æ¬¡å‘é€ï¼‰" class="headerlink" title="æ‰¹é‡å‘é€ï¼ˆå¤šæ¡åˆå¹¶ä¸€æ¬¡å‘é€ï¼‰"></a>æ‰¹é‡å‘é€ï¼ˆå¤šæ¡åˆå¹¶ä¸€æ¬¡å‘é€ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Message&lt;?&gt;&gt; msgs = Arrays.asList(</span><br><span class="line">    MessageBuilder.withPayload(&quot;msg-1&quot;).build(),</span><br><span class="line">    MessageBuilder.withPayload(&quot;msg-2&quot;).build()</span><br><span class="line">);</span><br><span class="line">SendResult result = rocketMQTemplate.syncSend(&quot;test-topic&quot;, msgs);</span><br></pre></td></tr></table></figure>

<h4 id="å¼‚æ­¥å‘é€"><a href="#å¼‚æ­¥å‘é€" class="headerlink" title="å¼‚æ­¥å‘é€"></a>å¼‚æ­¥å‘é€</h4><p> âœ… ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œé€‚åˆæ—¥å¿—ã€åŸ‹ç‚¹ã€é€šçŸ¥ç±»ä¸šåŠ¡ã€‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.asyncSend(&quot;test-topic&quot;, &quot;Async Message&quot;, new SendCallback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onSuccess(SendResult sendResult) &#123;</span><br><span class="line">        System.out.println(&quot;âœ… å¼‚æ­¥å‘é€æˆåŠŸï¼š&quot; + sendResult.getMsgId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onException(Throwable throwable) &#123;</span><br><span class="line">        System.err.println(&quot;âŒ å¼‚æ­¥å‘é€å¤±è´¥ï¼š&quot; + throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> ğŸ‘‰ å¸¦ Tag + Key çš„å¼‚æ­¥å‘é€  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;Async with Tag &amp; Key&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;userId:2025&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">rocketMQTemplate.asyncSend(&quot;test-topic:TagB&quot;, msg, new SendCallback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onSuccess(SendResult sendResult) &#123;</span><br><span class="line">        System.out.println(&quot;å¼‚æ­¥æˆåŠŸ: &quot; + sendResult);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onException(Throwable e) &#123;</span><br><span class="line">        System.err.println(&quot;å¼‚æ­¥å¤±è´¥: &quot; + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="å•å‘å‘å¸ƒ"><a href="#å•å‘å‘å¸ƒ" class="headerlink" title="å•å‘å‘å¸ƒ"></a>å•å‘å‘å¸ƒ</h4><p> âœ… ä¸ç­‰å¾…ç»“æœï¼Œæ€§èƒ½æœ€é«˜ï¼Œå¯é æ€§æœ€ä½ï¼›ç”¨äº <strong>æ—¥å¿—ä¸ŠæŠ¥ &#x2F; åŸ‹ç‚¹ç»Ÿè®¡</strong>ã€‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.sendOneWay(&quot;test-topic&quot;, &quot;OneWay message&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªå®šä¹‰å‘å¸ƒ"><a href="#è‡ªå®šä¹‰å‘å¸ƒ" class="headerlink" title="è‡ªå®šä¹‰å‘å¸ƒ"></a>è‡ªå®šä¹‰å‘å¸ƒ</h4><p> å¯è‡ªå®šä¹‰ header åœ¨æ¶ˆè´¹ç«¯è·å–ã€‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;å¸¦è‡ªå®šä¹‰headerçš„æ¶ˆæ¯&quot;)</span><br><span class="line">        .setHeader(&quot;X-Source&quot;, &quot;OrderService&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;key-001&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">rocketMQTemplate.syncSend(&quot;test-topic&quot;, msg);</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…ç«¯å¯ä»¥é€šè¿‡ <code>message.getHeaders().get(&quot;X-Source&quot;)</code> è·å–ã€‚</p>
<h3 id="æ¥å—æ¶ˆæ¯ï¼ˆæ¶ˆè´¹ç«¯ï¼‰"><a href="#æ¥å—æ¶ˆæ¯ï¼ˆæ¶ˆè´¹ç«¯ï¼‰" class="headerlink" title="æ¥å—æ¶ˆæ¯ï¼ˆæ¶ˆè´¹ç«¯ï¼‰"></a>æ¥å—æ¶ˆæ¯ï¼ˆæ¶ˆè´¹ç«¯ï¼‰</h3><p> RocketMQ æ¶ˆè´¹è€…é€šè¿‡ <strong>ç›‘å¬ Topic</strong> æ¥æ¥æ”¶æ¶ˆæ¯ã€‚Spring Boot ä¸­é€šå¸¸ä½¿ç”¨æ³¨è§£ï¼š<code>@RocketMQMessageListener</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">    topic = &quot;test-topic&quot;,               // è¦ç›‘å¬çš„ä¸»é¢˜</span><br><span class="line">    consumerGroup = &quot;test-consumer&quot;     // æ¶ˆè´¹è€…ç»„åï¼ˆå¦‚æœä¸¤ä¸ªæ¶ˆè´¹è€…ä½¿ç”¨ä¸åŒçš„æ¶ˆè´¹è€…ç»„åï¼Œå³ä½¿å®ƒä»¬ç›‘å¬çš„æ˜¯åŒä¸€ä¸ª Topicï¼Œ</span><br><span class="line">é‚£ä¹ˆå®ƒä»¬ä¹Ÿä¼šå„è‡ªç‹¬ç«‹åœ°æ¥æ”¶åˆ°æ‰€æœ‰æ¶ˆæ¯ï¼Œäº’ä¸å½±å“ã€‚ï¼‰</span><br><span class="line">)</span><br><span class="line">public class SimpleConsumer implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String message) &#123;</span><br><span class="line">        System.out.println(&quot;âœ… æ”¶åˆ°æ¶ˆæ¯ï¼š&quot; + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>RocketMQListener&lt;T&gt;</code> çš„æ³›å‹ <code>T</code> å†³å®šäº†æ¶ˆæ¯ä½“ååºåˆ—åŒ–æˆä»€ä¹ˆç±»å‹ï¼Œä¸€èˆ¬æ˜¯ <code>String</code> æˆ– <code>è‡ªå®šä¹‰å¯¹è±¡</code>ã€‚  </p>
<h4 id="æ¥æ”¶å¸¦-Tag-çš„æ¶ˆæ¯"><a href="#æ¥æ”¶å¸¦-Tag-çš„æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶å¸¦ Tag çš„æ¶ˆæ¯"></a>æ¥æ”¶å¸¦ Tag çš„æ¶ˆæ¯</h4><p> å¦‚æœç”Ÿäº§è€…å‘é€æ—¶ç”¨äº† Tagï¼ˆå¦‚ <code>test-topic:TagA</code>ï¼‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®šè¿‡æ»¤ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RocketMQMessageListener(</span><br><span class="line">    topic = &quot;test-topic&quot;,</span><br><span class="line">    consumerGroup = &quot;tagA-consumer&quot;,</span><br><span class="line">    selectorExpression = &quot;TagA&quot; // åªæ¥æ”¶TagAçš„æ¶ˆæ¯</span><br><span class="line">)</span><br><span class="line">public class TagAConsumer implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String msg) &#123;</span><br><span class="line">        System.out.println(&quot;æ”¶åˆ°TagAæ¶ˆæ¯ï¼š&quot; + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> æ”¯æŒè¡¨è¾¾å¼è¿‡æ»¤ï¼š<code>&quot;TagA || TagB&quot;</code>RocketMQ ä¼šåœ¨ Broker ç«¯è¿‡æ»¤ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ã€‚  </p>
<h4 id="æ¥æ”¶å¯¹è±¡æ¶ˆæ¯"><a href="#æ¥æ”¶å¯¹è±¡æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶å¯¹è±¡æ¶ˆæ¯"></a>æ¥æ”¶å¯¹è±¡æ¶ˆæ¯</h4><p> å¦‚æœå‘é€æ—¶ç”¨äº†å¯¹è±¡ï¼ˆæ¯”å¦‚ <code>User</code>ï¼‰ï¼Œæ¥æ”¶ç«¯å¯ä»¥ç›´æ¥ååºåˆ—åŒ–ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class User &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RocketMQMessageListener(topic = &quot;user-topic&quot;, consumerGroup = &quot;user-consumer&quot;)</span><br><span class="line">public class UserConsumer implements RocketMQListener&lt;User&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(User user) &#123;</span><br><span class="line">        System.out.println(&quot;æ”¶åˆ°Useræ¶ˆæ¯ï¼š&quot; + user.getName() + &quot; - &quot; + user.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç›‘å¬æ›´å¤šç»†èŠ‚"><a href="#ç›‘å¬æ›´å¤šç»†èŠ‚" class="headerlink" title="ç›‘å¬æ›´å¤šç»†èŠ‚"></a>ç›‘å¬æ›´å¤šç»†èŠ‚</h3><table>
<thead>
<tr>
<th>å±æ€§å</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>topic</code></td>
<td>ä¸»é¢˜å</td>
<td><code>&quot;order-topic&quot;</code></td>
</tr>
<tr>
<td><code>consumerGroup</code></td>
<td>æ¶ˆè´¹è€…ç»„åï¼ˆåŒç»„å…±äº«æ¶ˆè´¹ï¼‰</td>
<td><code>&quot;order-group&quot;</code></td>
</tr>
<tr>
<td><code>selectorExpression</code></td>
<td>Tag è¿‡æ»¤</td>
<td>&#96;â€TagA</td>
</tr>
<tr>
<td><code>consumeMode</code></td>
<td>æ¶ˆè´¹æ¨¡å¼ï¼ˆå¹¶å‘ &#x2F; é¡ºåºï¼‰</td>
<td><code>ConsumeMode.CONCURRENTLY</code></td>
</tr>
<tr>
<td><code>messageModel</code></td>
<td>é›†ç¾¤&#x2F;å¹¿æ’­æ¨¡å¼</td>
<td><code>MessageModel.CLUSTERING</code><br/> or <code>BROADCASTING</code></td>
</tr>
</tbody></table>
<h3 id="ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„åï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„åï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„åï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„åï¼Ÿ</h3><p><strong>å®šä¹‰ï¼š</strong><br>æ¶ˆè´¹è€…ç»„æ˜¯ <strong>ä¸€ç»„æ¶ˆè´¹ç›¸åŒ Topicã€å…·æœ‰ç›¸åŒæ¶ˆè´¹é€»è¾‘çš„æ¶ˆè´¹è€…å®ä¾‹</strong> çš„é›†åˆã€‚RocketMQ ä»¥ç»„ä¸ºå•ä½è¿›è¡Œæ¶ˆæ¯åˆ†é…å’Œæ¶ˆè´¹è¿›åº¦ç®¡ç†ã€‚</p>
<table>
<thead>
<tr>
<th>ç»„å…³ç³» \ æ¶ˆè´¹æ¨¡å¼</th>
<th><strong>é›†ç¾¤æ¨¡å¼ï¼ˆCLUSTERINGï¼Œé»˜è®¤ï¼‰</strong></th>
<th><strong>å¹¿æ’­æ¨¡å¼ï¼ˆBROADCASTINGï¼‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>åŒä¸€ç»„å</strong></td>
<td><strong>ç»„å†…åˆ†æ‘Š</strong>ï¼šæ¯æ¡æ¶ˆæ¯åªè¢«ç»„å†…<strong>ä¸€ä¸ªå®ä¾‹</strong>æ¶ˆè´¹ä¸€æ¬¡ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ã€‚</td>
<td><strong>ç»„å†…å…¨å‘˜éƒ½æ”¶</strong>ï¼šç»„å†…<strong>æ¯ä¸ªå®ä¾‹</strong>éƒ½ä¼šæ”¶åˆ°<strong>å…¨éƒ¨æ¶ˆæ¯</strong>ã€‚</td>
</tr>
<tr>
<td><strong>ä¸åŒç»„å</strong></td>
<td><strong>å„ç»„ç‹¬ç«‹åˆ†æ‘Š</strong>ï¼šæ¯ä¸ªç»„éƒ½ä¼šå„è‡ªæ”¶åˆ°<strong>å…¨é‡æ¶ˆæ¯çš„ä¸€ä»½</strong>ï¼Œå¹¶åœ¨ç»„å†…å†åšè´Ÿè½½å‡è¡¡ã€‚</td>
<td><strong>å„ç»„å…¨å‘˜éƒ½æ”¶</strong>ï¼šæ¯ä¸ªç»„ã€ç»„å†…æ¯ä¸ªå®ä¾‹ï¼Œéƒ½ä¼šæ”¶åˆ°<strong>å…¨éƒ¨æ¶ˆæ¯</strong>ï¼ˆç­‰äºå¤šä»½å¹¿æ’­ï¼‰ã€‚</td>
</tr>
</tbody></table>
<p>ä¸¾ä¾‹è¯´æ˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Aç»„ï¼šè®¢å•ç³»ç»Ÿ</span><br><span class="line">@RocketMQMessageListener(topic = &quot;order-topic&quot;, consumerGroup = &quot;order-group&quot;)</span><br><span class="line"></span><br><span class="line">// Bç»„ï¼šç§¯åˆ†ç³»ç»Ÿ</span><br><span class="line">@RocketMQMessageListener(topic = &quot;order-topic&quot;, consumerGroup = &quot;point-group&quot;)</span><br></pre></td></tr></table></figure>

<p>åŒä¸€ä¸ª Topicï¼ˆ<code>order-topic</code>ï¼‰ï¼š</p>
<ul>
<li><code>order-group</code> è´Ÿè´£æ›´æ–°è®¢å•çŠ¶æ€</li>
<li><code>point-group</code> è´Ÿè´£åŠ ç§¯åˆ†</li>
</ul>
<p>âœ… ä¸¤ä¸ªç»„äº’ä¸å½±å“ï¼Œéƒ½èƒ½å„è‡ªæ”¶åˆ°æ‰€æœ‰è®¢å•æ¶ˆæ¯ã€‚</p>
<h3 id="æ¶ˆè´¹æ¨¡å¼åŒºåˆ«"><a href="#æ¶ˆè´¹æ¨¡å¼åŒºåˆ«" class="headerlink" title="æ¶ˆè´¹æ¨¡å¼åŒºåˆ«"></a>æ¶ˆè´¹æ¨¡å¼åŒºåˆ«</h3><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>ç‰¹ç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é›†ç¾¤æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</strong></td>
<td>å¤šä¸ªæ¶ˆè´¹è€…åˆ†æ‘Šæ¶ˆæ¯</td>
<td>æ™®é€šæ¶ˆæ¯å¤„ç†ï¼ˆå¹¶å‘é«˜ï¼‰</td>
</tr>
<tr>
<td><strong>å¹¿æ’­æ¨¡å¼</strong></td>
<td>æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°åŒæ ·çš„æ¶ˆæ¯</td>
<td>ç³»ç»Ÿé…ç½®åŒæ­¥ã€ç¼“å­˜æ›´æ–°ç­‰</td>
</tr>
</tbody></table>
<h2 id="é¡ºåºæ¶ˆæ¯"><a href="#é¡ºåºæ¶ˆæ¯" class="headerlink" title="é¡ºåºæ¶ˆæ¯"></a>é¡ºåºæ¶ˆæ¯</h2><h3 id="âœ…-åœºæ™¯ä¸ç‰¹æ€§"><a href="#âœ…-åœºæ™¯ä¸ç‰¹æ€§" class="headerlink" title="âœ… åœºæ™¯ä¸ç‰¹æ€§"></a>âœ… åœºæ™¯ä¸ç‰¹æ€§</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šä¿è¯åŒä¸€ä¸šåŠ¡æ ‡è¯†ï¼ˆå¦‚åŒä¸€è®¢å•ï¼‰ä¸‹çš„æ¶ˆæ¯ä¸¥æ ¼æŒ‰é¡ºåºå‘é€ä¸æ¶ˆè´¹ã€‚</li>
<li><strong>åŸç†</strong>ï¼šå°†ç›¸åŒä¸šåŠ¡ Key çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ã€‚</li>
<li><strong>å…¸å‹åœºæ™¯</strong>ï¼šè®¢å•çŠ¶æ€æµè½¬ï¼ˆåˆ›å»º â†’ æ”¯ä»˜ â†’ å‘è´§ â†’ æ”¶è´§ï¼‰ã€äº¤æ˜“æµæ°´ç­‰ã€‚</li>
</ul>
<h3 id="sharding-key-å’Œ-message-key"><a href="#sharding-key-å’Œ-message-key" class="headerlink" title="sharding key å’Œ message key"></a><code>sharding key</code> å’Œ <code>message key</code></h3><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>**message key**</code></td>
<td>æ¶ˆæ¯çš„ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥è¿½è¸ªã€æ’æŸ¥ã€‚</td>
<td><code>orderId_1001</code></td>
</tr>
<tr>
<td><code>**sharding key**</code></td>
<td>æ¶ˆæ¯<strong>åˆ†åŒºè·¯ç”±ä¾æ®</strong>ï¼Œå†³å®šæ¶ˆæ¯è¿›å“ªä¸ªé˜Ÿåˆ—ã€‚</td>
<td><code>orderId_1001</code></td>
</tr>
</tbody></table>
<p>åŒºåˆ«è§£æ</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>message key</th>
<th>sharding key</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨å±‚é¢</td>
<td>ä¸šåŠ¡è¿½è¸ª</td>
<td>é¡ºåºæŠ•é€’</td>
</tr>
<tr>
<td>è®¾ç½®æ–¹å¼</td>
<td>é€šè¿‡ <code>RocketMQHeaders.KEYS</code><br/> è®¾ç½®</td>
<td>ä½œä¸º <code>syncSendOrderly()</code><br/> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥</td>
</tr>
<tr>
<td>ä½¿ç”¨è€…</td>
<td>è¿ç»´ &#x2F; å¼€å‘æŸ¥æ¶ˆæ¯ç”¨</td>
<td>Broker ç”¨äºè®¡ç®—é˜Ÿåˆ—ç´¢å¼•</td>
</tr>
<tr>
<td>æ˜¯å¦å¿…é¡»</td>
<td>å¦ï¼ˆå»ºè®®åŠ ï¼‰</td>
<td>æ˜¯ï¼ˆé¡ºåºæ¶ˆæ¯å¿…é¡»è¦ï¼‰</td>
</tr>
<tr>
<td>ç¤ºä¾‹</td>
<td><code>&quot;orderId:1001&quot;</code></td>
<td><code>&quot;orderId_1001&quot;</code></td>
</tr>
</tbody></table>
<p>ä¸¾ä¾‹è¯´æ˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é¡ºåºæ¶ˆæ¯å‘é€</span><br><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;è®¢å•åˆ›å»º&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;orderId:1001&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">rocketMQTemplate.syncSendOrderly(&quot;order-topic&quot;, msg, &quot;orderId_1001&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>KEYS</code> â†’ ç”¨äºæ—¥å¿—è¿½è¸ªï¼Œæ¯”å¦‚ä½ æŸ¥æ—¥å¿—æ—¶å¯ç”¨ <code>mqadmin queryMsgByKey -k orderId:1001</code>ã€‚</li>
<li><code>sharding key</code> â†’ ç”¨äº<strong>å†³å®šæ¶ˆæ¯è¿›å…¥å“ªä¸ªé˜Ÿåˆ—</strong>ï¼ŒBroker ä¼šé€šè¿‡å®ƒè®¡ç®—å“ˆå¸Œï¼Œè®©ç›¸åŒ key çš„æ¶ˆæ¯è¿›å…¥åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œä»è€Œä¿è¯é¡ºåºã€‚</li>
</ul>
<h3 id="é¡ºåºå‘é€ï¼ˆåŒæ­¥ï¼‰"><a href="#é¡ºåºå‘é€ï¼ˆåŒæ­¥ï¼‰" class="headerlink" title="é¡ºåºå‘é€ï¼ˆåŒæ­¥ï¼‰"></a>é¡ºåºå‘é€ï¼ˆåŒæ­¥ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å‘é€é¡ºåºæ¶ˆæ¯ï¼ˆåŒæ­¥ï¼‰</span><br><span class="line">rocketMQTemplate.syncSendOrderly(</span><br><span class="line">    &quot;order-topic&quot;,       // Topic</span><br><span class="line">    &quot;åˆ›å»ºè®¢å•æ¶ˆæ¯&quot;,        // æ¶ˆæ¯ä½“</span><br><span class="line">    &quot;orderId_1001&quot;       // Sharding Keyï¼ˆåˆ†ç‰‡é”®ï¼‰</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="é¡ºåºå‘é€ï¼ˆå¼‚æ­¥ï¼‰"><a href="#é¡ºåºå‘é€ï¼ˆå¼‚æ­¥ï¼‰" class="headerlink" title="é¡ºåºå‘é€ï¼ˆå¼‚æ­¥ï¼‰"></a>é¡ºåºå‘é€ï¼ˆå¼‚æ­¥ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.asyncSendOrderly(</span><br><span class="line">    &quot;order-topic&quot;,</span><br><span class="line">    &quot;æ”¯ä»˜å®Œæˆæ¶ˆæ¯&quot;,</span><br><span class="line">    &quot;orderId_1001&quot;,     // Sharding Key</span><br><span class="line">    new SendCallback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onSuccess(SendResult sendResult) &#123;</span><br><span class="line">            System.out.println(&quot;âœ… å¼‚æ­¥é¡ºåºæ¶ˆæ¯å‘é€æˆåŠŸï¼š&quot; + sendResult.getMsgId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onException(Throwable e) &#123;</span><br><span class="line">            System.err.println(&quot;âŒ å¼‚æ­¥é¡ºåºæ¶ˆæ¯å‘é€å¤±è´¥ï¼š&quot; + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="å»¶æ—¶æ¶ˆæ¯"><a href="#å»¶æ—¶æ¶ˆæ¯" class="headerlink" title="å»¶æ—¶æ¶ˆæ¯"></a>å»¶æ—¶æ¶ˆæ¯</h2><h3 id="âœ…-åœºæ™¯ä¸ç‰¹æ€§-1"><a href="#âœ…-åœºæ™¯ä¸ç‰¹æ€§-1" class="headerlink" title="âœ… åœºæ™¯ä¸ç‰¹æ€§"></a>âœ… åœºæ™¯ä¸ç‰¹æ€§</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šè®©æ¶ˆæ¯åœ¨å‘é€åå»¶è¿Ÿä¸€æ®µæ—¶é—´æ‰è¢«æ¶ˆè´¹è€…çœ‹åˆ°ã€‚</li>
<li><strong>å…¸å‹åœºæ™¯</strong>ï¼š<ul>
<li>è®¢å•è¶…æ—¶æœªæ”¯ä»˜ â†’ è‡ªåŠ¨å–æ¶ˆ</li>
<li>ä¼šå‘˜å³å°†åˆ°æœŸ â†’ æå‰æé†’</li>
<li>æ”¯ä»˜ç»“æœå›è°ƒ â†’ å»¶æ—¶è¡¥å¿</li>
</ul>
</li>
</ul>
<p>ğŸ’¡ å»¶æ—¶æ¶ˆæ¯åœ¨ Broker ç«¯ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œåˆ°æœŸåå†æŠ•é€’ç»™çœŸæ­£çš„ Topicã€‚</p>
<h3 id="å»¶æ—¶æ¶ˆæ¯å‘é€ï¼ˆåŒæ­¥ï¼‰"><a href="#å»¶æ—¶æ¶ˆæ¯å‘é€ï¼ˆåŒæ­¥ï¼‰" class="headerlink" title="å»¶æ—¶æ¶ˆæ¯å‘é€ï¼ˆåŒæ­¥ï¼‰"></a>å»¶æ—¶æ¶ˆæ¯å‘é€ï¼ˆåŒæ­¥ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å‘é€å»¶æ—¶æ¶ˆæ¯</span><br><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;å»¶æ—¶æ¶ˆæ¯ï¼š30ç§’åæ‰§è¡Œ&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;orderId:1001&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">// å»¶æ—¶ç­‰çº§è®¾ç½®ï¼ˆ1~18ï¼‰</span><br><span class="line">SendResult result = rocketMQTemplate.syncSend(</span><br><span class="line">    &quot;delay-topic&quot;, msg, 3000, 3 // ç¬¬4ä¸ªå‚æ•°æ˜¯å»¶æ—¶ç­‰çº§ level=3</span><br><span class="line">);</span><br><span class="line">System.out.println(&quot;âœ… å»¶æ—¶æ¶ˆæ¯å‘é€æˆåŠŸï¼š&quot; + result.getMsgId());</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ç­‰çº§</th>
<th>å»¶æ—¶æ—¶é—´</th>
<th>ç­‰çº§</th>
<th>å»¶æ—¶æ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1s</td>
<td>10</td>
<td>10m</td>
</tr>
<tr>
<td>2</td>
<td>5s</td>
<td>11</td>
<td>20m</td>
</tr>
<tr>
<td>3</td>
<td>10s</td>
<td>12</td>
<td>30m</td>
</tr>
<tr>
<td>4</td>
<td>30s</td>
<td>13</td>
<td>1h</td>
</tr>
<tr>
<td>5</td>
<td>1m</td>
<td>14</td>
<td>2h</td>
</tr>
<tr>
<td>6</td>
<td>2m</td>
<td>15</td>
<td>3h</td>
</tr>
<tr>
<td>7</td>
<td>3m</td>
<td>16</td>
<td>4h</td>
</tr>
<tr>
<td>8</td>
<td>4m</td>
<td>17</td>
<td>5h</td>
</tr>
<tr>
<td>9</td>
<td>5m</td>
<td>18</td>
<td>6h</td>
</tr>
</tbody></table>
<p> âš™ï¸ å¯ä»¥é€šè¿‡ <code>broker.conf</code> é…ç½®é¡¹ <code>messageDelayLevel</code> è‡ªå®šä¹‰å»¶æ—¶ç­‰çº§ã€‚  </p>
<p><strong>RocketMQ é»˜è®¤çš„å»¶æ—¶æœºåˆ¶æ˜¯â€œç­‰çº§åˆ¶ï¼ˆLevel-Basedï¼‰â€çš„</strong>ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ä½¿ç”¨éå†…ç½®çš„å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯”å¦‚ 45 åˆ†é’Ÿã€7 ç§’ã€2 å¤©ï¼‰ï¼Œ<strong>å¿…é¡»åœ¨ Broker ç«¯é…ç½®è‡ªå®šä¹‰å»¶æ—¶ç­‰çº§ã€‚</strong></p>
<h3 id="å¼‚æ­¥å»¶æ—¶æ¶ˆæ¯"><a href="#å¼‚æ­¥å»¶æ—¶æ¶ˆæ¯" class="headerlink" title="å¼‚æ­¥å»¶æ—¶æ¶ˆæ¯"></a>å¼‚æ­¥å»¶æ—¶æ¶ˆæ¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;å¼‚æ­¥å»¶æ—¶æ¶ˆæ¯&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;task:2025&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">rocketMQTemplate.asyncSend(&quot;delay-topic&quot;, msg, new SendCallback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onSuccess(SendResult sendResult) &#123;</span><br><span class="line">        System.out.println(&quot;âœ… å¼‚æ­¥å»¶æ—¶å‘é€æˆåŠŸï¼š&quot; + sendResult.getMsgId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onException(Throwable e) &#123;</span><br><span class="line">        System.err.println(&quot;âŒ å¼‚æ­¥å»¶æ—¶å‘é€å¤±è´¥ï¼š&quot; + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, 5000, 5); // è¶…æ—¶5sï¼Œå»¶æ—¶ç­‰çº§5ï¼ˆ1åˆ†é’Ÿï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="äº‹åŠ¡æ¶ˆæ¯"><a href="#äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="äº‹åŠ¡æ¶ˆæ¯"></a>äº‹åŠ¡æ¶ˆæ¯</h2><h3 id="âœ…-åœºæ™¯ä¸ç‰¹æ€§-2"><a href="#âœ…-åœºæ™¯ä¸ç‰¹æ€§-2" class="headerlink" title="âœ… åœºæ™¯ä¸ç‰¹æ€§"></a>âœ… åœºæ™¯ä¸ç‰¹æ€§</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šä¿è¯æ¶ˆæ¯ä¸æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
<li><strong>å…¸å‹åœºæ™¯</strong>ï¼š<ul>
<li>ä¸‹å•æˆåŠŸ â†’ æ‰£å‡åº“å­˜</li>
<li>æ”¯ä»˜å®Œæˆ â†’ æ›´æ–°è®¢å•çŠ¶æ€</li>
<li>åˆ›å»ºè®¢å• â†’ å‘é€ç§¯åˆ†å¥–åŠ±</li>
</ul>
</li>
</ul>
<p>ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼š<strong>æœ¬åœ°äº‹åŠ¡ + æ¶ˆæ¯å‘é€ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</strong></p>
<h3 id="å‘é€äº‹åŠ¡æ¶ˆæ¯"><a href="#å‘é€äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="å‘é€äº‹åŠ¡æ¶ˆæ¯"></a>å‘é€äº‹åŠ¡æ¶ˆæ¯</h3><p> äº‹åŠ¡æ¶ˆæ¯ä½¿ç”¨ä¸“é—¨çš„ç”Ÿäº§è€…ï¼š<code>TransactionMQProducer</code>æˆ–åœ¨ SpringBoot åœºæ™¯ä¸‹ä½¿ç”¨ï¼š<code>rocketMQTemplate.sendMessageInTransaction()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// å‘é€äº‹åŠ¡æ¶ˆæ¯</span><br><span class="line">Message&lt;String&gt; msg = MessageBuilder.withPayload(&quot;äº‹åŠ¡æ¶ˆæ¯ï¼šåˆ›å»ºè®¢å•&quot;)</span><br><span class="line">        .setHeader(RocketMQHeaders.KEYS, &quot;orderId:1001&quot;)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">// ç¬¬ä¸‰ä¸ªå‚æ•° arg ä¼šä¼ å…¥æœ¬åœ°äº‹åŠ¡æ‰§è¡Œæ–¹æ³•ä¸­</span><br><span class="line">TransactionSendResult result = rocketMQTemplate.sendMessageInTransaction(</span><br><span class="line">        &quot;tx-producer-group&quot;,</span><br><span class="line">        &quot;tx-topic&quot;,</span><br><span class="line">        msg,</span><br><span class="line">        &quot;arg-info&quot;</span><br><span class="line">);</span><br><span class="line">System.out.println(&quot;âœ… äº‹åŠ¡æ¶ˆæ¯å‘é€ç»“æœï¼š&quot; + result.getSendStatus());</span><br></pre></td></tr></table></figure>

<h3 id="æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸å›æŸ¥"><a href="#æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸å›æŸ¥" class="headerlink" title="æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸å›æŸ¥"></a>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸å›æŸ¥</h3><p> äº‹åŠ¡æ¶ˆæ¯åˆ†ä¸º <strong>ä¸‰æ­¥èµ°</strong> ğŸ‘‡  </p>
<table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>â‘  åŠæ¶ˆæ¯ï¼ˆHalf Messageï¼‰</strong></td>
<td>å…ˆå‘é€åˆ° Brokerï¼Œä½†æ¶ˆè´¹è€…æš‚æ—¶ä¸å¯è§ã€‚</td>
</tr>
<tr>
<td><strong>â‘¡ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</strong></td>
<td>åœ¨ç”Ÿäº§è€…æœ¬åœ°æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ‰£æ¬¾ã€è½åº“ï¼‰ã€‚</td>
</tr>
<tr>
<td><strong>â‘¢ Broker å›æŸ¥</strong></td>
<td>å¦‚æœç”Ÿäº§è€…æœªæ˜ç¡®æäº¤æˆ–å›æ»šï¼ŒBroker ä¼šå®šæ—¶å›æŸ¥äº‹åŠ¡çŠ¶æ€ã€‚</td>
</tr>
</tbody></table>
<h3 id="äº‹åŠ¡ç›‘å¬å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰"><a href="#äº‹åŠ¡ç›‘å¬å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰" class="headerlink" title="äº‹åŠ¡ç›‘å¬å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰"></a>äº‹åŠ¡ç›‘å¬å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰</h3><p> å®ç° <code>RocketMQLocalTransactionListener</code> æ¥å£ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@RocketMQTransactionListener(txProducerGroup = &quot;tx-producer-group&quot;)</span><br><span class="line">public class OrderTransactionListener implements RocketMQLocalTransactionListener &#123;</span><br><span class="line"></span><br><span class="line">    // Step 2: æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span><br><span class="line">    @Override</span><br><span class="line">    public RocketMQLocalTransactionState executeLocalTransaction(Message msg, Object arg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println(&quot;æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œarg=&quot; + arg);</span><br><span class="line">            // TODO: è¿™é‡Œå†™ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚è®¢å•å…¥åº“ã€æ‰£å‡åº“å­˜ç­‰</span><br><span class="line">            return RocketMQLocalTransactionState.COMMIT; // æäº¤æ¶ˆæ¯</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return RocketMQLocalTransactionState.ROLLBACK; // å›æ»šæ¶ˆæ¯</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Step 3: Broker å›æŸ¥äº‹åŠ¡çŠ¶æ€</span><br><span class="line">    @Override</span><br><span class="line">    public RocketMQLocalTransactionState checkLocalTransaction(Message msg) &#123;</span><br><span class="line">        System.out.println(&quot;Broker æ­£åœ¨å›æŸ¥äº‹åŠ¡çŠ¶æ€...&quot;);</span><br><span class="line">        // æ ¹æ®ä¸šåŠ¡è¡¨çŠ¶æ€åˆ¤æ–­</span><br><span class="line">        boolean success = true; // TODO æŸ¥è¯¢æ•°æ®åº“æˆ–ç¼“å­˜çŠ¶æ€</span><br><span class="line">        return success ? RocketMQLocalTransactionState.COMMIT : RocketMQLocalTransactionState.ROLLBACK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¥å—æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ï¼ˆå’Œæ™®é€šæ¶ˆæ¯ä¸€æ ·ï¼‰"><a href="#æ¥å—æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ï¼ˆå’Œæ™®é€šæ¶ˆæ¯ä¸€æ ·ï¼‰" class="headerlink" title="æ¥å—æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ï¼ˆå’Œæ™®é€šæ¶ˆæ¯ä¸€æ ·ï¼‰"></a>æ¥å—æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ï¼ˆå’Œæ™®é€šæ¶ˆæ¯ä¸€æ ·ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RocketMQMessageListener(topic = &quot;tx-topic&quot;, consumerGroup = &quot;tx-consumer-group&quot;)</span><br><span class="line">public class TxConsumer implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String message) &#123;</span><br><span class="line">        System.out.println(&quot;âœ… æ”¶åˆ°äº‹åŠ¡æ¶ˆæ¯ï¼š&quot; + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ğŸš© æ¶ˆè´¹è€…åªä¼šæ¥æ”¶åˆ°äº‹åŠ¡<strong>æœ€ç»ˆæäº¤æˆåŠŸ</strong>çš„æ¶ˆæ¯ã€‚  </p>
<h3 id="äº‹åŠ¡çŠ¶æ€æšä¸¾"><a href="#äº‹åŠ¡çŠ¶æ€æšä¸¾" class="headerlink" title="äº‹åŠ¡çŠ¶æ€æšä¸¾"></a>äº‹åŠ¡çŠ¶æ€æšä¸¾</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redission/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redission/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸€-redission-çš„åˆ†å¸ƒå¼é”ç±»å‹"><a href="#ä¸€-redission-çš„åˆ†å¸ƒå¼é”ç±»å‹" class="headerlink" title="ä¸€.redission çš„åˆ†å¸ƒå¼é”ç±»å‹"></a>ä¸€.redission çš„åˆ†å¸ƒå¼é”ç±»å‹</h1><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç±»å</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>æ™®é€šå¯é‡å…¥é”</td>
<td><code>RLock</code></td>
<td>æ”¯æŒåŒä¸€çº¿ç¨‹é‡å…¥ï¼Œæœ€å¸¸ç”¨</td>
</tr>
<tr>
<td>å…¬å¹³é”</td>
<td><code>RFairLock</code></td>
<td>æŒ‰ç”³è¯·é¡ºåºè·å¾—é”</td>
</tr>
<tr>
<td>è¯»å†™é”</td>
<td><code>RReadWriteLock</code></td>
<td>è¯»å…±äº«ã€å†™äº’æ–¥</td>
</tr>
<tr>
<td>è”é”</td>
<td><code>RedissonMultiLock</code></td>
<td>å¤šä¸ªèµ„æºé”ç»‘å®šåœ¨ä¸€èµ·</td>
</tr>
<tr>
<td>çº¢é”ï¼ˆRedLockï¼‰</td>
<td><code>RedissonRedLock</code></td>
<td>å¤šå®ä¾‹ Redis èŠ‚ç‚¹å®¹é”™é”ï¼ˆç”¨äºé«˜å¯é é›†ç¾¤ï¼‰</td>
</tr>
</tbody></table>
<h1 id="äºŒ-åŸºæœ¬ä½¿ç”¨ï¼ˆå®æˆ˜ï¼‰"><a href="#äºŒ-åŸºæœ¬ä½¿ç”¨ï¼ˆå®æˆ˜ï¼‰" class="headerlink" title="äºŒ.åŸºæœ¬ä½¿ç”¨ï¼ˆå®æˆ˜ï¼‰"></a>äºŒ.åŸºæœ¬ä½¿ç”¨ï¼ˆå®æˆ˜ï¼‰</h1><h2 id="RLock"><a href="#RLock" class="headerlink" title="RLock"></a>RLock</h2><h3 id="è·å–é”"><a href="#è·å–é”" class="headerlink" title="è·å–é”"></a>è·å–é”</h3><p>RLock lock &#x3D; redissonClient.getLock(â€œproduct:123â€);</p>
<br/>

<p> â€œproduct:123â€ å°±æ˜¯é”çš„ Keyï¼Œå¤šä¸ªæœåŠ¡è®¿é—®åŒä¸€ä¸ª Key å°±ä¼šç«äº‰åŒä¸€æŠŠé”ã€‚  </p>
<h3 id="åŠ é”ï¼ˆé˜»å¡å¼ï¼‰"><a href="#åŠ é”ï¼ˆé˜»å¡å¼ï¼‰" class="headerlink" title="åŠ é”ï¼ˆé˜»å¡å¼ï¼‰"></a>åŠ é”ï¼ˆé˜»å¡å¼ï¼‰</h3><p>lock.lock(); &#x2F;&#x2F; ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°è·å¾—é”</p>
<p>try {</p>
<pre><code>// æ‰§è¡Œä¸šåŠ¡é€»è¾‘
</code></pre>
<p>} finally {</p>
<pre><code>lock.unlock(); // æœ€ååŠ¡å¿…é‡Šæ”¾é”
</code></pre>
<p>}</p>
<br/>

<p>ğŸ‘‰ åº•å±‚åŸç†ï¼š</p>
<ul>
<li>Redisson ä¼šå‘ Redis å†™å…¥ä¸€æ¡é”®ï¼š<code>product:123 -&gt; {uuid + threadId}</code></li>
<li>åŒä¸€çº¿ç¨‹å¯é‡å…¥ï¼šRedisson åœ¨ value ä¸­ç»´æŠ¤é‡å…¥æ¬¡æ•°è®¡æ•°</li>
<li>å½“åŠ é”æœªæŒ‡å®šè¶…æ—¶æ—¶é—´æ—¶ï¼ŒRedisson ä¼šé»˜è®¤è®¾ç½® 30 ç§’çš„è¿‡æœŸæ—¶é—´å¹¶å¯åŠ¨çœ‹é—¨ç‹—æœºåˆ¶ï¼Œè‡ªåŠ¨ç»­æœŸä»¥é˜²é”è¿‡æœŸï¼›<br>è‹¥æ˜ç¡®æŒ‡å®šäº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™ä¸ä¼šå¯ç”¨çœ‹é—¨ç‹—ï¼Œé”ä¼šåœ¨æŒ‡å®šæ—¶é—´åˆ°æœŸåè‡ªåŠ¨é‡Šæ”¾ã€‚</li>
</ul>
<h3 id="è®¾ç½®è¶…æ—¶æ—¶é—´"><a href="#è®¾ç½®è¶…æ—¶æ—¶é—´" class="headerlink" title="è®¾ç½®è¶…æ—¶æ—¶é—´"></a>è®¾ç½®è¶…æ—¶æ—¶é—´</h3><p>lock.lock(10, TimeUnit.SECONDS); </p>
<br/>

<p>è¡¨ç¤ºï¼š</p>
<ul>
<li>æœ€å¤šæŒæœ‰é” 10 ç§’</li>
<li>ä¸ä¼šè‡ªåŠ¨ç»­æœŸï¼ˆâš ï¸ä¸ä¼šè§¦å‘â€œçœ‹é—¨ç‹—â€ï¼‰</li>
</ul>
<p>é€‚ç”¨äºä»»åŠ¡å¾ˆçŸ­çš„æƒ…å†µï¼Œå¦åˆ™å¯èƒ½ä¸­é€”è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<h3 id="å°è¯•åŠ é”ï¼ˆtryLockï¼‰"><a href="#å°è¯•åŠ é”ï¼ˆtryLockï¼‰" class="headerlink" title="å°è¯•åŠ é”ï¼ˆtryLockï¼‰"></a>å°è¯•åŠ é”ï¼ˆtryLockï¼‰</h3><p>if (lock.tryLock(5, 30, TimeUnit.SECONDS)) {</p>
<pre><code>try {

    // æˆåŠŸè·å¾—é”ï¼Œæ‰§è¡Œé€»è¾‘

} finally {

    lock.unlock();

}
</code></pre>
<p>} else {</p>
<pre><code>// è·å–å¤±è´¥çš„å¤„ç†é€»è¾‘
</code></pre>
<p>}</p>
<br/>

<p>è§£é‡Šï¼š</p>
<ul>
<li>ç­‰å¾…æ—¶é—´ï¼š5 ç§’ï¼ˆåˆ«äººæŒæœ‰é”æ—¶æœ€å¤šç­‰ 5 ç§’ï¼‰</li>
<li>é”è¶…æ—¶ï¼š30 ç§’åè‡ªåŠ¨é‡Šæ”¾</li>
</ul>
<h1 id="ä¸‰-å®ç°åŸç†"><a href="#ä¸‰-å®ç°åŸç†" class="headerlink" title="ä¸‰.å®ç°åŸç†"></a>ä¸‰.å®ç°åŸç†</h1><h2 id="æ ¸å¿ƒæ€è·¯ï¼ˆSETNX-å®ç°é”ï¼‰"><a href="#æ ¸å¿ƒæ€è·¯ï¼ˆSETNX-å®ç°é”ï¼‰" class="headerlink" title="æ ¸å¿ƒæ€è·¯ï¼ˆSETNX å®ç°é”ï¼‰"></a>æ ¸å¿ƒæ€è·¯ï¼ˆSETNX å®ç°é”ï¼‰</h2><ul>
<li>åŠ é” &#x3D; åœ¨ Redis ä¸­å†™å…¥ä¸€ä¸ª Keyï¼›</li>
<li>è§£é” &#x3D; åˆ é™¤è¿™ä¸ª Keyã€‚  </li>
<li>setnxå‘½ä»¤å½“keyå­˜åœ¨æ—¶æ’å…¥ä¸å­˜åœ¨æ—¶æŠ¥é”™</li>
</ul>
<p> åŠ é”å‘½ä»¤ï¼š  SET lock:order 12345 NX PX 30000</p>
<br/>

<p>è§£é‡Šï¼š</p>
<ul>
<li><code>lock:order</code>ï¼šé”å</li>
<li><code>12345</code>ï¼šå”¯ä¸€æ ‡è¯†ï¼ˆä»£è¡¨æŸä¸ªçº¿ç¨‹ï¼‰</li>
<li><code>NX</code>ï¼šåªåœ¨ key ä¸å­˜åœ¨æ—¶æ‰æˆåŠŸï¼ˆé˜²æ­¢å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶åŠ é”ï¼‰</li>
<li><code>PX 30000</code>ï¼šé”è¿‡æœŸæ—¶é—´ 30 ç§’ï¼ˆé˜²æ­¢æ­»é”ï¼‰</li>
</ul>
<p>è¿”å›ç»“æœï¼š</p>
<ul>
<li>å¦‚æœè¿”å› OK â†’ è·å–é”æˆåŠŸ</li>
<li>å¦‚æœè¿”å› null â†’ é”è¢«åˆ«äººå ç”¨</li>
</ul>
<p>è§£é”å‘½ä»¤ï¼ˆé‡Šæ”¾é”ï¼‰: è§£é”æ—¶ä¸èƒ½ç›´æ¥ <code>DEL key</code>ï¼Œå¦åˆ™å¯èƒ½è¯¯åˆ åˆ«äººçš„é”ï¼ˆæ¯”å¦‚é”è¿‡æœŸè¢«åˆ«äººæŠ¢èµ°ï¼‰ã€‚  </p>
<br/>

<p><strong>æ­£ç¡®åšæ³•ï¼š</strong></p>
<ol>
<li>å…ˆå–å‡º key çš„ valueï¼›</li>
<li>åˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±åŠ çš„é”ï¼›</li>
<li>å¦‚æœæ˜¯è‡ªå·± â†’ æ‰§è¡Œ <code>DEL key</code>ã€‚</li>
</ol>
<p>è¿™ä¸€æ­¥å¿…é¡»æ˜¯åŸå­æ“ä½œï¼Œå› æ­¤ç”¨ <strong>Lua è„šæœ¬</strong> å®ç°ã€‚</p>
<h2 id="Redission-å°è£…"><a href="#Redission-å°è£…" class="headerlink" title="Redission å°è£…"></a>Redission å°è£…</h2><p> Redisson å¹¶ä¸æ˜¯ç®€å•åœ°æ‰§è¡Œä¸Šé¢çš„ <code>SETNX</code> + <code>DEL</code>ï¼Œå®ƒåšäº†å¾ˆå¤šå¢å¼ºï¼š  </p>
<h3 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h3><p>Redisson æ”¯æŒåŒä¸€ä¸ªçº¿ç¨‹é‡å¤åŠ é”å¤šæ¬¡ï¼ˆç±»ä¼¼ Java çš„ <code>ReentrantLock</code>ï¼‰ï¼š</p>
<ul>
<li>æ¯æ¬¡åŒçº¿ç¨‹åŠ é”ï¼Œä¼šåœ¨ Redis é‡Œç»´æŠ¤ä¸€ä¸ªè®¡æ•°ï¼›</li>
<li>è§£é”æ—¶è¦å‡ä¸€ï¼Œåªæœ‰è®¡æ•°ä¸º 0 æ—¶æ‰çœŸæ­£åˆ é™¤ keyã€‚</li>
</ul>
<p> Redis ä¸­å­˜å‚¨çš„ value ç±»ä¼¼ï¼š </p>
<p>{</p>
<p>  â€œuuid:threadIdâ€: 3</p>
<p>} </p>
<p> è¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹åŠ é”äº† 3 æ¬¡ã€‚  </p>
<br/>

<h3 id="è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼ˆçœ‹é—¨ç‹—WatchDogï¼‰"><a href="#è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼ˆçœ‹é—¨ç‹—WatchDogï¼‰" class="headerlink" title="è‡ªåŠ¨ç»­æœŸæœºåˆ¶	ï¼ˆçœ‹é—¨ç‹—WatchDogï¼‰"></a>è‡ªåŠ¨ç»­æœŸæœºåˆ¶	ï¼ˆçœ‹é—¨ç‹—WatchDogï¼‰</h3><p> Redisson çš„åˆ†å¸ƒå¼é”é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 30 ç§’ï¼ˆå¯é…ç½®ï¼‰ã€‚<br>è‹¥ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡ 30 ç§’ï¼ŒRedisson ä¼šé€šè¿‡â€œçœ‹é—¨ç‹—â€æœºåˆ¶è‡ªåŠ¨ç»­æœŸï¼Œé˜²æ­¢é”åœ¨ä»»åŠ¡æœªå®Œæˆæ—¶è¢«æå‰é‡Šæ”¾ã€‚</p>
<ul>
<li>æ¯éš” 10 ç§’åˆ·æ–°é”çš„è¿‡æœŸæ—¶é—´ï¼›</li>
<li>åªæœ‰é”ä»å±äºå½“å‰çº¿ç¨‹æ—¶æ‰ä¼šç»­æœŸï¼›</li>
<li>å¦‚æœçº¿ç¨‹å®•æœºï¼Œçœ‹é—¨ç‹—åœæ­¢ï¼Œé”è‡ªåŠ¨è¿‡æœŸã€‚</li>
</ul>
<h3 id="é”ç«äº‰ç­‰å¾…ï¼ˆtryLockï¼‰"><a href="#é”ç«äº‰ç­‰å¾…ï¼ˆtryLockï¼‰" class="headerlink" title="é”ç«äº‰ç­‰å¾…ï¼ˆtryLockï¼‰"></a>é”ç«äº‰ç­‰å¾…ï¼ˆtryLockï¼‰</h3><p>Redisson åœ¨è·å–é”å¤±è´¥æ—¶ï¼Œä¸ä¼šç›´æ¥æ”¾å¼ƒã€‚å®ƒä¼šè¿›å…¥<strong>è‡ªæ—‹ + é˜»å¡ç­‰å¾…æœºåˆ¶</strong>ï¼š</p>
<ol>
<li>å°è¯•è·å–é”å¤±è´¥ï¼›</li>
<li>è®¢é˜… Redis çš„â€œè§£é”æ¶ˆæ¯é¢‘é“â€ï¼›</li>
<li>å½“å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šå‘å¸ƒè§£é”é€šçŸ¥ï¼›</li>
<li>æ”¶åˆ°é€šçŸ¥åå†æ¬¡å°è¯•åŠ é”ã€‚</li>
</ol>
<p>è¿™æ¯”æ­»å¾ªç¯é‡è¯•æ•ˆç‡æ›´é«˜ã€‚</p>
<h3 id="è§£é”æ—¶çš„å‘å¸ƒé€šçŸ¥"><a href="#è§£é”æ—¶çš„å‘å¸ƒé€šçŸ¥" class="headerlink" title="è§£é”æ—¶çš„å‘å¸ƒé€šçŸ¥"></a>è§£é”æ—¶çš„å‘å¸ƒé€šçŸ¥</h3><p> å½“ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œ Redisson ä¼šï¼š</p>
<ul>
<li>æ‰§è¡Œ Lua è§£é”è„šæœ¬ï¼›</li>
<li>å‘å¸ƒä¸€ä¸ªè§£é”æ¶ˆæ¯åˆ° Redis Pub&#x2F;Subï¼›</li>
<li>å”¤é†’ç­‰å¾…é”çš„å…¶ä»–çº¿ç¨‹ã€‚</li>
</ul>
<p>redission çš„è®¢é˜…å‘å¸ƒæ˜¯å€ŸåŠ©redis çš„pub&#x2F;sub åŠŸèƒ½å®Œæˆçš„</p>
<h2 id="çœ‹é—¨ç‹—æœºåˆ¶"><a href="#çœ‹é—¨ç‹—æœºåˆ¶" class="headerlink" title="çœ‹é—¨ç‹—æœºåˆ¶"></a>çœ‹é—¨ç‹—æœºåˆ¶</h2><h3 id="è§¦å‘æ¡ä»¶"><a href="#è§¦å‘æ¡ä»¶" class="headerlink" title="è§¦å‘æ¡ä»¶"></a>è§¦å‘æ¡ä»¶</h3><ul>
<li><strong>ä»…åœ¨è°ƒç”¨ <strong><code>**lock()**</code></strong> æˆ– <strong><code>**tryLock()**</code></strong> ä¸”æœªæŒ‡å®š <strong><code>**leaseTime**</code></strong>ï¼ˆé”ç§ŸæœŸï¼‰æ—¶å¯ç”¨ã€‚</strong></li>
<li>å¦‚æœä½ è°ƒç”¨äº† <code>lock(10, TimeUnit.SECONDS)</code> æˆ– <code>tryLock(5, 10, TimeUnit.SECONDS)</code> æ˜ç¡®ä¼ å…¥ç§ŸæœŸï¼Œåˆ™ <strong>ä¸ä¼šå¯ç”¨</strong> çœ‹é—¨ç‹—ã€‚</li>
</ul>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p> æ¯ä¸ª Redisson å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„çœ‹é—¨ç‹—å®šæ—¶çº¿ç¨‹ï¼Œç”¨äºç»Ÿä¸€è°ƒåº¦é”çš„ç»­æœŸä»»åŠ¡ã€‚<br>åªè¦æŒé”çº¿ç¨‹æ‰€åœ¨çš„ JVM è¿›ç¨‹ä»å­˜æ´»ï¼Œçœ‹é—¨ç‹—å°±ä¼šå‘¨æœŸæ€§åœ°ä¸ºé”åˆ·æ–°è¿‡æœŸæ—¶é—´ï¼›<br>ä¸€æ—¦ JVM å´©æºƒæˆ–è¿›ç¨‹ç»ˆæ­¢ï¼Œçœ‹é—¨ç‹—éšä¹‹åœæ­¢ï¼Œé”å°†åœ¨é»˜è®¤çš„ 30 ç§’è¶…æ—¶åè‡ªåŠ¨è¿‡æœŸé‡Šæ”¾ã€‚  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/springboot_data_redis/%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/springboot_data_redis/%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸€-å¼•å…¥ä¾èµ–"><a href="#ä¸€-å¼•å…¥ä¾èµ–" class="headerlink" title="ä¸€. å¼•å…¥ä¾èµ–"></a>ä¸€. å¼•å…¥ä¾èµ–</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-åŸºç¡€é…ç½®"><a href="#äºŒ-åŸºç¡€é…ç½®" class="headerlink" title="äºŒ.åŸºç¡€é…ç½®"></a>äºŒ.åŸºç¡€é…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  data:</span><br><span class="line">    redis:</span><br><span class="line">      host: localhost</span><br><span class="line">      port: <span class="number">6379</span></span><br><span class="line">      # password: your_password</span><br><span class="line">      lettuce:</span><br><span class="line">        pool:</span><br><span class="line">          max-active: <span class="number">16</span></span><br><span class="line">          max-idle: <span class="number">8</span></span><br><span class="line">          min-idle: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰-é€‰æ‹©-api"><a href="#ä¸‰-é€‰æ‹©-api" class="headerlink" title="ä¸‰.é€‰æ‹© api"></a>ä¸‰.é€‰æ‹© api</h1><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th><strong>StringRedisTemplate</strong></th>
<th><strong>RedisTemplate&lt;K, V&gt;</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ³›å‹ç±»å‹</strong></td>
<td>å›ºå®šä¸º <code>&lt;String, String&gt;</code></td>
<td>å¯è‡ªå®šä¹‰ï¼Œå¦‚ <code>&lt;String, Object&gt;</code></td>
</tr>
<tr>
<td><strong>é»˜è®¤åºåˆ—åŒ–å™¨</strong></td>
<td><code>StringRedisSerializer</code><br/>ï¼ˆå­—ç¬¦ä¸²åºåˆ—åŒ–ï¼‰</td>
<td><code>JdkSerializationRedisSerializer</code><br/>ï¼ˆäºŒè¿›åˆ¶åºåˆ—åŒ–ï¼‰</td>
</tr>
<tr>
<td><strong>æ˜¯å¦éœ€è¦è‡ªå®šä¹‰åºåˆ—åŒ–</strong></td>
<td>å¦</td>
<td>é€šå¸¸éœ€è¦é…ç½® JSON åºåˆ—åŒ–å™¨</td>
</tr>
<tr>
<td><strong>æ˜¯å¦å¯ç›´æ¥å­˜å¯¹è±¡ï¼ˆç±»ï¼‰</strong></td>
<td>âŒ å¦ï¼ˆéœ€æ‰‹åŠ¨è½¬ JSONï¼‰</td>
<td>âœ… æ˜¯ï¼ˆæ¨èä½¿ç”¨ JSON åºåˆ—åŒ–ï¼‰</td>
</tr>
<tr>
<td><strong>æ˜¯å¦æ”¯æŒ Redis äº”å¤§ç»“æ„ï¼ˆStringã€Listã€Hashã€Setã€ZSetï¼‰</strong></td>
<td>âœ… æ”¯æŒï¼ˆä»…é™å­—ç¬¦ä¸²ç±»å‹ï¼‰</td>
<td>âœ… æ”¯æŒï¼ˆæ”¯æŒä»»æ„ç±»å‹ï¼‰</td>
</tr>
<tr>
<td><strong>æ•°æ®å¯è¯»æ€§ï¼ˆåœ¨ Redis CLI ä¸­æŸ¥çœ‹ï¼‰</strong></td>
<td>âœ… æ˜æ–‡ï¼ˆUTF-8 å¯è¯»ï¼‰</td>
<td>âš ï¸ é»˜è®¤ä¸å¯è¯»ï¼ˆJDK åºåˆ—åŒ–åä¸ºäºŒè¿›åˆ¶ï¼‰</td>
</tr>
<tr>
<td><strong>ä½¿ç”¨å¤æ‚åº¦</strong></td>
<td>ç®€å•ï¼ˆå¼€ç®±å³ç”¨ï¼‰</td>
<td>ç¨å¤æ‚ï¼ˆéœ€é…ç½®åºåˆ—åŒ–å™¨ï¼‰</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>å­˜å­—ç¬¦ä¸²ï¼šéªŒè¯ç ã€tokenã€è®¡æ•°å™¨ã€çŠ¶æ€æ ‡å¿—ç­‰</td>
<td>å­˜å¤æ‚å¯¹è±¡ï¼šç”¨æˆ·ä¿¡æ¯ã€ç¼“å­˜å®ä½“ã€JSON æ•°æ®ç­‰</td>
</tr>
<tr>
<td><strong>æ¨èç¨‹åº¦</strong></td>
<td>â­â­â­ï¼ˆç®€å•å­—ç¬¦ä¸²åœºæ™¯ï¼‰</td>
<td>â­â­â­â­ï¼ˆé€šç”¨å¤æ‚åœºæ™¯ï¼‰</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/springboot_data_redis/RedisTemplate_Api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/springboot_data_redis/RedisTemplate_Api/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="å®šä¹‰æ”¯æŒJson-çš„RedisTemplate-Bean"><a href="#å®šä¹‰æ”¯æŒJson-çš„RedisTemplate-Bean" class="headerlink" title="å®šä¹‰æ”¯æŒJson çš„RedisTemplate Bean"></a>å®šä¹‰æ”¯æŒJson çš„RedisTemplate Bean</h1><p><em>RedisTemplate é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼æ˜¯äºŒè¿›åˆ¶</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">  <span class="comment">// å®šä¹‰ä¸€ä¸ªåä¸º redisTemplate çš„ Beanï¼Œè¿”å› RedisTemplate&lt;String, Object&gt;</span></span><br><span class="line">  <span class="comment">// Spring ä¼šå°†è¿™ä¸ª Bean è‡ªåŠ¨æ³¨å…¥åˆ°éœ€è¦ä½¿ç”¨ RedisTemplate çš„åœ°æ–¹</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory cf)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º RedisTemplate å¯¹è±¡ï¼ˆæ³›å‹æŒ‡å®š key ä¸º Stringï¼Œvalue ä¸º Objectï¼‰</span></span><br><span class="line">    RedisTemplate&lt;String, Object&gt; tpl = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å…¥ Redis è¿æ¥å·¥å‚ï¼ˆSpring Boot ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®å¥½è¿æ¥æ± å’Œå®¢æˆ·ç«¯ï¼‰</span></span><br><span class="line">    tpl.setConnectionFactory(cf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ï¸ å®šä¹‰ Key ä¸ HashKey çš„åºåˆ—åŒ–å™¨ â€”â€” String ç±»å‹</span></span><br><span class="line">    <span class="comment">// Redis ä¸­æ‰€æœ‰ key éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™æ ·åœ¨ redis-cli ä¸­å¯ä»¥ç›´æ¥çœ‹åˆ°æ˜æ–‡</span></span><br><span class="line">    <span class="type">StringRedisSerializer</span> <span class="variable">keySer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ï¸ å®šä¹‰ Value ä¸ HashValue çš„åºåˆ—åŒ–å™¨ â€”â€” JSON ç±»å‹</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œä½¿ç”¨ GenericJackson2JsonRedisSerializerï¼Œå®ƒä¼šè‡ªåŠ¨ï¼š</span></span><br><span class="line">    <span class="comment">//   - å°†å¯¹è±¡è½¬ä¸º JSON å­˜å…¥ Redisï¼›</span></span><br><span class="line">    <span class="comment">//   - ä¿å­˜ç±»å‹ä¿¡æ¯ï¼Œååºåˆ—åŒ–æ—¶èƒ½è¿˜åŸå¯¹è±¡ï¼›</span></span><br><span class="line">    <span class="comment">//   - è·¨è¯­è¨€å¯è¯»ï¼ˆä¸åŒè¯­è¨€ä¹Ÿèƒ½è§£æ JSONï¼‰</span></span><br><span class="line">    <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">valSer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ï¸ è®¾ç½®å„éƒ¨åˆ†çš„åºåˆ—åŒ–ç­–ç•¥</span></span><br><span class="line">    <span class="comment">// key å’Œ hash key ç”¨å­—ç¬¦ä¸²åºåˆ—åŒ–</span></span><br><span class="line">    tpl.setKeySerializer(keySer);</span><br><span class="line">    tpl.setHashKeySerializer(keySer);</span><br><span class="line">    <span class="comment">// value å’Œ hash value ç”¨ JSON åºåˆ—åŒ–</span></span><br><span class="line">    tpl.setValueSerializer(valSer);</span><br><span class="line">    tpl.setHashValueSerializer(valSer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4ï¸ åˆå§‹åŒ–é…ç½®ï¼ˆç”Ÿæ•ˆè®¾ç½®ï¼‰</span></span><br><span class="line">    tpl.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5ï¸ è¿”å›é…ç½®å¥½çš„ RedisTemplate å®ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> tpl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>åºåˆ—åŒ–å™¨</th>
<th>ä½œç”¨å¯¹è±¡</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>setKeySerializer()</code></td>
<td>Redis æœ€å¤–å±‚ key</td>
<td>æ‰€æœ‰ç»“æ„é€šç”¨</td>
</tr>
<tr>
<td><code>setValueSerializer()</code></td>
<td>Redis String ç»“æ„çš„ value</td>
<td>ä»… opsForValue() æ—¶ä½¿ç”¨</td>
</tr>
<tr>
<td><code>setHashKeySerializer()</code></td>
<td>Hash å†…éƒ¨ field åç§°</td>
<td>ä»… opsForHash() æ—¶ä½¿ç”¨</td>
</tr>
<tr>
<td><code>setHashValueSerializer()</code></td>
<td>Hash å†…éƒ¨ field çš„å€¼</td>
<td>ä»… opsForHash() æ—¶ä½¿ç”¨</td>
</tr>
</tbody></table>
<h1 id="RedisTemplate-çš„å¸¸ç”¨æ–¹æ³•"><a href="#RedisTemplate-çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="RedisTemplate çš„å¸¸ç”¨æ–¹æ³•"></a>RedisTemplate çš„å¸¸ç”¨æ–¹æ³•</h1><h2 id="ä¸€ã€RedisTemplate-çš„æ ¸å¿ƒç»“æ„"><a href="#ä¸€ã€RedisTemplate-çš„æ ¸å¿ƒç»“æ„" class="headerlink" title="ä¸€ã€RedisTemplate çš„æ ¸å¿ƒç»“æ„"></a>ä¸€ã€RedisTemplate çš„æ ¸å¿ƒç»“æ„</h2><p><code>RedisTemplate</code> å°è£…äº†å¯¹ Redis çš„å„ç§æ•°æ®ç»“æ„æ“ä½œæ–¹æ³•ï¼Œé€šè¿‡ä»¥ä¸‹ 5 ä¸ªã€Œopsã€æ¥å£ï¼š  </p>
<table>
<thead>
<tr>
<th>æ•°æ®ç»“æ„</th>
<th>æ–¹æ³•å…¥å£</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</td>
<td><code>opsForValue()</code></td>
<td>æœ€å¸¸ç”¨ï¼Œç”¨äºç¼“å­˜ã€è®¡æ•°å™¨</td>
</tr>
<tr>
<td>Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰</td>
<td><code>opsForHash()</code></td>
<td>å­˜å‚¨ç»“æ„åŒ–å¯¹è±¡ï¼ˆç±»ä¼¼ Mapï¼‰</td>
</tr>
<tr>
<td>Listï¼ˆåˆ—è¡¨ï¼‰</td>
<td><code>opsForList()</code></td>
<td>é˜Ÿåˆ—ã€æ ˆã€æ¶ˆæ¯åˆ—è¡¨</td>
</tr>
<tr>
<td>Setï¼ˆæ— åºé›†åˆï¼‰</td>
<td><code>opsForSet()</code></td>
<td>å»é‡é›†åˆã€æ ‡ç­¾é›†åˆ</td>
</tr>
<tr>
<td>ZSetï¼ˆæœ‰åºé›†åˆï¼‰</td>
<td><code>opsForZSet()</code></td>
<td>æ’è¡Œæ¦œã€æƒé‡åˆ†æ•°è¡¨</td>
</tr>
</tbody></table>
<h2 id="äºŒã€å¸¸ç”¨æ–¹æ³•æ€»è§ˆè¡¨"><a href="#äºŒã€å¸¸ç”¨æ–¹æ³•æ€»è§ˆè¡¨" class="headerlink" title="äºŒã€å¸¸ç”¨æ–¹æ³•æ€»è§ˆè¡¨"></a>äºŒã€å¸¸ç”¨æ–¹æ³•æ€»è§ˆè¡¨</h2><h3 id="opsForValue-â€”â€”-æ“ä½œæ™®é€šé”®å€¼-String"><a href="#opsForValue-â€”â€”-æ“ä½œæ™®é€šé”®å€¼-String" class="headerlink" title="opsForValue() â€”â€” æ“ä½œæ™®é€šé”®å€¼ (String)"></a>opsForValue() â€”â€” æ“ä½œæ™®é€šé”®å€¼ (String)</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>å«ä¹‰ &#x2F; ç”¨é€”</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>set(key, value)</code></td>
<td>è®¾ç½®é”®å€¼</td>
<td><code>opsForValue().set(&quot;name&quot;, &quot;Alice&quot;)</code></td>
</tr>
<tr>
<td><code>set(key, value, timeout)</code></td>
<td>è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´</td>
<td><code>opsForValue().set(&quot;code&quot;, &quot;1234&quot;, Duration.ofMinutes(5))</code></td>
</tr>
<tr>
<td><code>get(key)</code></td>
<td>è·å–å€¼</td>
<td><code>opsForValue().get(&quot;name&quot;)</code></td>
</tr>
<tr>
<td><code>increment(key)</code></td>
<td>è‡ªå¢ï¼ˆè®¡æ•°å™¨ï¼‰</td>
<td><code>opsForValue().increment(&quot;viewCount&quot;)</code></td>
</tr>
<tr>
<td><code>decrement(key)</code></td>
<td>è‡ªå‡</td>
<td><code>opsForValue().decrement(&quot;stock&quot;)</code></td>
</tr>
<tr>
<td><code>getAndSet(key, value)</code></td>
<td>å–æ—§å€¼å¹¶è®¾ç½®æ–°å€¼</td>
<td><code>opsForValue().getAndSet(&quot;token&quot;, &quot;newToken&quot;)</code></td>
</tr>
<tr>
<td><code>multiSet(map)</code></td>
<td>æ‰¹é‡è®¾ç½®</td>
<td><code>opsForValue().multiSet(map)</code></td>
</tr>
<tr>
<td><code>multiGet(keys)</code></td>
<td>æ‰¹é‡è·å–</td>
<td><code>opsForValue().multiGet(keys)</code></td>
</tr>
</tbody></table>
<h3 id="opsForHash-â€”â€”-æ“ä½œå“ˆå¸Œè¡¨-Hash"><a href="#opsForHash-â€”â€”-æ“ä½œå“ˆå¸Œè¡¨-Hash" class="headerlink" title="opsForHash() â€”â€” æ“ä½œå“ˆå¸Œè¡¨ (Hash)"></a>opsForHash() â€”â€” æ“ä½œå“ˆå¸Œè¡¨ (Hash)</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>å«ä¹‰ &#x2F; ç”¨é€”</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>put(key, hashKey, value)</code></td>
<td>è®¾ç½®å“ˆå¸Œå­—æ®µ</td>
<td><code>opsForHash().put(&quot;user:1&quot;, &quot;name&quot;, &quot;Alice&quot;)</code></td>
</tr>
<tr>
<td><code>get(key, hashKey)</code></td>
<td>è·å–å“ˆå¸Œå­—æ®µå€¼</td>
<td><code>opsForHash().get(&quot;user:1&quot;, &quot;name&quot;)</code></td>
</tr>
<tr>
<td><code>putAll(key, map)</code></td>
<td>æ‰¹é‡è®¾ç½®å­—æ®µ</td>
<td><code>opsForHash().putAll(&quot;user:1&quot;, map)</code></td>
</tr>
<tr>
<td><code>entries(key)</code></td>
<td>è·å–æ‰€æœ‰å­—æ®µå’Œå€¼</td>
<td><code>opsForHash().entries(&quot;user:1&quot;)</code></td>
</tr>
<tr>
<td><code>delete(key, hashKeys...)</code></td>
<td>åˆ é™¤å­—æ®µ</td>
<td><code>opsForHash().delete(&quot;user:1&quot;, &quot;age&quot;)</code></td>
</tr>
<tr>
<td><code>hasKey(key, hashKey)</code></td>
<td>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</td>
<td><code>opsForHash().hasKey(&quot;user:1&quot;, &quot;name&quot;)</code></td>
</tr>
<tr>
<td><code>increment(key, hashKey, delta)</code></td>
<td>å“ˆå¸Œå­—æ®µè‡ªå¢</td>
<td><code>opsForHash().increment(&quot;user:1&quot;, &quot;score&quot;, 10)</code></td>
</tr>
<tr>
<td><code>keys(key)</code></td>
<td>è·å–å“ˆå¸Œæ‰€æœ‰å­—æ®µå</td>
<td><code>opsForHash().keys(&quot;user:1&quot;)</code></td>
</tr>
<tr>
<td><code>values(key)</code></td>
<td>è·å–æ‰€æœ‰å­—æ®µå€¼</td>
<td><code>opsForHash().values(&quot;user:1&quot;)</code></td>
</tr>
</tbody></table>
<h3 id="opsForList-â€”â€”-æ“ä½œåˆ—è¡¨-List"><a href="#opsForList-â€”â€”-æ“ä½œåˆ—è¡¨-List" class="headerlink" title="opsForList() â€”â€” æ“ä½œåˆ—è¡¨ (List)"></a>opsForList() â€”â€” æ“ä½œåˆ—è¡¨ (List)</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>leftPush(key, value)</code></td>
<td>ä»å·¦å…¥é˜Ÿ</td>
<td><code>opsForList().leftPush(&quot;queue&quot;, &quot;task1&quot;)</code></td>
</tr>
<tr>
<td><code>rightPush(key, value)</code></td>
<td>ä»å³å…¥é˜Ÿ</td>
<td><code>opsForList().rightPush(&quot;queue&quot;, &quot;task2&quot;)</code></td>
</tr>
<tr>
<td><code>leftPop(key)</code></td>
<td>ä»å·¦å‡ºé˜Ÿ</td>
<td><code>opsForList().leftPop(&quot;queue&quot;)</code></td>
</tr>
<tr>
<td><code>rightPop(key)</code></td>
<td>ä»å³å‡ºé˜Ÿ</td>
<td><code>opsForList().rightPop(&quot;queue&quot;)</code></td>
</tr>
<tr>
<td><code>range(key, start, end)</code></td>
<td>æŒ‰ç´¢å¼•èŒƒå›´è·å–å…ƒç´ </td>
<td><code>opsForList().range(&quot;queue&quot;, 0, -1)</code></td>
</tr>
<tr>
<td><code>size(key)</code></td>
<td>è·å–é•¿åº¦</td>
<td><code>opsForList().size(&quot;queue&quot;)</code></td>
</tr>
<tr>
<td><code>index(key, index)</code></td>
<td>è·å–æŒ‡å®šä½ç½®å…ƒç´ </td>
<td><code>opsForList().index(&quot;queue&quot;, 0)</code></td>
</tr>
<tr>
<td><code>remove(key, count, value)</code></td>
<td>åˆ é™¤åŒ¹é…çš„å…ƒç´ </td>
<td><code>opsForList().remove(&quot;queue&quot;, 1, &quot;task1&quot;)</code></td>
</tr>
</tbody></table>
<h3 id="opsForSet-â€”â€”-æ“ä½œé›†åˆ-Set"><a href="#opsForSet-â€”â€”-æ“ä½œé›†åˆ-Set" class="headerlink" title="opsForSet() â€”â€” æ“ä½œé›†åˆ (Set)"></a>opsForSet() â€”â€” æ“ä½œé›†åˆ (Set)</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>add(key, values...)</code></td>
<td>æ·»åŠ å…ƒç´ </td>
<td><code>opsForSet().add(&quot;online&quot;, &quot;u1&quot;, &quot;u2&quot;)</code></td>
</tr>
<tr>
<td><code>remove(key, values...)</code></td>
<td>ç§»é™¤å…ƒç´ </td>
<td><code>opsForSet().remove(&quot;online&quot;, &quot;u1&quot;)</code></td>
</tr>
<tr>
<td><code>members(key)</code></td>
<td>è·å–æ‰€æœ‰æˆå‘˜</td>
<td><code>opsForSet().members(&quot;online&quot;)</code></td>
</tr>
<tr>
<td><code>isMember(key, value)</code></td>
<td>åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td>
<td><code>opsForSet().isMember(&quot;online&quot;, &quot;u1&quot;)</code></td>
</tr>
<tr>
<td><code>intersect(k1, k2)</code></td>
<td>äº¤é›†</td>
<td><code>opsForSet().intersect(&quot;a&quot;, &quot;b&quot;)</code></td>
</tr>
<tr>
<td><code>union(k1, k2)</code></td>
<td>å¹¶é›†</td>
<td><code>opsForSet().union(&quot;a&quot;, &quot;b&quot;)</code></td>
</tr>
<tr>
<td><code>difference(k1, k2)</code></td>
<td>å·®é›†</td>
<td><code>opsForSet().difference(&quot;a&quot;, &quot;b&quot;)</code></td>
</tr>
</tbody></table>
<h3 id="opsForZSet-â€”â€”-æ“ä½œæœ‰åºé›†åˆ-ZSet"><a href="#opsForZSet-â€”â€”-æ“ä½œæœ‰åºé›†åˆ-ZSet" class="headerlink" title="opsForZSet() â€”â€” æ“ä½œæœ‰åºé›†åˆ (ZSet)"></a>opsForZSet() â€”â€” æ“ä½œæœ‰åºé›†åˆ (ZSet)</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>add(key, value, score)</code></td>
<td>æ·»åŠ å…ƒç´ åŠåˆ†æ•°</td>
<td><code>opsForZSet().add(&quot;rank&quot;, &quot;u1&quot;, 100)</code></td>
</tr>
<tr>
<td><code>score(key, value)</code></td>
<td>è·å–åˆ†æ•°</td>
<td><code>opsForZSet().score(&quot;rank&quot;, &quot;u1&quot;)</code></td>
</tr>
<tr>
<td><code>incrementScore(key, value, delta)</code></td>
<td>å¢åŠ åˆ†æ•°</td>
<td><code>opsForZSet().incrementScore(&quot;rank&quot;, &quot;u1&quot;, 5)</code></td>
</tr>
<tr>
<td><code>range(key, start, end)</code></td>
<td>è·å–å‡åºæˆå‘˜</td>
<td><code>opsForZSet().range(&quot;rank&quot;, 0, 9)</code></td>
</tr>
<tr>
<td><code>reverseRange(key, start, end)</code></td>
<td>è·å–é™åºæˆå‘˜</td>
<td><code>opsForZSet().reverseRange(&quot;rank&quot;, 0, 9)</code></td>
</tr>
<tr>
<td><code>remove(key, values...)</code></td>
<td>åˆ é™¤å…ƒç´ </td>
<td><code>opsForZSet().remove(&quot;rank&quot;, &quot;u1&quot;)</code></td>
</tr>
<tr>
<td><code>rank(key, value)</code></td>
<td>è·å–æ’åï¼ˆå‡åºï¼‰</td>
<td><code>opsForZSet().rank(&quot;rank&quot;, &quot;u1&quot;)</code></td>
</tr>
<tr>
<td><code>reverseRank(key, value)</code></td>
<td>è·å–æ’åï¼ˆé™åºï¼‰</td>
<td><code>opsForZSet().reverseRank(&quot;rank&quot;, &quot;u1&quot;)</code></td>
</tr>
</tbody></table>
<h2 id="ä¸‰-é€šç”¨æ“ä½œæ–¹æ³•"><a href="#ä¸‰-é€šç”¨æ“ä½œæ–¹æ³•" class="headerlink" title="ä¸‰. é€šç”¨æ“ä½œæ–¹æ³•"></a>ä¸‰. é€šç”¨æ“ä½œæ–¹æ³•</h2><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>delete(key)</code></td>
<td>åˆ é™¤æŒ‡å®š key</td>
<td><code>redisTemplate.delete(&quot;user:1&quot;)</code></td>
</tr>
<tr>
<td><code>hasKey(key)</code></td>
<td>åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨</td>
<td><code>redisTemplate.hasKey(&quot;user:1&quot;)</code></td>
</tr>
<tr>
<td><code>keys(pattern)</code></td>
<td>è·å–åŒ¹é…çš„ key é›†åˆ</td>
<td><code>redisTemplate.keys(&quot;user:*&quot;)</code></td>
</tr>
<tr>
<td><code>expire(key, time)</code></td>
<td>è®¾ç½®è¿‡æœŸæ—¶é—´</td>
<td><code>redisTemplate.expire(&quot;user:1&quot;, Duration.ofMinutes(5))</code></td>
</tr>
<tr>
<td><code>getExpire(key)</code></td>
<td>è·å– TTLï¼ˆå‰©ä½™æ—¶é—´ï¼‰</td>
<td><code>redisTemplate.getExpire(&quot;user:1&quot;)</code></td>
</tr>
<tr>
<td><code>rename(oldKey, newKey)</code></td>
<td>é‡å‘½å key</td>
<td><code>redisTemplate.rename(&quot;temp&quot;, &quot;user:1&quot;)</code></td>
</tr>
</tbody></table>
<p>__</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/%E5%93%A8%E5%85%B5/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µ"></a>ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µ</h1><p> Redis ä¸»ä»æ¨¡å¼ä¸»èŠ‚ç‚¹æŒ‚äº†ä¼šå¯¼è‡´å†™ä¸å¯ç”¨ï¼Œå› æ­¤éœ€è¦ Sentinel ï¼ˆå“¨å…µï¼‰è‡ªåŠ¨ç›‘æ§ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼Œåœ¨ä¸»èŠ‚ç‚¹å®•æœºæ—¶è‡ªåŠ¨å°†ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹å¹¶å®Œæˆä¸»ä»åˆ‡æ¢ï¼Œä»è€Œå®ç°é«˜å¯ç”¨ã€‚  </p>
<h1 id="å“¨å…µå¦‚ä½•å·¥ä½œ"><a href="#å“¨å…µå¦‚ä½•å·¥ä½œ" class="headerlink" title="å“¨å…µå¦‚ä½•å·¥ä½œ"></a>å“¨å…µå¦‚ä½•å·¥ä½œ</h1><p> å“¨å…µèŠ‚ç‚¹ï¼ˆSentinelï¼‰å¹¶ä¸æ˜¯ä»èŠ‚ç‚¹ï¼Œå®ƒä¸ä¸»ä»èŠ‚ç‚¹å®Œå…¨ä¸åŒï¼Œæ˜¯ç‹¬ç«‹è¿è¡Œçš„ç›‘æ§è¿›ç¨‹ã€‚  <font style="color:rgb(44, 62, 80);">ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š</font><strong><font style="color:rgb(48, 79, 254);">ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</font></strong><font style="color:rgb(44, 62, 80);">ã€‚</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763717373105-eae2c585-0f54-4699-9957-95898b39974c.png"></p>
<h1 id="å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœ"><a href="#å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœ"></a>å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœ</h1><p> å“¨å…µæ¯éš” <strong>1 ç§’</strong> ä¼šå‘<font style="color:#DF2A3F;">æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹</font>å‘é€ <code>PING</code> æ¥åˆ¤æ–­æ˜¯å¦åœ¨çº¿ã€‚  </p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763717698223-f096d090-f61c-446f-83df-132c3a8543a1.png"></p>
<h2 id="ä¸»è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿</h2><p>åˆ¤æ–­æ ‡å‡†ï¼š<code>down-after-milliseconds</code>ï¼ˆredis.confé…ç½®æ–‡ä»¶ï¼‰ æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° <code>PING</code> çš„å›å¤ã€‚</p>
<p>åªæœ‰â€œä¸»èŠ‚ç‚¹â€ä¼šè¿›ä¸€æ­¥è§¦å‘åç»­æµç¨‹ï¼›ä»èŠ‚ç‚¹å³ä½¿ä¸»è§‚ä¸‹çº¿ä¹Ÿä¸è§¦å‘ failoverã€‚</p>
<p>âš ï¸ ä¸»è§‚ä¸‹çº¿åªæ˜¯ â€œæ€€ç–‘â€ï¼Œä¸ä¸€å®šæ˜¯çœŸçš„å®•æœº<br>å› ä¸ºå¯èƒ½æ˜¯<strong>å“¨å…µè‡ªèº«ç½‘ç»œä¸å¥½</strong>ã€‚</p>
<h2 id="å®¢è§‚ä¸‹çº¿"><a href="#å®¢è§‚ä¸‹çº¿" class="headerlink" title="å®¢è§‚ä¸‹çº¿"></a>å®¢è§‚ä¸‹çº¿</h2><p><strong>å®¢è§‚ä¸‹çº¿ &#x3D; å¤šä¸ªå“¨å…µæŠ•ç¥¨å…±åŒè®¤ä¸ºä¸»èŠ‚ç‚¹ç¡®å®å®•æœº</strong></p>
<p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>ä¸€ä¸ªå“¨å…µå…ˆä¸»è§‚åˆ¤æ–­ä¸»èŠ‚ç‚¹ ä¸‹çº¿</p>
</li>
<li><p>å®ƒå‘å…¶å®ƒå“¨å…µå‘é€ï¼š</p>
</li>
</ol>
<p><strong>â€œä½ è§‰å¾—ä¸»èŠ‚ç‚¹ä¸‹çº¿äº†å—ï¼Ÿâ€</strong></p>
<p>å¦‚ä¸‹å›¾çš„æ„æ€ï¼š</p>
<ul>
<li>å“¨å…µ B è§‰å¾—ä¸»èŠ‚ç‚¹ä¸‹çº¿ â†’ æŠ•èµæˆç¥¨</li>
<li>å“¨å…µ A ç½‘ç»œçŠ¶å†µå¥½ â†’ ä¸è®¤ä¸ºä¸‹çº¿</li>
<li>å“¨å…µ C ä¹Ÿåˆ¤æ–­ä¸ºä¸‹çº¿</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763717818056-9af235f7-a9a4-422a-9317-39f18dcc5308.png"></p>
<ol start="3">
<li>èµæˆç¥¨ â‰¥ <code>quorum</code>ï¼ˆæ³•å®šç¥¨æ•°redis.confé…ç½®æ–‡ä»¶ï¼‰</li>
</ol>
<p>â†’ ä¸»èŠ‚ç‚¹è¢«æ ‡è®°ä¸º <strong>å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰</strong></p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æœ‰ 3 ä¸ªå“¨å…µ</li>
<li><code>quorum = 2</code><br>â†’ ä»»æ„ä¸¤ä¸ªå“¨å…µè®¤ä¸ºâ€œä¸»èŠ‚ç‚¹ä¸‹çº¿â€å³å¯è¿›å…¥ ODOWNã€‚</li>
</ul>
<p>âš ï¸ quorum çš„ç›®çš„æ˜¯ï¼š</p>
<p>é¿å…æŸä¸ªå“¨å…µç½‘ç»œä¸å¥½å¯¼è‡´è¯¯åˆ¤ä¸»èŠ‚ç‚¹æ•…éšœã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆ-Redis-éœ€è¦å¤šä¸ªå“¨å…µï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Redis-éœ€è¦å¤šä¸ªå“¨å…µï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Redis éœ€è¦å¤šä¸ªå“¨å…µï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Redis éœ€è¦å¤šä¸ªå“¨å…µï¼Ÿ</h2><p>å› ä¸ºï¼š</p>
<ul>
<li>å•ä¸ªå“¨å…µç½‘ç»œå¯èƒ½å‡ºé—®é¢˜</li>
<li>å•ä¸ªå“¨å…µæ— æ³•åˆ¤æ–­æ˜¯â€œä¸»èŠ‚ç‚¹çœŸçš„æŒ‚äº†â€ï¼Œè¿˜æ˜¯â€œè‡ªå·±çš„ç½‘ç»œæŒ‚äº†â€</li>
</ul>
<p>æ‰€ä»¥ Redis è¦æ±‚ï¼š</p>
<p>æœ€å°‘ 3 ä¸ªå“¨å…µç»„æˆé›†ç¾¤ï¼Œè¿™æ ·æ‰æ›´å¯é ã€‚</p>
<h1 id="å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»"><a href="#å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»" class="headerlink" title="å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»"></a>å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»</h1><p> å“¨å…µé›†ç¾¤å‘ç°ä¸»èŠ‚ç‚¹â€œå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰â€ä¹‹åï¼Œéœ€è¦é€‰å‡ºä¸€ä¸ª Leaderï¼Œç”±å®ƒæ¥<strong>æ‰§è¡Œæ•…éšœè½¬ç§»</strong></p>
<h2 id="è°å¯ä»¥æˆä¸º-Leader-å€™é€‰è€…ï¼Ÿ"><a href="#è°å¯ä»¥æˆä¸º-Leader-å€™é€‰è€…ï¼Ÿ" class="headerlink" title="è°å¯ä»¥æˆä¸º Leader å€™é€‰è€…ï¼Ÿ"></a>è°å¯ä»¥æˆä¸º Leader å€™é€‰è€…ï¼Ÿ</h2><p>åªæœ‰<font style="color:#DF2A3F;">â€œæœ€å…ˆâ€</font>åˆ¤æ–­å‡ºä¸»èŠ‚ç‚¹<font style="color:#DF2A3F;"> å®¢è§‚ä¸‹çº¿ </font>çš„å“¨å…µï¼Œæ‰æœ‰èµ„æ ¼æˆä¸ºå€™é€‰è€…ã€‚</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>æŸä¸ªå“¨å…µ B æœ€å…ˆåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸º ä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰</li>
<li>å®ƒå‘æ‰€æœ‰å“¨å…µå‘é€ <code>is-master-down-by-addr</code> è¯·æ±‚</li>
<li>å½“æ”¶åˆ°è¶³å¤Ÿç¥¨æ•°è¾¾åˆ° <code>quorum</code> å€¼ â†’ åˆ¤å®šä¸»èŠ‚ç‚¹ å®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰</li>
<li>è¿™ä¸ªæœ€æ—©åˆ¤æ–­ å®¢è§‚ä¸‹çº¿ çš„å“¨å…µ &#x3D; Leader å€™é€‰è€…</li>
</ol>
<p>â†’ æ‰€ä»¥å€™é€‰è€…åªæœ‰æ¥è‡ªâ€œæœ€å…ˆåˆ¤æ–­ å®¢è§‚ä¸‹çº¿ çš„å“¨å…µâ€ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763718114569-dc04d665-a8bf-415c-9614-5e5ff2982ff4.png"></p>
<h2 id="å¦‚æœåŒæ—¶å‡ºç°å¤šä¸ªå€™é€‰äººæ€ä¹ˆåŠï¼Ÿ"><a href="#å¦‚æœåŒæ—¶å‡ºç°å¤šä¸ªå€™é€‰äººæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¦‚æœåŒæ—¶å‡ºç°å¤šä¸ªå€™é€‰äººæ€ä¹ˆåŠï¼Ÿ"></a>å¦‚æœåŒæ—¶å‡ºç°å¤šä¸ªå€™é€‰äººæ€ä¹ˆåŠï¼Ÿ</h2><p>å€™é€‰äººé€‰ä¸¾æˆåŠŸçš„ä¸¤ä¸ªæ¡ä»¶:</p>
<ul>
<li><font style="color:rgb(44, 62, 80);">ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼ˆ</font><font style="color:#DF2A3F;">ä¸åŒ…æ‹¬åŠæ•°ï¼Œå› æ­¤æ¨èè®¾ç½®å¥‡æ•°ä¸ªå“¨å…µèŠ‚ç‚¹</font><font style="color:rgb(44, 62, 80);">ï¼‰ï¼›</font></li>
<li><font style="color:rgb(44, 62, 80);">ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</font></li>
</ul>
<p><strong>åŸºäºâ€œä»»æœŸâ€å’Œâ€œå…ˆæ¥ååˆ°â€æœºåˆ¶è‡ªåŠ¨å†³å‡ºå”¯ä¸€ Leader</strong>ã€‚</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>ä¸¤ä¸ªå“¨å…µï¼ˆå¦‚ Aã€Bï¼‰å‡ ä¹åŒæ—¶åˆ¤æ–­ ODOWN â†’ ä¸¤ä¸ªå€™é€‰è€…</li>
<li>å…¶å®ƒå“¨å…µæ”¶åˆ°å¤šä¸ªæŠ•ç¥¨è¯·æ±‚æ—¶ï¼Œåªä¼šæŠŠç¥¨æŠ•ç»™<br><strong>æœ€å…ˆåˆ°è¾¾çš„è¯·æ±‚</strong></li>
<li>æ‰€ä»¥å…ˆå‘é€è¯·æ±‚çš„ä¸€æ–¹ä¼šæ›´å®¹æ˜“æ‹¿åˆ°å¤šæ•°ç¥¨</li>
<li>è‹¥æœ€ç»ˆå‡ºç°å¹³ç¥¨æˆ–æ¡ä»¶ä¸æ»¡è¶³ â†’ é‡è¯•ä¸‹ä¸€è½®é€‰ä¸¾</li>
</ol>
<p>æœ€ç»ˆå¿…ç„¶åªä¼šäº§ç”Ÿä¸€ä¸ªæ»¡è¶³å¤šæ•°ç¥¨ + quorum çš„ Leaderã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰-3-ä¸ªï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰-3-ä¸ªï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰ 3 ä¸ªï¼Ÿ"></a>ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰ 3 ä¸ªï¼Ÿ</h1><p><em>å“¨å…µèŠ‚ç‚¹å¯ä»¥æœ‰1ä¸ªï¼ˆéå¸¸ä¸æ¨èï¼‰ï¼Œ3ä¸ªâ€¦å°±æ˜¯ä¸èƒ½æœ‰ä¸¤ä¸ªï¼ŒåŒæ—¶æ¨èè®¾ç½®å¥‡æ•°ä¸ªå“¨å…µèŠ‚ç‚¹</em></p>
<h2 id="å“¨å…µåªæœ‰-2-ä¸ªæ—¶çš„é—®é¢˜"><a href="#å“¨å…µåªæœ‰-2-ä¸ªæ—¶çš„é—®é¢˜" class="headerlink" title="å“¨å…µåªæœ‰ 2 ä¸ªæ—¶çš„é—®é¢˜"></a><font style="color:rgb(44, 62, 80);">å“¨å…µåªæœ‰ 2 ä¸ªæ—¶çš„é—®é¢˜</font></h2><p><font style="color:rgb(44, 62, 80);">å“¨å…µæ•°é‡ &#x3D; 2<br></font><font style="color:rgb(44, 62, 80);">Leader é€‰ä¸¾å¿…é¡»æ»¡è¶³ä¸¤æ¡ä»¶ï¼š</font></p>
<ol>
<li><strong>å¤šæ•°ç¥¨ï¼ˆ&gt; 1ï¼‰â†’ å¿…é¡»æ‹¿ 2 ç¥¨</strong></li>
<li><strong>â‰¥ quorumï¼ˆä¸€èˆ¬ä¹Ÿæ˜¯ 2ï¼‰</strong></li>
</ol>
<p><font style="color:rgb(44, 62, 80);">ä½†å®é™…æƒ…å†µæ˜¯ï¼š</font></p>
<ul>
<li><font style="color:rgb(44, 62, 80);">å“¨å…µ A ç»™è‡ªå·±æŠ• 1 ç¥¨</font></li>
<li><font style="color:rgb(44, 62, 80);">å“¨å…µ B ç»™è‡ªå·±æŠ• 1 ç¥¨<br></font><font style="color:rgb(44, 62, 80);">â†’ </font><strong>è°éƒ½æ‹¿ä¸åˆ° 2 ç¥¨</strong><font style="color:rgb(44, 62, 80);"><br></font><font style="color:rgb(44, 62, 80);">â†’ Leader æ°¸è¿œé€‰ä¸å‡ºæ¥<br></font><font style="color:rgb(44, 62, 80);">â†’ </font><strong>æ— æ³•è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼ˆfailoverï¼‰</strong></li>
</ul>
<p><font style="color:rgb(44, 62, 80);">åŒæ—¶ï¼š</font></p>
<ul>
<li><font style="color:rgb(44, 62, 80);">åªè¦æŸä¸ªå“¨å…µç½‘ç»œæŠ–åŠ¨</font></li>
<li><font style="color:rgb(44, 62, 80);">å°±ä¼šè¯¯åˆ¤ä¸»èŠ‚ç‚¹â€œä¸‹çº¿â€</font></li>
<li><font style="color:rgb(44, 62, 80);">åˆæ²¡æœ‰å¤šæ•°å“¨å…µç¡®è®¤<br></font><font style="color:rgb(44, 62, 80);">â†’ </font><strong>æ˜“äº§ç”Ÿè„‘è£‚é£é™©</strong></li>
</ul>
<p><strong>å“¨å…µ &#x3D; 2 æ˜¯ Redis å®˜æ–¹æ˜ç¡®ä¸æ¨èçš„æœ€ç³Ÿç³•éƒ¨ç½²ã€‚</strong></p>
<h2 id="å¦‚æœå“¨å…µ-5-ä¸ªï¼Œquorum-3"><a href="#å¦‚æœå“¨å…µ-5-ä¸ªï¼Œquorum-3" class="headerlink" title="å¦‚æœå“¨å…µ &#x3D; 5 ä¸ªï¼Œquorum &#x3D; 3"></a>å¦‚æœå“¨å…µ &#x3D; 5 ä¸ªï¼Œquorum &#x3D; 3</h2><h3 id="æŒ‚-1-ä¸ªå“¨å…µ"><a href="#æŒ‚-1-ä¸ªå“¨å…µ" class="headerlink" title="æŒ‚ 1 ä¸ªå“¨å…µ"></a>æŒ‚ 1 ä¸ªå“¨å…µ</h3><p>å‰©ä½™ 4 ä¸ª<br>â†’ å¤šæ•°ç¥¨ &#x3D; 3<br>â†’ quorum &#x3D; 3<br>â†’ ä»èƒ½æ­£å¸¸åˆ¤å®š ODOWN â†’ æ­£å¸¸ failover</p>
<h3 id="æŒ‚-2-ä¸ªå“¨å…µ"><a href="#æŒ‚-2-ä¸ªå“¨å…µ" class="headerlink" title="æŒ‚ 2 ä¸ªå“¨å…µ"></a>æŒ‚ 2 ä¸ªå“¨å…µ</h3><p>å‰© 3 ä¸ª<br>â†’ å¤šæ•°ç¥¨ &#x3D; 2<br>â†’ quorum &#x3D; 3ï¼ˆè¾¾ä¸åˆ°ï¼‰<br>â†’ æ— æ³•åˆ¤å®š ODOWN<br>â†’ æ— æ³• failover<br>â†’ ç³»ç»Ÿä¸å®‰å…¨</p>
<p>æ‰€ä»¥ï¼š</p>
<p>quorum è®¾ç½® &#x3D; å“¨å…µæ•°é‡çš„ 1&#x2F;2 + 1ï¼ˆå‘ä¸Šå–æ•´ï¼‰<br>åŒæ—¶å“¨å…µæ•°é‡åº”å¥‡æ•°ï¼ˆ3ã€5ã€7 â€¦ï¼‰ä»¥è·å¾—æ›´å¥½å®¹é”™æ€§ã€‚</p>
<h1 id="ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹"><a href="#ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹" class="headerlink" title="ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹"></a>ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹</h1><p>é€‰ä¸¾å“¨å…µleaderåå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»äº†ï¼Œä¸»è¦åˆ†ä¸ºå››æ­¥:</p>
<ol>
<li>ä»æ‰€æœ‰ä»èŠ‚ç‚¹ä¸­æŒ‘é€‰ä¸€ä¸ªæœ€ä¼˜çš„ï¼Œæå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹  </li>
<li>è®©å‰©ä½™ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°ä¸»èŠ‚ç‚¹  </li>
<li><font style="color:rgb(44, 62, 80);">å°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…&#x2F;è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯</font></li>
<li><font style="color:rgb(44, 62, 80);">ç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹</font></li>
</ol>
<h2 id="é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹"><a href="#é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹" class="headerlink" title="é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹"></a>é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä»èŠ‚ç‚¹"><a href="#ç¬¬ä¸€æ­¥ï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä»èŠ‚ç‚¹" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä»èŠ‚ç‚¹"></a>ç¬¬ä¸€æ­¥ï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä»èŠ‚ç‚¹</h3><p>ä¸»è¦è¿‡æ»¤ä¸¤ç±»ï¼š</p>
<ol>
<li>å·²ç»ä¸‹çº¿çš„ä»èŠ‚ç‚¹</li>
</ol>
<p>è¿™äº›ä»èŠ‚ç‚¹å·²ç»æ–­å¼€ï¼Œä¸å¯èƒ½æˆä¸ºä¸»èŠ‚ç‚¹ â†’ ç›´æ¥æ’é™¤ã€‚</p>
<ol start="2">
<li>ç½‘ç»œçŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹</li>
</ol>
<p>Redis ç»´æŠ¤ä¸€ä¸ª <code>down-after-milliseconds</code>ï¼ˆredis.confé…ç½®ï¼‰ å‚æ•°ã€‚</p>
<ul>
<li>å¦‚æœä¸€ä¸ªä»èŠ‚ç‚¹åœ¨ <code>down-after-milliseconds * 10</code> æ¯«ç§’å†…ï¼Œå¤šæ¬¡ä¸ä¸»èŠ‚ç‚¹å¤±è”</li>
<li>æˆ–è€…è¿ç»­æ–­é“¾æ¬¡æ•°è¶…è¿‡ 10 æ¬¡<br>â†’ è®¤ä¸ºè¿™ä¸ªä»èŠ‚ç‚¹ç½‘ç»œä¸ç¨³å®šï¼Œä¸é€‚åˆä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ<br>å› ä¸ºå¦‚æœé€‰äº†ä¸€ä¸ªç½‘ç»œå·®çš„ä»èŠ‚ç‚¹åšæ–°ä¸»ï¼Œæ•´ä¸ªé›†ç¾¤ä¼šç»§ç»­é¢‘ç¹æ•…éšœã€‚</p>
<p>è¿‡æ»¤å®Œä»¥åï¼Œä»…ä¿ç•™â€œå¥åº·çš„ä»èŠ‚ç‚¹â€ã€‚</p>
<h3 id="ç¬¬äºŒéƒ¨-å¯¹æ‰€æœ‰ä»èŠ‚ç‚¹è¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID-å·ã€‚åœ¨è¿›è¡Œæ¯ä¸€è½®è€ƒå¯Ÿçš„æ—¶å€™ï¼Œå“ªä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆèƒœå‡ºï¼Œå°±é€‰æ‹©å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚"><a href="#ç¬¬äºŒéƒ¨-å¯¹æ‰€æœ‰ä»èŠ‚ç‚¹è¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID-å·ã€‚åœ¨è¿›è¡Œæ¯ä¸€è½®è€ƒå¯Ÿçš„æ—¶å€™ï¼Œå“ªä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆèƒœå‡ºï¼Œå°±é€‰æ‹©å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚" class="headerlink" title="ç¬¬äºŒéƒ¨:å¯¹æ‰€æœ‰ä»èŠ‚ç‚¹è¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚åœ¨è¿›è¡Œæ¯ä¸€è½®è€ƒå¯Ÿçš„æ—¶å€™ï¼Œå“ªä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆèƒœå‡ºï¼Œå°±é€‰æ‹©å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚"></a>ç¬¬äºŒéƒ¨:<font style="color:rgb(44, 62, 80);">å¯¹æ‰€æœ‰ä»èŠ‚ç‚¹è¿›è¡Œä¸‰è½®è€ƒå¯Ÿ</font><font style="color:#DF2A3F;">ï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚</font><font style="color:rgb(44, 62, 80);">åœ¨è¿›è¡Œæ¯ä¸€è½®è€ƒå¯Ÿçš„æ—¶å€™ï¼Œå“ªä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆèƒœå‡ºï¼Œå°±é€‰æ‹©å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</font></h3><h4 id="ç¬¬ä¸€è½®ï¼šæ¯”è¾ƒä¼˜å…ˆçº§ï¼ˆpriorityï¼‰"><a href="#ç¬¬ä¸€è½®ï¼šæ¯”è¾ƒä¼˜å…ˆçº§ï¼ˆpriorityï¼‰" class="headerlink" title="ç¬¬ä¸€è½®ï¼šæ¯”è¾ƒä¼˜å…ˆçº§ï¼ˆpriorityï¼‰"></a>ç¬¬ä¸€è½®ï¼šæ¯”è¾ƒä¼˜å…ˆçº§ï¼ˆpriorityï¼‰</h4><p>æ¯ä¸ªä»èŠ‚ç‚¹åœ¨é…ç½®æ–‡ä»¶é‡Œæœ‰ä¸€ä¸ªï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-priority</span><br></pre></td></tr></table></figure>

<p>æ•°å€¼è¶Šå° â†’ ä¼˜å…ˆçº§è¶Šé«˜ â†’ è¶Šå®¹æ˜“å½“é€‰ã€‚</p>
<p>å¦‚æœæŸä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆçº§è®¾ç½®ä¸º 0 â†’ æ°¸è¿œä¸ä¼šå½“ä¸»èŠ‚ç‚¹ï¼ˆå®˜æ–¹ç‰¹æ€§ï¼‰ã€‚</p>
<p>å¦‚æœæŸä¸ªèŠ‚ç‚¹ä¼˜å…ˆçº§æœ€é«˜ï¼ˆå€¼æœ€å°ï¼‰ â†’ <strong>ç›´æ¥èƒœå‡ºã€‚</strong></p>
<h4 id="ç¬¬äºŒè½®ï¼šæ¯”è¾ƒå¤åˆ¶åç§»é‡ï¼ˆæ•°æ®å®Œæ•´åº¦ï¼‰"><a href="#ç¬¬äºŒè½®ï¼šæ¯”è¾ƒå¤åˆ¶åç§»é‡ï¼ˆæ•°æ®å®Œæ•´åº¦ï¼‰" class="headerlink" title="ç¬¬äºŒè½®ï¼šæ¯”è¾ƒå¤åˆ¶åç§»é‡ï¼ˆæ•°æ®å®Œæ•´åº¦ï¼‰"></a>ç¬¬äºŒè½®ï¼šæ¯”è¾ƒå¤åˆ¶åç§»é‡ï¼ˆæ•°æ®å®Œæ•´åº¦ï¼‰</h4><p>å¦‚æœå¤šä¸ªä»èŠ‚ç‚¹ä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™æ¯”è¾ƒï¼š</p>
<p>è°çš„å¤åˆ¶ offset å¤§ï¼Œè°çš„æ•°æ®æœ€å®Œæ•´ï¼Œè°å°±æ›´é€‚åˆä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</p>
<p>åŸå› ï¼šæ•°æ®è¶Šå®Œæ•´ï¼Œåˆ‡æ¢åæ•°æ®ä¸¢å¤±è¶Šå°‘ã€‚</p>
<h4 id="ç¬¬ä¸‰è½®ï¼šæ¯”è¾ƒ-runidï¼ˆID-è¾ƒå°è€…èƒœå‡ºï¼‰"><a href="#ç¬¬ä¸‰è½®ï¼šæ¯”è¾ƒ-runidï¼ˆID-è¾ƒå°è€…èƒœå‡ºï¼‰" class="headerlink" title="ç¬¬ä¸‰è½®ï¼šæ¯”è¾ƒ runidï¼ˆID è¾ƒå°è€…èƒœå‡ºï¼‰"></a>ç¬¬ä¸‰è½®ï¼šæ¯”è¾ƒ runidï¼ˆID è¾ƒå°è€…èƒœå‡ºï¼‰</h4><p>å¦‚æœä¼˜å…ˆçº§ä¹Ÿç›¸åŒï¼Œå¤åˆ¶æ•°æ®é‡ä¹Ÿä¸€è‡´ï¼Œåˆ™ä½¿ç”¨ä»èŠ‚ç‚¹çš„ IDï¼ˆrunidï¼‰åšæœ€åæ¯”è¾ƒï¼š</p>
<p>â†’ ID æ›´å°è€…èƒœå‡º</p>
<h2 id="å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹"><a href="#å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹" class="headerlink" title="å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹"></a><font style="color:rgb(44, 62, 80);">å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹</font></h2><p><font style="color:rgb(44, 62, 80);">å½“æ–°ä¸»èŠ‚ç‚¹å‡ºç°ä¹‹åï¼Œå“¨å…µ leader ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ï¼Œè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€æŒ‡å‘ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼Œè¿™ä¸€åŠ¨ä½œå¯ä»¥é€šè¿‡å‘ã€Œä»èŠ‚ç‚¹ã€å‘é€ </font><code>&lt;font style=&quot;color:rgb(71, 101, 130);background-color:rgba(27, 31, 35, 0.05);&quot;&gt;SLAVEOF&lt;/font&gt;</code><font style="color:rgb(44, 62, 80);"> å‘½ä»¤æ¥å®ç°ã€‚</font></p>
<h2 id="é€šçŸ¥å®¢æˆ·çš„ä¸»èŠ‚ç‚¹å·²æ›´æ¢"><a href="#é€šçŸ¥å®¢æˆ·çš„ä¸»èŠ‚ç‚¹å·²æ›´æ¢" class="headerlink" title="é€šçŸ¥å®¢æˆ·çš„ä¸»èŠ‚ç‚¹å·²æ›´æ¢"></a><font style="color:rgb(44, 62, 80);">é€šçŸ¥å®¢æˆ·çš„ä¸»èŠ‚ç‚¹å·²æ›´æ¢</font></h2><p>å½“å“¨å…µå®Œæˆä¸»ä»åˆ‡æ¢åï¼Œå®¢æˆ·ç«¯å¿…é¡»çŸ¥é“â€œæ–°çš„ä¸»èŠ‚ç‚¹åœ°å€â€ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä»ç„¶ä¼šè¿æ¥æ—§ä¸»èŠ‚ç‚¹ï¼Œå¯¼è‡´è¯»å†™å¤±è´¥ã€‚</p>
<p>Redis Sentinel ä½¿ç”¨ <strong>å‘å¸ƒ&#x2F;è®¢é˜…æœºåˆ¶ï¼ˆpub&#x2F;subï¼‰</strong> æ¥å‘å®¢æˆ·ç«¯å¹¿æ’­è¿™äº›äº‹ä»¶ã€‚</p>
<p>æ¯ä¸ªå“¨å…µèŠ‚ç‚¹éƒ½æä¾›ä¸€ä¸ª Pub&#x2F;Sub é¢‘é“ï¼Œå®¢æˆ·ç«¯è¿æ¥å“¨å…µåå¯ä»¥è®¢é˜…è¿™äº›é¢‘é“ã€‚</p>
<p>å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œå“¨å…µä¼šå‘è¿™äº›é¢‘é“å‘é€äº‹ä»¶æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯ä»ä¸­è·å¾—ï¼š</p>
<ul>
<li>æ–°ä¸»èŠ‚ç‚¹çš„ IPã€Port</li>
<li>æ•…éšœè½¬ç§»è¿›åº¦</li>
<li>ä¸»ä»åˆ‡æ¢çš„æ‰€æœ‰é‡è¦æ­¥éª¤</li>
</ul>
<p>è®©å®¢æˆ·ç«¯èƒ½å¤Ÿè‡ªåŠ¨é‡è¿æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/webp/50543647/1763719375362-67110649-1127-48a2-af35-93cfbb7b4313.webp"></p>
<h2 id="å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹"><a href="#å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹" class="headerlink" title="å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹"></a><font style="color:rgb(44, 62, 80);">å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹</font></h2><p><font style="color:rgb(44, 62, 80);">æ•…éšœè½¬ç§»æ“ä½œæœ€åè¦åšçš„æ˜¯ï¼Œç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“æ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå“¨å…µé›†ç¾¤å°±ä¼šå‘å®ƒå‘é€ </font><code>&lt;font style=&quot;color:rgb(71, 101, 130);background-color:rgba(27, 31, 35, 0.05);&quot;&gt;SLAVEOF&lt;/font&gt;</code><font style="color:rgb(44, 62, 80);"> å‘½ä»¤ï¼Œè®©å®ƒæˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</font></p>
<h1 id="å¦‚ä½•æ­å»ºå“¨å…µé›†ç¾¤"><a href="#å¦‚ä½•æ­å»ºå“¨å…µé›†ç¾¤" class="headerlink" title="å¦‚ä½•æ­å»ºå“¨å…µé›†ç¾¤"></a><font style="color:rgb(44, 62, 80);">å¦‚ä½•æ­å»ºå“¨å…µé›†ç¾¤</font></h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä»€ä¹ˆæ—¶ä¸»ä»å¤åˆ¶"><a href="#ä»€ä¹ˆæ—¶ä¸»ä»å¤åˆ¶" class="headerlink" title="ä»€ä¹ˆæ—¶ä¸»ä»å¤åˆ¶"></a>ä»€ä¹ˆæ—¶ä¸»ä»å¤åˆ¶</h1><p>ä¸»æœåŠ¡å™¨è¿›è¡Œå†™æ“ä½œï¼Œå½“å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™è‡ªåŠ¨å°†å†™æ“ä½œåŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</p>
<p>ä»æœåŠ¡å™¨ä¸€èˆ¬æ˜¯åªè¯»çš„ï¼Œå¹¶æ¥å—ä¸»æœåŠ¡å™¨åŒæ­¥è¿‡æ¥çš„å†™æ“ä½œå‘½ä»¤</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763714896045-2a422a2d-71f3-4a72-99e7-dbf4aeb0c90a.png"></p>
<h1 id="ç¬¬ä¸€æ¬¡åŒæ­¥"><a href="#ç¬¬ä¸€æ¬¡åŒæ­¥" class="headerlink" title="ç¬¬ä¸€æ¬¡åŒæ­¥"></a>ç¬¬ä¸€æ¬¡åŒæ­¥</h1><p>ä¸»ä»æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡åŒæ­¥è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ</p>
<ul>
<li><font style="color:rgb(44, 62, 80);">ç¬¬ä¸€é˜¶æ®µæ˜¯å»ºç«‹é“¾æ¥ã€åå•†åŒæ­¥ï¼›</font></li>
<li><font style="color:rgb(44, 62, 80);">ç¬¬äºŒé˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨ï¼›</font></li>
<li><font style="color:rgb(44, 62, 80);">ç¬¬ä¸‰é˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨ã€‚</font></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763715176587-9d0ac381-fbbf-4136-8208-c0b4ce7b8dbc.png"></p>
<h2 id="ç¬¬ä¸€é˜¶æ®µå»ºç«‹è¿æ¥ï¼Œåå•†åŒæ­¥"><a href="#ç¬¬ä¸€é˜¶æ®µå»ºç«‹è¿æ¥ï¼Œåå•†åŒæ­¥" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µå»ºç«‹è¿æ¥ï¼Œåå•†åŒæ­¥"></a>ç¬¬ä¸€é˜¶æ®µå»ºç«‹è¿æ¥ï¼Œåå•†åŒæ­¥</h2><p>ä»èŠ‚ç‚¹æ‰§è¡Œ <code>replicaof</code> åï¼Œä¼šä¸»åŠ¨å‘ä¸»èŠ‚ç‚¹å‘é€ <code>psync</code> å‘½ä»¤ï¼Œè¯·æ±‚è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p>
<p><code>psync</code> å¸¦ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ol>
<li><strong>runid</strong>ï¼šä¸»èŠ‚ç‚¹çš„å”¯ä¸€ IDã€‚<ul>
<li>ä»èŠ‚ç‚¹ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ä¸çŸ¥é“ä¸»èŠ‚ç‚¹çš„ runidï¼Œæ‰€ä»¥ä¼šå‘é€ <code>&quot;?&quot;</code>ã€‚</li>
</ul>
</li>
<li><strong>offset</strong>ï¼šå·²å¤åˆ¶è¿›åº¦ã€‚<ul>
<li>ç¬¬ä¸€æ¬¡åŒæ­¥æ²¡æœ‰ä»»ä½•è¿›åº¦ â†’ å‘é€ <code>-1</code>ã€‚</li>
</ul>
</li>
</ol>
<p>ä¸»èŠ‚ç‚¹æ”¶åˆ° psync åï¼Œå‘ç°è¿™æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œäºæ˜¯è¿”å›ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FULLRESYNC &lt;runid&gt; &lt;offset&gt;</span><br></pre></td></tr></table></figure>

<p>ä»èŠ‚ç‚¹æ”¶åˆ°åä¼šè®°å½•ä¸‹ä¸»èŠ‚ç‚¹çš„ runid å’Œ offsetï¼Œç”¨äºä»¥åå¢é‡åŒæ­¥ã€‚</p>
<p><code>FULLRESYNC</code> çš„å«ä¹‰ï¼š</p>
<p><strong>ä¸»èŠ‚ç‚¹å°†å¯¹ä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡åŒæ­¥ï¼ˆå³æŠŠæ‰€æœ‰æ•°æ®å®Œæ•´åŒæ­¥ä¸€éï¼‰ã€‚</strong></p>
<p>è¿™å°±æ˜¯ç¬¬ä¸€æ¬¡ä¸»ä»åŒæ­¥çš„ç¬¬ä¸€é˜¶æ®µï¼š<br><strong>ç¡®è®¤ runidã€offsetï¼Œéšåè¿›å…¥å…¨é‡å¤åˆ¶æµç¨‹çš„å‡†å¤‡é˜¶æ®µã€‚</strong></p>
<h2 id="ç¬¬äºŒé˜¶æ®µä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨"><a href="#ç¬¬äºŒé˜¶æ®µä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨" class="headerlink" title="ç¬¬äºŒé˜¶æ®µä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨"></a>ç¬¬äºŒé˜¶æ®µä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨</h2><p>ä¸»èŠ‚ç‚¹åœ¨æ”¶åˆ° <code>FULLRESYNC</code> è¯·æ±‚åï¼Œä¼šæ‰§è¡Œ <code>bgsave</code> ç”Ÿæˆä¸€ä»½ RDB æ–‡ä»¶ï¼Œç„¶åæŠŠè¯¥æ–‡ä»¶ä¼ è¾“ç»™ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹æ”¶åˆ° RDB åï¼Œä¼šå…ˆæ¸…ç©ºè‡ªèº«æ•°æ®ï¼Œå†åŠ è½½è¿™ä»½ RDB æ–‡ä»¶ï¼Œä½¿è‡ªèº«çŠ¶æ€ä¸ä¸»èŠ‚ç‚¹ä¸€è‡´ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><code>bgsave</code> æ˜¯ç”± <strong>å­è¿›ç¨‹</strong> è´Ÿè´£ç”Ÿæˆ RDB æ–‡ä»¶çš„ï¼Œå› æ­¤ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸»èŠ‚ç‚¹ä»ç„¶å¯ä»¥ç»§ç»­å¤„ç†æ–°çš„å†™æ“ä½œå‘½ä»¤ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™äº›å†™æ“ä½œå‘ç”Ÿåœ¨ RDB ç”ŸæˆæœŸé—´ï¼Œå¹¶ä¸ä¼šè®°å½•åˆ°åˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚å¦‚æœä¸å¤„ç†ï¼Œè¿™æ®µæ—¶é—´å†…ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®å°±ä¼šä¸ä¸€è‡´ã€‚</p>
<p>ä¸ºäº†ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»èŠ‚ç‚¹ä¼šå°†<strong>åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ—¶é—´æ®µå†…å‘ç”Ÿçš„å†™å‘½ä»¤</strong>å…¨éƒ¨å†™å…¥ <code>replication buffer</code>ï¼ˆå¤åˆ¶ç¼“å†²åŒºï¼‰ï¼š</p>
<ol>
<li><strong>ä¸»èŠ‚ç‚¹æ­£åœ¨ç”Ÿæˆ RDB æ–‡ä»¶æœŸé—´</strong></li>
<li><strong>ä¸»èŠ‚ç‚¹å°† RDB æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹æœŸé—´</strong></li>
<li><strong>ä»èŠ‚ç‚¹åŠ è½½ RDB æ–‡ä»¶æœŸé—´</strong></li>
</ol>
<p>ç­‰ä»èŠ‚ç‚¹æˆåŠŸåŠ è½½å®Œ RDB åï¼Œä¼šç»§ç»­ä»ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºä¸­è·å–è¿™äº›å¢é‡å†™å‘½ä»¤ï¼Œä»è€Œå®Œæˆå…¨é‡ + å¢é‡çš„åŒæ­¥è¿‡ç¨‹ã€‚</p>
<h2 id="ç¬¬ä¸‰é˜¶æ®µä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨"><a href="#ç¬¬ä¸‰é˜¶æ®µä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨"></a>ç¬¬ä¸‰é˜¶æ®µä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨</h2><p>ä¸»èŠ‚ç‚¹å°† RDB æ–‡ä»¶å‘é€å®Œæ¯•åï¼Œä»èŠ‚ç‚¹æ”¶åˆ° RDB æ–‡ä»¶ï¼Œä¼šå…ˆæ¸…ç©ºè‡ªèº«æ—§æ•°æ®ï¼Œç„¶åå°† RDB å†…å®¹å®Œæ•´åŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œä»èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å‘é€ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠåœ¨å…¨é‡åŒæ­¥æœŸé—´å­˜æ”¾åœ¨ <code>replication buffer</code> ä¸­çš„æ‰€æœ‰å†™æ“ä½œå‘½ä»¤æŒ‰é¡ºåºå‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹ä¾æ¬¡æ‰§è¡Œè¿™äº›å¢é‡å‘½ä»¤åï¼Œå…¶æ•°æ®çŠ¶æ€å°±ä¸ä¸»èŠ‚ç‚¹å®Œå…¨ä¸€è‡´äº†ã€‚</p>
<p>è‡³æ­¤ï¼Œä¸»ä»å¤åˆ¶çš„ç¬¬ä¸€æ¬¡åŒæ­¥ï¼ˆå…¨é‡åŒæ­¥ + å¢é‡åŒæ­¥ï¼‰å…¨éƒ¨å®Œæˆã€‚</p>
<h1 id="åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­"><a href="#åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­" class="headerlink" title="åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­"></a>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</h1><p>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥ä¹‹åï¼ŒåŒæ–¹ä¹‹é—´å°±ä¼šç»´æŠ¤ä¸€ä¸ªTCPè¿æ¥</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763715510976-8e59b57c-62ba-4a1b-b2d9-c3689bf96dc9.png"></p>
<p>åç»­ä¸»æœåŠ¡å™¨é€šè¿‡è¿™ä¸ªTCPè¿æ¥å°†å†™æ“ä½œæ“ä½œå‘½ä»¤åŒæ­¥ç»™ä»æœåŠ¡å™¨</p>
<p>è¿™ä¸ªTCPè¿æ¥æ˜¯é•¿è¿æ¥ï¼Œç›®çš„æ˜¯é¿å…äº†é¢‘ç¹çš„TCPåˆ›å»ºå’Œæ–­å¼€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</p>
<h1 id="åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›"><a href="#åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›" class="headerlink" title="åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›"></a>åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›</h1><p>åœ¨ç¬¬ä¸€æ¬¡å…¨é‡åŒæ­¥ä¸­ï¼Œä¸»èŠ‚ç‚¹éœ€è¦åŒæ—¶åšä¸¤ä»¶è€—æ—¶æ“ä½œï¼šç”Ÿæˆ RDB æ–‡ä»¶å¹¶å°†å…¶ä¼ è¾“ç»™ä»èŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœä»èŠ‚ç‚¹å¾ˆå¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»èŠ‚ç‚¹åšå…¨é‡åŒæ­¥ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>fork() å‹åŠ›å¤§</strong><br>ä¸»èŠ‚ç‚¹æ‰§è¡Œ <code>bgsave</code> ä¼š fork å‡ºå­è¿›ç¨‹ç”Ÿæˆ RDBã€‚<br>å¦‚æœä¸»èŠ‚ç‚¹æ•°æ®é‡å¾ˆå¤§ï¼Œfork å¤åˆ¶é¡µè¡¨çš„å¼€é”€ä¼šæ˜æ˜¾å˜æ…¢ï¼Œç”šè‡³é˜»å¡ä¸»çº¿ç¨‹ï¼Œå½±å“ Redis å¤„ç†æ­£å¸¸è¯·æ±‚ã€‚</li>
<li><strong>ç½‘ç»œå¸¦å®½å‹åŠ›å¤§</strong><br>ä¸»èŠ‚ç‚¹éœ€è¦æŠŠ RDB æ–‡ä»¶åˆ†åˆ«å‘é€ç»™æ¯ä¸€ä¸ªä»èŠ‚ç‚¹ï¼ŒRDB æ–‡ä»¶è¶Šå¤§ã€ä»èŠ‚ç‚¹è¶Šå¤šï¼Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œå‹åŠ›è¶Šå¤§ï¼Œå¯èƒ½å½±å“ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çš„å“åº”é€Ÿåº¦ã€‚</li>
</ol>
<p>è¿™ä¸ªæƒ…å†µå°±åƒä¸€ä¸ªåˆ›ä¸šå…¬å¸ï¼Œæœ€å¼€å§‹å‘˜å·¥å°‘ï¼Œè€æ¿ä¸€ä¸ªäººèƒ½ç®¡ï¼›ä½†éšç€å…¬å¸æ‰©å¤§ï¼Œä¸€ä¸ªè€æ¿åŒæ—¶ç®¡ç†æ‰€æœ‰å‘˜å·¥å°±å¿™ä¸è¿‡æ¥ï¼Œéœ€è¦è®¾ç½®â€œç»ç†â€æ¥åˆ†æ‹…ç®¡ç†ä»»åŠ¡ã€‚</p>
<p>Redis ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼æ€è·¯ï¼š<br><strong>è®©ä»èŠ‚ç‚¹ç»§ç»­æŒ‚è‡ªå·±çš„ä»èŠ‚ç‚¹</strong>ã€‚<br>è¿™ä¸ªäºŒçº§ä»èŠ‚ç‚¹æ—¢å¯ä»¥åŒæ­¥æ¥è‡ªä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºâ€œä¸»èŠ‚ç‚¹â€å‘ä¸‹ä¸€çº§ä»èŠ‚ç‚¹æä¾›åŒæ­¥ï¼Œè¿™ç§ç»„ç»‡ç»“æ„å°±æ˜¯é“¾å¼å¤åˆ¶ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼ŒçœŸæ­£ç›´æ¥ä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®çš„ä»èŠ‚ç‚¹å˜å°‘ï¼Œä¸»èŠ‚ç‚¹çš„ fork å‹åŠ›å’Œç½‘ç»œå‹åŠ›éƒ½ä¼šé™ä½ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763715727573-64078359-f5bf-4e61-9e88-c4a33b5a5300.png"></p>
<h2 id="å¦‚ä½•è®©ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäºŒçº§èŠ‚ç‚¹"><a href="#å¦‚ä½•è®©ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäºŒçº§èŠ‚ç‚¹" class="headerlink" title="å¦‚ä½•è®©ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäºŒçº§èŠ‚ç‚¹"></a>å¦‚ä½•è®©ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºäºŒçº§èŠ‚ç‚¹</h2><p><font style="color:rgb(44, 62, 80);">æˆ‘ä»¬åœ¨ã€Œä»æœåŠ¡å™¨ã€ä¸Šæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œä½¿å…¶ä½œä¸ºç›®æ ‡æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼š</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof &lt;ç›®æ ‡æœåŠ¡å™¨çš„IP&gt; 6379</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ­¤æ—¶ç›®æ ‡æœåŠ¡å™¨æœ¬èº«ä¹Ÿæ˜¯ä»æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯¥ç›®æ ‡æœåŠ¡å™¨å°±ä¼šæˆäºŒçº§èŠ‚ç‚¹ï¼ˆç»ç†ï¼‰ï¼Œä¸ä»…å¯ä»¥æ¥å—ä¸»æœåŠ¡å™¨åŒæ­¥çš„æ•°æ®ï¼Œä¹Ÿä¼šæŠŠæ•°æ®åŒæ­¥ç»™è‡ªå·±æ——ä¸‹çš„ä»æœåŠ¡å™¨ï¼Œå‡è½»ä¸»æœåŠ¡å™¨å‹åŠ›</p>
<p>_æ³¨æ„ï¼š ä¸‰çº§èŠ‚ç‚¹åªä¼šå‘å®ƒçš„ç›´å±ä¸Šçº§ï¼ˆäºŒçº§èŠ‚ç‚¹ï¼‰åŒæ­¥ï¼Œä¸ä¼šåŒæ—¶å’Œä¸»èŠ‚ç‚¹åŒæ­¥ã€‚  _</p>
<h1 id="å¢é‡å¤åˆ¶"><a href="#å¢é‡å¤åˆ¶" class="headerlink" title="å¢é‡å¤åˆ¶"></a>å¢é‡å¤åˆ¶</h1><p>å½“ä¸»ä»å®Œæˆç¬¬ä¸€æ¬¡å…¨é‡åŒæ­¥åï¼Œåç»­ä¾èµ–é•¿è¿æ¥è¿›è¡Œå‘½ä»¤å¤åˆ¶ã€‚ä½†ç½‘ç»œå¯èƒ½éšæ—¶å»¶è¿Ÿæˆ–æ–­å¼€ï¼Œæ­¤æ—¶ä»èŠ‚ç‚¹æ— æ³•ç»§ç»­æ¥æ”¶ä¸»èŠ‚ç‚¹çš„å†™å…¥å‘½ä»¤ï¼Œæ•°æ®ä¼šå‘ç”Ÿä¸ä¸€è‡´ã€‚</p>
<p>å½“ç½‘ç»œæ¢å¤åï¼Œä»èŠ‚ç‚¹éœ€è¦ä¸ä¸»èŠ‚ç‚¹é‡æ–°åŒæ­¥ã€‚<br>**Redis 2.8 ä¹‹å‰å¿…é¡»é‡æ–°å…¨é‡åŒæ­¥ï¼ˆä»£ä»·å·¨å¤§ï¼‰ã€‚<br>**<strong>Redis 2.8 ä¹‹åå¼•å…¥äº†â€œå¢é‡å¤åˆ¶ï¼ˆpsyncï¼‰â€ï¼Œå¤§å¹…å‡å°‘å¼€é”€ã€‚</strong></p>
<h2 id="å¢é‡å¤åˆ¶è¿‡ç¨‹"><a href="#å¢é‡å¤åˆ¶è¿‡ç¨‹" class="headerlink" title="å¢é‡å¤åˆ¶è¿‡ç¨‹"></a>å¢é‡å¤åˆ¶è¿‡ç¨‹</h2><p>ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼š</p>
<ol>
<li>ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹å‘é€ï¼š</li>
</ol>
<p>psync runid offset</p>
<br/>

<p>ï¼ˆè¿™é‡Œ offset â‰  -1ï¼Œè€Œæ˜¯ä¸Šæ¬¡æ­£å¸¸åŒæ­¥æ—¶çš„å¤åˆ¶åç§»é‡ï¼‰</p>
<ol start="2">
<li>ä¸»èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦å¯ä»¥ä»â€œå¢é‡æ•°æ®â€ç»§ç»­åŒæ­¥<br>è‹¥å¯ä»¥ â†’ è¿”å›ï¼š</li>
</ol>
<p>CONTINUE</p>
<br/>

<p>è‹¥ä¸å¯ä»¥ â†’ è¿”å›ï¼š</p>
<p>FULLRESYNC</p>
<br/>

<p>ï¼ˆé‡æ–°å…¨é‡å¤åˆ¶ï¼‰</p>
<ol start="3">
<li>å¦‚æœè¿”å› CONTINUEï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠæ–­çº¿æœŸé—´çš„å†™æ“ä½œæ—¥å¿—å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ‰§è¡Œè¿™äº›å‘½ä»¤åå³å¯è¿½ä¸Šä¸»èŠ‚ç‚¹ã€‚</li>
</ol>
<h2 id="ä¸»èŠ‚ç‚¹å¦‚ä½•çŸ¥é“å“ªäº›å¢é‡æ•°æ®å‘ç»™-ä»èŠ‚ç‚¹"><a href="#ä¸»èŠ‚ç‚¹å¦‚ä½•çŸ¥é“å“ªäº›å¢é‡æ•°æ®å‘ç»™-ä»èŠ‚ç‚¹" class="headerlink" title="ä¸»èŠ‚ç‚¹å¦‚ä½•çŸ¥é“å“ªäº›å¢é‡æ•°æ®å‘ç»™ ä»èŠ‚ç‚¹"></a>ä¸»èŠ‚ç‚¹å¦‚ä½•çŸ¥é“å“ªäº›å¢é‡æ•°æ®å‘ç»™ ä»èŠ‚ç‚¹</h2><p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763716294025-8050848e-c36d-4dee-81dc-4c3560a98a6d.png"></p>
<p>ä¾èµ–ä¸¤ä¸ªç»“æ„ï¼š</p>
<h3 id="repl-backlog-bufferï¼ˆå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼‰"><a href="#repl-backlog-bufferï¼ˆå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼‰" class="headerlink" title="repl_backlog_bufferï¼ˆå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼‰"></a>repl_backlog_bufferï¼ˆå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼‰</h3><ul>
<li>ç¯å½¢ç¼“å†²åŒºï¼Œé»˜è®¤å¤§å° <strong>1MB</strong></li>
<li>ä¸»èŠ‚ç‚¹åªè¦æ‰§è¡Œäº†å†™æ“ä½œï¼Œä¸ä»…å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠå‘½ä»¤å†™å…¥è¿™ä¸ª buffer</li>
<li>ä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†™æ“ä½œå‘½ä»¤</li>
</ul>
<h3 id="replication-offsetï¼ˆå¤åˆ¶åç§»é‡ï¼‰"><a href="#replication-offsetï¼ˆå¤åˆ¶åç§»é‡ï¼‰" class="headerlink" title="replication offsetï¼ˆå¤åˆ¶åç§»é‡ï¼‰"></a>replication offsetï¼ˆå¤åˆ¶åç§»é‡ï¼‰</h3><ul>
<li>ä¸»èŠ‚ç‚¹è®°å½• master_repl_offset</li>
<li>ä»èŠ‚ç‚¹è®°å½• slave_repl_offset</li>
<li>ç”¨äºæ ‡è®°åŒæ–¹åŒæ­¥è¿›åº¦</li>
</ul>
<p>ä¸»èŠ‚ç‚¹é€šè¿‡æ¯”è¾ƒ offset å’Œ backlog ä¸­çš„æ•°æ®èŒƒå›´ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½â€œå¢é‡åŒæ­¥â€ã€‚</p>
<p>æ¯”å¦‚åªè¦æ»¡è¶³</p>
<p>slave_repl_offset(ä»èŠ‚ç‚¹å·²ç»åŒæ­¥åˆ°çš„åç§»é‡)&gt;&#x3D;repl_backlog_off ï¼ˆbacklog èµ·å§‹åç§»é‡ï¼‰  </p>
<p>slave_repl_offset&lt;&#x3D;master_repl_offsetï¼ˆ ä¸»èŠ‚ç‚¹å…¨å±€å¤åˆ¶åç§»é‡  ï¼‰</p>
<br/>

<p><em><font style="color:#DF2A3F;">è¿™ä¸ªoffset ä¾¿å®œé‡æ˜¯å…¨å±€é€’å¢çš„</font></em></p>
<p>å°±è¯´æ˜ï¼š</p>
<p>slave_offset å¯¹åº”çš„æ•°æ®ä»ç„¶åœ¨ backlog èŒƒå›´å†…ï¼Œä¸»èŠ‚ç‚¹å¯ä»¥å¢é‡åŒæ­¥ã€‚</p>
<h1 id="é¿å…æ–­çº¿åé¢‘ç¹å…¨é‡åŒæ­¥"><a href="#é¿å…æ–­çº¿åé¢‘ç¹å…¨é‡åŒæ­¥" class="headerlink" title="é¿å…æ–­çº¿åé¢‘ç¹å…¨é‡åŒæ­¥"></a>é¿å…æ–­çº¿åé¢‘ç¹å…¨é‡åŒæ­¥</h1><p>ä¸ºäº†é¿å…çŸ­çº¿åé¢‘ç¹çš„å…¨é‡åŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦ å¢å¤§ backlog çš„å¤§å°  </p>
<p>Redis å®˜æ–¹ç»™çš„ä¼°ç®—å…¬å¼æ˜¯ï¼š</p>
<p>repl_backlog_buffer_size â‰ˆ second * write_size_per_second</p>
<br/>

<p>å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li><code>second</code> &#x3D; ä»èŠ‚ç‚¹æ–­çº¿åé‡æ–°è¿ä¸Šä¸»èŠ‚ç‚¹çš„æœ€é•¿æ—¶é—´ï¼ˆç§’ï¼‰</li>
<li><code>write_size_per_second</code> &#x3D; ä¸»èŠ‚ç‚¹æ¯ç§’äº§ç”Ÿçš„å†™å‘½ä»¤é‡</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹æ¯ç§’äº§ç”Ÿ 1MB å†™å‘½ä»¤</li>
<li>ä»èŠ‚ç‚¹æ–­çº¿ 5 ç§’æ‰èƒ½æ¢å¤</li>
</ul>
<p>åˆ™ï¼š</p>
<p>æœ€å° backlog buffer &#x3D; 1MB * 5 &#x3D; 5MB</p>
<br/>

<p>å¯ä»¥è®¾ä¸ºå†é«˜ä¸€ç‚¹ï¼Œå¦‚ 10MBã€‚</p>
<h2 id="ä¿®æ”¹-backlog-å¤§å°çš„é…ç½®é¡¹"><a href="#ä¿®æ”¹-backlog-å¤§å°çš„é…ç½®é¡¹" class="headerlink" title="ä¿®æ”¹ backlog å¤§å°çš„é…ç½®é¡¹"></a>ä¿®æ”¹ backlog å¤§å°çš„é…ç½®é¡¹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-size 10mb</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/Cluster_%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/redis/%E9%AB%98%E5%8F%AF%E7%94%A8/Cluster_%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¸ºä»€ä¹ˆéœ€è¦Cluster-é›†ç¾¤"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Cluster-é›†ç¾¤" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Cluster é›†ç¾¤"></a>ä¸ºä»€ä¹ˆéœ€è¦Cluster é›†ç¾¤</h1><h2 id="ä¸»ä»å¤åˆ¶æ¨¡å¼çš„å±€é™"><a href="#ä¸»ä»å¤åˆ¶æ¨¡å¼çš„å±€é™" class="headerlink" title="ä¸»ä»å¤åˆ¶æ¨¡å¼çš„å±€é™"></a>ä¸»ä»å¤åˆ¶æ¨¡å¼çš„å±€é™</h2><p>ä¸»ä»å¤åˆ¶åªèƒ½åšåˆ° <strong>è¯»å†™åˆ†ç¦»ã€è‡ªåŠ¨åˆ‡æ¢</strong>ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªæ ¹æœ¬é—®é¢˜ï¼š</p>
<p><strong>æ¯ä¸ªèŠ‚ç‚¹çš„å­˜å‚¨æ•°æ®å®Œå…¨ä¸€æ ·ï¼Œæ— æ³•æ‰©å®¹ï¼Œå¹¶ä¸”æµªè´¹å†…å­˜ã€‚</strong></p>
<h2 id="Redis-Clusterï¼ˆåˆ‡ç‰‡é›†ç¾¤ï¼‰è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#Redis-Clusterï¼ˆåˆ‡ç‰‡é›†ç¾¤ï¼‰è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="Redis Clusterï¼ˆåˆ‡ç‰‡é›†ç¾¤ï¼‰è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>Redis Clusterï¼ˆåˆ‡ç‰‡é›†ç¾¤ï¼‰è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>å®ƒä» Redis 3.0 å¼€å§‹åŠ å…¥ï¼Œæ˜¯å®˜æ–¹çš„åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ¡ˆã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³ï¼š æ•°æ®åˆ†ç‰‡ï¼ˆShardingï¼‰</p>
<p>æ¯ä¸ª Redis èŠ‚ç‚¹åªå­˜ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯å…¨éƒ¨æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼š</p>
<ul>
<li>èŠ‚ç‚¹ Aï¼šå­˜ 0â€“5000 çš„ key</li>
<li>èŠ‚ç‚¹ Bï¼šå­˜ 5001â€“10000 çš„ key</li>
<li>èŠ‚ç‚¹ Cï¼šå­˜ 10001â€“16383 çš„ key</li>
</ul>
<p>æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜ä¸åŒçš„æ•°æ®ï¼Œä»è€Œè§£å†³ï¼š</p>
<ul>
<li>å†…å­˜æ— æ³•æ‰©å®¹çš„é—®é¢˜</li>
<li>å•æœºæŒä¹…åŒ–æ…¢çš„é—®é¢˜</li>
<li>å•æœºæ•…éšœæ¢å¤å›°éš¾çš„é—®é¢˜</li>
</ul>
<h1 id="å®¢æˆ·ç«¯æ˜¯æ€æ ·çŸ¥é“è¯¥è®¿é—®å“ªä¸ªåˆ†ç‰‡çš„-å“ˆå¸Œæ§½"><a href="#å®¢æˆ·ç«¯æ˜¯æ€æ ·çŸ¥é“è¯¥è®¿é—®å“ªä¸ªåˆ†ç‰‡çš„-å“ˆå¸Œæ§½" class="headerlink" title="å®¢æˆ·ç«¯æ˜¯æ€æ ·çŸ¥é“è¯¥è®¿é—®å“ªä¸ªåˆ†ç‰‡çš„?å“ˆå¸Œæ§½"></a><font style="color:rgb(44, 62, 80);">å®¢æˆ·ç«¯æ˜¯æ€æ ·çŸ¥é“è¯¥è®¿é—®å“ªä¸ªåˆ†ç‰‡çš„?å“ˆå¸Œæ§½</font></h1><h2 id="ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼ˆHash-Slotï¼‰ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼ˆHash-Slotï¼‰ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰ï¼Ÿ</h2><p>Redis Cluster å°†æ•´ä¸ªæ•°æ®ç©ºé—´åˆ’åˆ†ä¸º <strong>16384 ä¸ªå“ˆå¸Œæ§½ï¼ˆslotï¼‰</strong>ã€‚</p>
<p>æ¯ä¸ª key ä¼šç»è¿‡ä»¥ä¸‹æ­¥éª¤ç¡®å®šæ§½å·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slot = CRC16(key) % 16384</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<p><strong>æ¯ä¸ª key éƒ½å±äºä¸€ä¸ªæ§½ï¼Œæ§½å†æ˜ å°„åˆ°æŸä¸ª Redis èŠ‚ç‚¹ã€‚</strong></p>
<h2 id="æ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ"><a href="#æ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="æ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ"></a><strong>æ§½å¦‚ä½•åˆ†é…ç»™èŠ‚ç‚¹ï¼Ÿ</strong></h2><p>å‡è®¾é›†ç¾¤æœ‰ Aã€Bã€C ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œ16384 ä¸ªæ§½å¹³å‡åˆ†é…å¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>èŠ‚ç‚¹ Aï¼š0 ~ 5460</li>
<li>èŠ‚ç‚¹ Bï¼š5461 ~ 10922</li>
<li>èŠ‚ç‚¹ Cï¼š10923 ~ 16383</li>
</ul>
<p>æ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£è‡ªå·±èŒƒå›´å†…çš„æ§½ï¼Œä¹Ÿåªå­˜è¿™äº›æ§½ä¸­çš„æ•°æ®ã€‚</p>
<h2 id="å®¢æˆ·ç«¯è®¿é—®æ•°æ®çš„è¿‡ç¨‹"><a href="#å®¢æˆ·ç«¯è®¿é—®æ•°æ®çš„è¿‡ç¨‹" class="headerlink" title="å®¢æˆ·ç«¯è®¿é—®æ•°æ®çš„è¿‡ç¨‹"></a>å®¢æˆ·ç«¯è®¿é—®æ•°æ®çš„è¿‡ç¨‹</h2><p>å®¢æˆ·ç«¯å†™å…¥æˆ–è¯»å–ä¸€ä¸ª key æ—¶ï¼š</p>
<ol>
<li>è®¡ç®—è¯¥ key çš„æ§½å·</li>
<li>æ ¹æ®æ§½å·æ‰¾åˆ°æ‰€å±èŠ‚ç‚¹</li>
<li>ç›´æ¥å‘è¯¥èŠ‚ç‚¹å‘é€è¯»å†™æŒ‡ä»¤</li>
</ol>
<h2 id="å¦‚æœè®¿é—®é”™èŠ‚ç‚¹ä¼šæ€æ ·ï¼Ÿ"><a href="#å¦‚æœè®¿é—®é”™èŠ‚ç‚¹ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="å¦‚æœè®¿é—®é”™èŠ‚ç‚¹ä¼šæ€æ ·ï¼Ÿ"></a>å¦‚æœè®¿é—®é”™èŠ‚ç‚¹ä¼šæ€æ ·ï¼Ÿ</h2><p>å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°é”™è¯¯çš„èŠ‚ç‚¹æ—¶ï¼ˆè¯¥èŠ‚ç‚¹ä¸è´Ÿè´£è¯¥æ§½ï¼‰ï¼š</p>
<ul>
<li>Redis ä¼šè¿”å› <strong>MOVED</strong> æˆ– <strong>ASK</strong> é‡å®šå‘</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°åè‡ªåŠ¨è·³è½¬åˆ°æ­£ç¡®èŠ‚ç‚¹ç»§ç»­æ“ä½œ</li>
</ul>
<p>è¿™æ˜¯ Redis Cluster å®ç°è·¯ç”±ä¸æ‰©å®¹è¿ç§»çš„é‡è¦æœºåˆ¶ã€‚</p>
<h1 id="Moved-å’ŒAsk-é‡å®šå‘"><a href="#Moved-å’ŒAsk-é‡å®šå‘" class="headerlink" title="Moved å’ŒAsk é‡å®šå‘"></a>Moved å’ŒAsk é‡å®šå‘</h1><h2 id="ä¸ºä»€ä¹ˆå‡ºç°é‡å®šå‘"><a href="#ä¸ºä»€ä¹ˆå‡ºç°é‡å®šå‘" class="headerlink" title="ä¸ºä»€ä¹ˆå‡ºç°é‡å®šå‘"></a>ä¸ºä»€ä¹ˆå‡ºç°é‡å®šå‘</h2><p>åœ¨ Redis Cluster ä¸­ï¼Œå®¢æˆ·ç«¯æ˜¯æ ¹æ®æœ¬åœ°ç¼“å­˜çš„å“ˆå¸Œæ§½è·¯ç”±è¡¨ï¼ˆæå‡æ•ˆç‡ï¼‰æ¥å†³å®šæŠŠ key å‘ç»™å“ªä¸ªèŠ‚ç‚¹çš„ã€‚<br>ä½† Redis Cluster æ˜¯ä¸€ä¸ª<strong>æ”¯æŒåŠ¨æ€æ‰©å®¹ã€ç¼©å®¹å’Œæ§½è¿ç§»</strong>çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› æ­¤ï¼š</p>
<p><strong>èŠ‚ç‚¹å®é™…è´Ÿè´£çš„æ§½å¯èƒ½éšé›†ç¾¤å˜åŒ–ï¼Œè€Œå®¢æˆ·ç«¯ç¼“å­˜çš„æ§½åˆ†å¸ƒä¿¡æ¯å¯èƒ½è¿‡æœŸæˆ–ä¸å®Œæ•´ã€‚</strong></p>
<p>å½“å®¢æˆ·ç«¯è®¿é—®çš„èŠ‚ç‚¹å¹¶ä¸å†è´Ÿè´£è¯¥æ§½æ—¶ï¼Œå°±ä¼šå‡ºç°â€œé‡å®šå‘â€ï¼š</p>
<h3 id="å‡ºç°-MOVED-é‡å®šå‘-çš„åŸå› "><a href="#å‡ºç°-MOVED-é‡å®šå‘-çš„åŸå› " class="headerlink" title="å‡ºç° MOVED é‡å®šå‘ çš„åŸå› "></a>å‡ºç° <strong>MOVED é‡å®šå‘</strong> çš„åŸå› </h3><p> æ§½å·²ç»è¢«æ°¸ä¹…è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹ï¼Œè€Œå®¢æˆ·ç«¯è¿˜ä¸çŸ¥é“æœ€æ–°çš„æ§½åˆ†å¸ƒã€‚  </p>
<h3 id="å‡ºç°-ASK-é‡å®šå‘-çš„åŸå› "><a href="#å‡ºç°-ASK-é‡å®šå‘-çš„åŸå› " class="headerlink" title="å‡ºç° ASK é‡å®šå‘ çš„åŸå› "></a>å‡ºç° ASK é‡å®šå‘ çš„åŸå› </h3><p>æ§½æ­£åœ¨è¿ç§»ä¸­ï¼ˆå¤„åœ¨ç§»åŠ¨çš„ä¸­é—´çŠ¶æ€ï¼‰ï¼Œéƒ¨åˆ† key å·²ç»è¿åˆ°æ–°èŠ‚ç‚¹ï¼Œéƒ¨åˆ†è¿˜æ²¡è¿å®Œã€‚</p>
<h2 id="Moved-é‡å®šå‘"><a href="#Moved-é‡å®šå‘" class="headerlink" title="Moved é‡å®šå‘"></a>Moved é‡å®šå‘</h2><p> å½“å®¢æˆ·ç«¯å‘æŸä¸ª Redis èŠ‚ç‚¹å‘é€è¯»å†™è¯·æ±‚æ—¶ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹<strong>å·²ç»ä¸å†è´Ÿè´£è¯¥æ§½</strong>ï¼ˆslotï¼‰ï¼Œå®ƒä¼šè¿”å›Moved é‡å®šå‘</p>
<p>è¡¨ç¤ºï¼š</p>
<p>â€œè¿™ä¸ªæ§½å·²ç»è¢«æ°¸ä¹…è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹äº†ï¼Œä½ çš„è·¯ç”±è¡¨æ˜¯æ—§çš„ï¼Œè¯·åˆ°æ–°èŠ‚ç‚¹å¤„ç†ã€‚â€</p>
<p>å®¢æˆ·ç«¯æ”¶åˆ° MOVED åä¼šï¼š</p>
<ol>
<li>æ›´æ–°æœ¬åœ°ç¼“å­˜çš„å“ˆå¸Œæ§½è·¯ç”±è¡¨</li>
<li>å°†æœ¬æ¬¡å‘½ä»¤é‡å‘ç»™æ­£ç¡®çš„èŠ‚ç‚¹</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763720861046-fe2dee08-fb08-4c0a-8bd0-ef574d8784a8.png"></p>
<h2 id="Aské‡å®šå‘"><a href="#Aské‡å®šå‘" class="headerlink" title="Aské‡å®šå‘"></a>Aské‡å®šå‘</h2><p><strong>ASK é‡å®šå‘å‘ç”Ÿåœ¨æ§½ï¼ˆslotï¼‰æ­£åœ¨è¿ç§»çš„è¿‡ç¨‹ä¸­ã€‚</strong></p>
<p>åœ¨é›†ç¾¤æ‰©å®¹æˆ–ç¼©å®¹æ—¶ï¼Œæ§½ä¼šä»æºèŠ‚ç‚¹è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚åœ¨è¿ç§»çš„ä¸­é—´é˜¶æ®µï¼š</p>
<ul>
<li>æ§½è¿˜æ²¡æœ‰å®Œå…¨è¿ç§»å®Œ</li>
<li>ä½†æ˜¯æŸäº› key å·²ç»è¢«è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹</li>
</ul>
<p>å½“å®¢æˆ·ç«¯ä»å°†è¯·æ±‚å‘é€åˆ°æºèŠ‚ç‚¹æ—¶ï¼ŒæºèŠ‚ç‚¹ä¼šè¿”å›ï¼šAské‡å®šå‘</p>
<p>è¡¨ç¤ºï¼š</p>
<p>â€œè¿™ä¸ª key å·²ç»æ¬åˆ°æ–°èŠ‚ç‚¹äº†ï¼Œä½†æ§½è¿˜åœ¨è¿ç§»åŠ¨ä¸­ã€‚ä½ <strong>æš‚æ—¶</strong>å»ç›®æ ‡èŠ‚ç‚¹è®¿é—®å³å¯ã€‚â€</p>
<p>å®¢æˆ·ç«¯æ”¶åˆ° ASK åï¼š</p>
<ol>
<li>ä¸ä¼šæ›´æ–°è‡ªå·±çš„ slot â†’ node è·¯ç”±è¡¨ï¼ˆå› ä¸ºæ§½è¿ç§»å°šæœªå®Œæˆï¼‰</li>
<li>ä¼šå‘ç›®æ ‡èŠ‚ç‚¹å‘é€ä¸€ä¸ª <code>ASKING</code> å‘½ä»¤</li>
<li>å†å‘é€çœŸæ­£çš„ key å‘½ä»¤</li>
</ol>
<p>ASK æ˜¯ä¸€ç§ <strong>ä¸´æ—¶è·³è½¬</strong>ï¼Œç”¨äºå¤„ç†ä¸­é—´çŠ¶æ€ï¼Œä¸ä»£è¡¨æ§½å·²ç»æ°¸ä¹…è¿ç§»ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763720876617-bd1dcbd8-2547-4da6-969c-311eee0c4b92.png"></p>
<h1 id="å“ˆå¸Œæ§½å’Œä¸€è‡´æ€§å“ˆå¸Œçš„åŒºåˆ«"><a href="#å“ˆå¸Œæ§½å’Œä¸€è‡´æ€§å“ˆå¸Œçš„åŒºåˆ«" class="headerlink" title="å“ˆå¸Œæ§½å’Œä¸€è‡´æ€§å“ˆå¸Œçš„åŒºåˆ«"></a>å“ˆå¸Œæ§½å’Œä¸€è‡´æ€§å“ˆå¸Œçš„åŒºåˆ«</h1><h3 id="1-ç»“æ„æœ¬è´¨ä¸åŒ"><a href="#1-ç»“æ„æœ¬è´¨ä¸åŒ" class="headerlink" title="1. ç»“æ„æœ¬è´¨ä¸åŒ"></a><strong>1. ç»“æ„æœ¬è´¨ä¸åŒ</strong></h3><ul>
<li><strong>å“ˆå¸Œæ§½ï¼ˆRedis Clusterï¼‰</strong>ï¼š<br>å›ºå®š 16384 ä¸ªæ§½ï¼Œæ¯ä¸ª key é€šè¿‡ CRC16 è½åˆ°å…¶ä¸­ä¸€ä¸ªæ§½ï¼Œç„¶åæ§½å†æ˜ å°„åˆ°å…·ä½“èŠ‚ç‚¹ã€‚ä¸æ˜¯ç¯å½¢ç»“æ„ã€‚</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œï¼ˆConsistent Hashï¼‰</strong>ï¼š<br>ä¸€ä¸ªå·¨å¤§çš„ç¯ï¼ˆ2^32 ç©ºé—´ï¼‰ï¼ŒèŠ‚ç‚¹æŒ‰ hash å€¼åˆ†å¸ƒåœ¨ç¯ä¸Šï¼Œkey è½åœ¨ç¯ä¸Šé¡ºæ—¶é’ˆç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
<h3 id="2-æ‰©å®¹æ–¹å¼ä¸åŒ"><a href="#2-æ‰©å®¹æ–¹å¼ä¸åŒ" class="headerlink" title="2.æ‰©å®¹æ–¹å¼ä¸åŒ"></a>2.æ‰©å®¹æ–¹å¼ä¸åŒ</h3><ul>
<li><strong>å“ˆå¸Œæ§½</strong>ï¼š<br>æ§½æ•°é‡å›ºå®šï¼Œä¸å˜ã€‚æ‰©å®¹åªéœ€è¦æŠŠéƒ¨åˆ†æ§½è¿ç§»åˆ°æ–°èŠ‚ç‚¹ï¼Œè¿ç§»èŒƒå›´å¯æ§ã€‚</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>ï¼š<br>æ–°èŠ‚ç‚¹åŠ å…¥ä¼šè‡ªåŠ¨æ¥ç®¡ç¯ä¸Šä¸€æ®µåŒºé—´ï¼Œéœ€è¦è¿ç§»é‚£ä¸€æ®µçš„æ•°æ®ï¼Œå…·ä½“è¿å¤šå°‘å®Œå…¨ç”± hash åˆ†å¸ƒå†³å®šï¼Œä¸å¯æ§ã€‚</li>
</ul>
<h3 id="3-å¤š-Key-æ“ä½œæ”¯æŒä¸åŒ"><a href="#3-å¤š-Key-æ“ä½œæ”¯æŒä¸åŒ" class="headerlink" title="3.å¤š Key æ“ä½œæ”¯æŒä¸åŒ"></a><strong>3.å¤š Key æ“ä½œæ”¯æŒä¸åŒ</strong></h3><ul>
<li><strong>å“ˆå¸Œæ§½</strong>ï¼š<br>é€šè¿‡ key tagï¼ˆå¦‚ <code>{user:1}</code>ï¼‰å¯ä»¥è®©å¤šä¸ª key è½åœ¨åŒä¸€ä¸ªæ§½ï¼Œä»è€Œæ”¯æŒ MGET &#x2F; MSET ç­‰å¤š key æ“ä½œã€‚</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>ï¼š<br>key ä¹‹é—´ hash å®Œå…¨ç‹¬ç«‹ï¼Œå¤š key å¾ˆå¯èƒ½è½åœ¨ä¸åŒèŠ‚ç‚¹ï¼Œå¤©ç„¶ä¸æ”¯æŒå¤š key åŸå­æ€§æ“ä½œã€‚</li>
</ul>
<h1 id="å“ˆå¸Œæ§½VSç›´æ¥æ ¹æ®èŠ‚ç‚¹æ•°é‡å–å“ˆå¸Œ"><a href="#å“ˆå¸Œæ§½VSç›´æ¥æ ¹æ®èŠ‚ç‚¹æ•°é‡å–å“ˆå¸Œ" class="headerlink" title="å“ˆå¸Œæ§½VSç›´æ¥æ ¹æ®èŠ‚ç‚¹æ•°é‡å–å“ˆå¸Œ"></a>å“ˆå¸Œæ§½VSç›´æ¥æ ¹æ®èŠ‚ç‚¹æ•°é‡å–å“ˆå¸Œ</h1><p><strong>å“ˆå¸Œæ§½ï¼š</strong></p>
<ul>
<li>å°† key æ˜ å°„åˆ°å›ºå®šçš„ slot</li>
<li>slot æ•°é‡ä¸å˜</li>
<li>æ‰©å®¹æ—¶è¿ç§» slot â†’ èŠ‚ç‚¹ çš„å½’å±</li>
<li>è¿ç§»é‡å°ã€å¯æ§ã€ç¨³å®š</li>
</ul>
<p><strong>èŠ‚ç‚¹æ•°å–å“ˆå¸Œï¼š</strong></p>
<ul>
<li>key ç›´æ¥ä¾èµ– N</li>
<li>N ä¸€å˜ï¼Œç»“æœå…¨å˜</li>
<li>è¿ç§»é‡å·¨å¤§ï¼Œæ— æ³•ç”¨äºåˆ†å¸ƒå¼æ•°æ®åº“</li>
</ul>
<p><strong>å› æ­¤ Redis Cluster é‡‡ç”¨å“ˆå¸Œæ§½ï¼Œè€Œä¸æ˜¯æŒ‰èŠ‚ç‚¹æ•°é‡å–æ¨¡çš„æ–¹å¼ã€‚</strong></p>
<h2 id="ä¾‹å¦‚ï¼š"><a href="#ä¾‹å¦‚ï¼š" class="headerlink" title="ä¾‹å¦‚ï¼š"></a>ä¾‹å¦‚ï¼š</h2><p>** **å‡è®¾ä¸€å¼€å§‹åªæœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚  </p>
<ol>
<li>hash(key) % èŠ‚ç‚¹æ•°  ï¼ˆ ç¾éš¾æ€§  ï¼‰</li>
</ol>
<p>node &#x3D; hash(key) % 3</p>
<br/>

<p> ç°åœ¨æ‰©å®¹åˆ° <strong>4 ä¸ªèŠ‚ç‚¹</strong>ï¼š  </p>
<p>node &#x3D; hash(key) % 4</p>
<br/>

<p>ç»“æœï¼š</p>
<p><strong>æ‰€æœ‰ key çš„è½ç‚¹å…¨éƒ¨å˜åŒ–ï¼</strong></p>
<p>å› ä¸º <code>%3</code> å’Œ <code>%4</code> è¾“å‡ºå®Œå…¨ä¸åŒã€‚<br>ä½ å¿…é¡»è¿ç§» <strong>å‡ ä¹æ‰€æœ‰æ•°æ®</strong>ã€‚</p>
<ol start="2">
<li>hashæ§½</li>
</ol>
<p>redis å›ºå®š <strong>16384 ä¸ªæ§½</strong>ï¼š</p>
<p>slot &#x3D; hash(key) % 16384   â† æ°¸è¿œä¸å˜</p>
<br/>

<p>æ‰©å®¹æ—¶åªæ˜¯ï¼š</p>
<p>æŠŠéƒ¨åˆ†æ§½ä»æ—§èŠ‚ç‚¹æ¬åˆ°æ–°èŠ‚ç‚¹</p>
<br/>

<p>ä¾‹å¦‚åŸæ¥ï¼š</p>
<ul>
<li>èŠ‚ç‚¹Aï¼šæ§½ 0~5460</li>
<li>èŠ‚ç‚¹Bï¼šæ§½ 5461~10922</li>
<li>èŠ‚ç‚¹Cï¼šæ§½ 10923~16383</li>
</ul>
<p>æ‰©å®¹åï¼š</p>
<ul>
<li>èŠ‚ç‚¹Aï¼šæ§½ 0~4095</li>
<li>èŠ‚ç‚¹Bï¼šæ§½ 4096~8191</li>
<li>èŠ‚ç‚¹Cï¼šæ§½ 8192~12287</li>
<li>èŠ‚ç‚¹Dï¼šæ§½ 12288~16383</li>
</ul>
<p> è¿ç§»é‡åªå‘ç”Ÿåœ¨è¢«<font style="color:#DF2A3F;">é‡æ–°åˆ†é…çš„æ§½</font>ï¼Œè€Œä¸æ˜¯<font style="color:#DF2A3F;">æ‰€æœ‰ key</font>ã€‚  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/redis/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/redis/%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="è¿‡æœŸåˆ é™¤ç­–ç•¥"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥</h2><h3 id="redis-å¦‚ä½•åˆ¤å®škey-è¿‡æœŸ"><a href="#redis-å¦‚ä½•åˆ¤å®škey-è¿‡æœŸ" class="headerlink" title="redis å¦‚ä½•åˆ¤å®škey è¿‡æœŸ"></a>redis å¦‚ä½•åˆ¤å®škey è¿‡æœŸ</h3><ul>
<li>å½“æˆ‘ä»¬ç»™ä¸€ä¸ª <strong>key è®¾ç½®è¿‡æœŸæ—¶é—´</strong> æ—¶ï¼ŒRedis ä¼šæŠŠè¯¥ key åŠå…¶å¯¹åº”çš„è¿‡æœŸæ—¶é—´è®°å½•åˆ°ä¸€ä¸ª <strong>è¿‡æœŸå­—å…¸ï¼ˆexpires å­—å…¸ï¼‰</strong> ä¸­ã€‚</li>
<li>è¿™ä¸ªè¿‡æœŸå­—å…¸æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª <strong>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰</strong>ï¼Œé”®æ˜¯ key çš„åå­—ï¼Œå€¼æ˜¯è¯¥ key çš„è¿‡æœŸæ—¶é—´æˆ³ã€‚</li>
<li>ç”±äºå“ˆå¸Œè¡¨æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <strong>O(1)</strong>ï¼ŒRedis èƒ½éå¸¸å¿«é€Ÿåœ°åˆ¤æ–­ä¸€ä¸ª key æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</li>
</ul>
<p>å½“è¯»å–æŸä¸ªå€¼çš„æ—¶å€™ï¼Œredis é¦–å…ˆåœ¨ä¸»å­—å…¸ä¸­æŸ¥æ‰¾è¯¥ keyã€‚  </p>
<p>å¦‚æœæ‰¾åˆ°è¯¥ keyï¼Œåˆ™è¿›ä¸€æ­¥åœ¨ <strong>è¿‡æœŸå­—å…¸</strong> ä¸­æ£€æŸ¥ï¼š</p>
<ul>
<li><strong>è‹¥ key ä¸åœ¨è¿‡æœŸå­—å…¸ä¸­</strong> â†’ è¯´æ˜è¯¥ key æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç›´æ¥è¿”å›ã€‚</li>
<li><strong>è‹¥ key åœ¨è¿‡æœŸå­—å…¸ä¸­</strong> â†’ Redis ä¼šå–å‡ºå®ƒçš„è¿‡æœŸæ—¶é—´ï¼Œä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯æ˜¯å¦è¿‡æœŸã€‚</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1763711708749-ac8eabb2-4065-4044-9d46-e77276cb9df2.png"></p>
<h3 id="è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥æœ‰å“ªäº›</h3><ul>
<li><font style="color:rgb(44, 62, 80);">å®šæ—¶åˆ é™¤ï¼›</font></li>
<li><font style="color:rgb(44, 62, 80);">æƒ°æ€§åˆ é™¤ï¼›</font></li>
<li><font style="color:rgb(44, 62, 80);">å®šæœŸåˆ é™¤ï¼›</font></li>
</ul>
<table>
<thead>
<tr>
<th>åˆ é™¤ç­–ç•¥</th>
<th>æ‰§è¡Œæ–¹å¼</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>ä¸¾ä¾‹è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å®šæ—¶åˆ é™¤</strong></td>
<td>ä¸ºæ¯ä¸ª key è®¾ç½®ç‹¬ç«‹çš„å®šæ—¶å™¨ï¼Œä¸€åˆ°è¿‡æœŸæ—¶é—´ç«‹å³åˆ é™¤ã€‚</td>
<td>å®æ—¶æ€§æœ€å¥½ï¼Œè¿‡æœŸæ•°æ®å‡ ä¹ä¸ä¼šè¢«è®¿é—®åˆ°ã€‚</td>
<td>å ç”¨ CPU èµ„æºå¤šï¼Œè‹¥è¿‡æœŸ key è¾ƒå¤šä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</td>
<td>å‡è®¾è®¾ç½®äº† 1 ä¸‡ä¸ª key åŒæ—¶è¿‡æœŸï¼ŒRedis ä¼šåŒæ—¶è§¦å‘ 1 ä¸‡ä¸ªåˆ é™¤æ“ä½œï¼Œå¯èƒ½é€ æˆå¡é¡¿ã€‚</td>
</tr>
<tr>
<td><strong>æƒ°æ€§åˆ é™¤</strong></td>
<td>è®¿é—® key æ—¶æ‰æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œè‹¥è¿‡æœŸåˆ™åœ¨è®¿é—®æ—¶åˆ é™¤ã€‚</td>
<td>å¯¹ CPU å‹å¥½ï¼Œæ— éœ€é¢å¤–å®šæ—¶ä»»åŠ¡ã€‚</td>
<td>è‹¥ key é•¿æœŸä¸è¢«è®¿é—®ï¼Œä¼šä¸€ç›´å ç”¨å†…å­˜ï¼ˆå†…å­˜æ³„æ¼é£é™©ï¼‰ã€‚</td>
<td>æŸäº›å†·æ•°æ®é•¿æœŸä¸è®¿é—®ï¼Œå°±ç®—è¿‡æœŸäº†ä¹Ÿä¸ä¼šè¢«æ¸…ç†ã€‚</td>
</tr>
<tr>
<td><strong>å®šæœŸåˆ é™¤</strong></td>
<td>Redis æ¯éš”ä¸€æ®µæ—¶é—´éšæœºæŠ½æ ·æ£€æŸ¥éƒ¨åˆ†è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ keyï¼Œåˆ é™¤å…¶ä¸­å·²è¿‡æœŸçš„ã€‚</td>
<td>åœ¨æ€§èƒ½ä¸å†…å­˜ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œé¿å…å ç”¨è¿‡å¤š CPUã€‚</td>
<td>ä¸èƒ½ä¿è¯æ‰€æœ‰è¿‡æœŸ key éƒ½è¢«ç«‹å³æ¸…ç†ï¼Œæœ‰ä¸€å®šå»¶è¿Ÿã€‚</td>
<td>Redis é»˜è®¤æ¯ 100ms è¿›è¡Œä¸€æ¬¡è¿‡æœŸé‡‡æ ·ï¼Œæ¸…ç†ä¸€éƒ¨åˆ†å·²è¿‡æœŸ keyã€‚</td>
</tr>
</tbody></table>
<h4 id="rediså®é™…é‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤-å®šæœŸåˆ é™¤"><a href="#rediså®é™…é‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤-å®šæœŸåˆ é™¤" class="headerlink" title="rediså®é™…é‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤"></a>rediså®é™…é‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤</h4><p>æƒ°æ€§åˆ é™¤ï¼š redis æ¯æ¬¡åœ¨è®¿é—®keyçš„æ—¶å€™éƒ½ä¼šæ£€æŸ¥keyæ˜¯å¦è¿‡æœŸè¿‡åˆ é™¤</p>
<p>å®šæœŸåˆ é™¤ï¼š redis é»˜è®¤æ¯ç§’è¿›è¡Œ10æ¬¡è¿‡æœŸæ£€æŸ¥æ•°æ®åº“ï¼ˆ hz  å­—æ®µæ›´æ”¹é…ç½® ï¼‰ï¼Œæ³¨æ„è¿™10æ¬¡æ£€æŸ¥ä¸æ˜¯å…¨åº“æ‰«æï¼Œè€Œæ˜¯ä»æ•°æ®åº“ä¸­æŠ½å–ä¸€å®šæ•°é‡çš„keyè¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼ˆ active-expire-effort   å­—æ®µæ›´æ”¹é…ç½®ï¼‰</p>
<h2 id="redis-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#redis-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="redis å†…å­˜æ·˜æ±°ç­–ç•¥"></a>redis å†…å­˜æ·˜æ±°ç­–ç•¥</h2><p>rediså†…å­˜æ·˜æ±°ç­–ç•¥åˆ†ä¸ºå…«ç§ï¼Œè¿™å…«ç§ç­–ç•¥å¤§ä½“åˆ†ä¸º<strong>ä¸è¿›è¡Œæ•°æ®æ·˜æ±°</strong>å’Œ<strong>è¿›è¡Œæ•°æ®æ·˜æ±°</strong></p>
<h4 id="ä¸è¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ï¼ˆredisé»˜è®¤ç­–ç•¥ï¼‰"><a href="#ä¸è¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ï¼ˆredisé»˜è®¤ç­–ç•¥ï¼‰" class="headerlink" title="ä¸è¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ï¼ˆredisé»˜è®¤ç­–ç•¥ï¼‰"></a>ä¸è¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ï¼ˆredisé»˜è®¤ç­–ç•¥ï¼‰</h4><p>noeviction  å®ƒè¡¨ç¤ºå½“è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ã€‚<br>è¿™æ—¶å¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œä¼šæŠ¥é”™é€šçŸ¥ç¦æ­¢å†™å…¥ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œ<br>ä½†æ˜¯å¦‚æœæ²¡æœ‰æ•°æ®å†™å…¥çš„è¯ï¼Œåªæ˜¯å•çº¯çš„æŸ¥è¯¢æˆ–è€…åˆ é™¤æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚  </p>
<h4 id="è¿›è¡Œæ•°æ®æ·˜æ±°"><a href="#è¿›è¡Œæ•°æ®æ·˜æ±°" class="headerlink" title="è¿›è¡Œæ•°æ®æ·˜æ±°"></a>è¿›è¡Œæ•°æ®æ·˜æ±°</h4><p>é’ˆå¯¹ã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€è¿™ä¸€ç±»ç­–ç•¥ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºã€Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ã€å’Œã€Œåœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ã€è¿™ä¸¤ç±»ç­–ç•¥ã€‚</p>
<p>åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ï¼š</p>
<ul>
<li><strong>volatile-random</strong>ï¼šéšæœºæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ä»»æ„é”®å€¼ï¼›</li>
<li><strong>volatile-ttl</strong>ï¼šä¼˜å…ˆæ·˜æ±°æ›´æ—©è¿‡æœŸçš„é”®å€¼ï¼›</li>
<li><strong>volatile-lru</strong>ï¼ˆRedis3.0 ä¹‹å‰ï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li>
<li><strong>volatile-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€å°‘ä½¿ç”¨çš„é”®å€¼ã€‚</li>
</ul>
<p>åœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ï¼š</p>
<ul>
<li><strong>allkeys-random</strong>ï¼šéšæœºæ·˜æ±°ä»»æ„é”®å€¼ï¼›</li>
<li><strong>allkeys-lru</strong>ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li>
<li><strong>allkeys-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€å°‘ä½¿ç”¨çš„é”®å€¼ã€‚</li>
</ul>
<h4 id="æŸ¥çœ‹redis-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#æŸ¥çœ‹redis-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="æŸ¥çœ‹redis å†…å­˜æ·˜æ±°ç­–ç•¥"></a>æŸ¥çœ‹redis å†…å­˜æ·˜æ±°ç­–ç•¥</h4><p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1760853787301-0a89c43b-9783-4704-bb3a-a91fd2ba0431.png"></p>
<h4 id="ä¿®æ”¹redis-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#ä¿®æ”¹redis-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="ä¿®æ”¹redis å†…å­˜æ·˜æ±°ç­–ç•¥"></a>ä¿®æ”¹redis å†…å­˜æ·˜æ±°ç­–ç•¥</h4><p><img src="https://cdn.nlark.com/yuque/0/2025/png/50543647/1760853796862-384ae849-2bff-41fc-8b21-c4397939ca58.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/redis/redis/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/bitmap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | åˆ˜ç¿°éœ–">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/25/redis/redis/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/bitmap/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 20:31:43 / ä¿®æ”¹æ—¶é—´ï¼š20:27:21" itemprop="dateCreated datePublished" datetime="2025-11-25T20:31:43+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>bitmap ä½å›¾ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶æ•°ç»„</p>
<h1 id="bitmapå¸¸ç”¨å‘½ä»¤"><a href="#bitmapå¸¸ç”¨å‘½ä»¤" class="headerlink" title="bitmapå¸¸ç”¨å‘½ä»¤"></a>bitmapå¸¸ç”¨å‘½ä»¤</h1><ol>
<li>è®¾ç½®æŸä¸€ä½çš„å€¼-&gt;setbitï¼ˆåˆå§‹åŒ–ï¼‰</li>
</ol>
<p>SETBIT key offset(ä½å›¾ä¸­çš„ç¬¬å‡ ä½ï¼Œoffset ä»0å¼€å§‹ï¼‰ value(åªèƒ½æ˜¯0æˆ–1)</p>
<br/>

<ol start="2">
<li>è·å–æŸä¸€ä½çš„å€¼</li>
</ol>
<p>GETBIT key offset</p>
<br/>

<ol start="3">
<li>ç»Ÿè®¡1çš„æ•°é‡-&gt;bitcount</li>
</ol>
<p>BITCOUNT key</p>
<br/>

<ol start="4">
<li>æŒ‰èŒƒå›´ç»Ÿè®¡ â†’ <code>BITCOUNT key start end</code></li>
</ol>
<p>ç»Ÿè®¡åŒºé—´èŒƒå›´å†… bit&#x3D;1 çš„æ•°é‡ã€‚</p>
<p>è¿™ä¸ªstart end åŒºé—´æ˜¯æŒ‰ç…§å­—èŠ‚æ¥ç®—çš„å·¦é—­å³é—­åŒºé—´</p>
<p>ä¾‹å¦‚ä»ç¬¬ 0 - 7 å­—èŠ‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT user:sign:202501 0 0</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¤šä¸ªbitmaoä¹‹é—´çš„æ“ä½œbitop</li>
</ol>
<p> Redis æ”¯æŒä¸‰ç§è¿ç®—ï¼š  </p>
<table>
<thead>
<tr>
<th>è¿ç®—</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>AND</td>
<td>ä¸</td>
</tr>
<tr>
<td>OR</td>
<td>æˆ–</td>
</tr>
<tr>
<td>XOR</td>
<td>å¼‚æˆ–</td>
</tr>
</tbody></table>
<h3 id="æ±‚åŒæ—¶åœ¨çº¿ï¼ˆä¸¤ä¸ª-bitmap-éƒ½ä¸º-1ï¼‰"><a href="#æ±‚åŒæ—¶åœ¨çº¿ï¼ˆä¸¤ä¸ª-bitmap-éƒ½ä¸º-1ï¼‰" class="headerlink" title="æ±‚åŒæ—¶åœ¨çº¿ï¼ˆä¸¤ä¸ª bitmap éƒ½ä¸º 1ï¼‰"></a>æ±‚åŒæ—¶åœ¨çº¿ï¼ˆä¸¤ä¸ª bitmap éƒ½ä¸º 1ï¼‰</h3><p>BITOP AND user:online:both day1 day2</p>
<br/>

<h3 id="æ±‚ä¸¤å¤©å†…ä»»æ„ä¸€å¤©åœ¨çº¿"><a href="#æ±‚ä¸¤å¤©å†…ä»»æ„ä¸€å¤©åœ¨çº¿" class="headerlink" title="æ±‚ä¸¤å¤©å†…ä»»æ„ä¸€å¤©åœ¨çº¿"></a>æ±‚ä¸¤å¤©å†…ä»»æ„ä¸€å¤©åœ¨çº¿</h3><p>BITOP OR user:online:any day1 day2</p>
<br/>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">åˆ˜ç¿°éœ–</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
